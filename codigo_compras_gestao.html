
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <title>Código Otimizado</title>
        <style>
            body {
                font-family: 'Consolas', 'Courier New', monospace;
                font-size: 8px; /* Letra bem pequena */
                margin: 0;
                padding: 10px;
                color: #222;
            }
            .summary-box {
                border: 2px solid #000;
                padding: 15px;
                margin-bottom: 20px;
                font-family: sans-serif;
                font-size: 12px;
            }
            .content-wrapper {
                column-count: 3; /* 3 Colunas */
                column-gap: 1cm;
                column-rule: 0.5px solid #ccc;
            }
            .file-container {
                break-inside: avoid;
                margin-bottom: 8px;
                padding-bottom: 4px;
                border-bottom: 1px dotted #ccc;
            }
            .file-header {
                font-weight: bold;
                background-color: #eee;
                padding: 1px 4px;
                border: 1px solid #ddd;
                font-size: 9px;
                margin-bottom: 1px;
            }
            .code-block {
                white-space: pre-wrap;
                word-wrap: break-word;
                margin: 0;
                line-height: 1.05;
            }
            .page-break { page-break-after: always; }
            ul { column-count: 2; font-size: 10px; }
            
            @media print {
                @page { margin: 0.7cm; size: A4; }
                body { -webkit-print-color-adjust: exact; }
            }
        </style>
    </head>
    <body>
        
    <div class="summary-box">
        <h1>Código Fonte - Compras & Gestão</h1>
        <p><strong>Conteúdo:</strong> Backend + Frontend)</p>
        <p><strong>Total de Arquivos:</strong> 92</p>
        <p><strong>Linhas de Código (Limpas):</strong> 9959</p>
        <p><strong>Folhas Estimadas (Frente e Verso):</strong> ~37</p>
    </div>
    <div class="page-break"></div>
    
        <h2>Índice (Backend e Frontend)</h2><ul><li>backend\audit\apps.py</li><li>backend\audit\middleware.py</li><li>backend\audit\models.py</li><li>backend\audit\signals.py</li><li>backend\core\api_urls.py</li><li>backend\core\apps.py</li><li>backend\core\asgi.py</li><li>backend\core\middleware.py</li><li>backend\core\settings.py</li><li>backend\core\urls.py</li><li>backend\core\wsgi.py</li><li>backend\purchases\admin.py</li><li>backend\purchases\apps.py</li><li>backend\purchases\middleware.py</li><li>backend\purchases\models.py</li><li>backend\purchases\permissions.py</li><li>backend\purchases\request_utils.py</li><li>backend\purchases\serializers.py</li><li>backend\purchases\signals.py</li><li>backend\purchases\urls.py</li><li>backend\purchases\views.py</li><li>backend\purchases\management\commands\sync_files.py</li><li>backend\tenants\admin.py</li><li>backend\tenants\apps.py</li><li>backend\tenants\models.py</li><li>backend\tenants\permissions.py</li><li>backend\tenants\serializers.py</li><li>backend\tenants\urls.py</li><li>backend\tenants\views.py</li><li>backend\users\admin.py</li><li>backend\users\apps.py</li><li>backend\users\authentication.py</li><li>backend\users\models.py</li><li>backend\users\permissions.py</li><li>backend\users\serializers.py</li><li>backend\users\signals.py</li><li>backend\users\throttles.py</li><li>backend\users\urls.py</li><li>backend\users\views.py</li><li>frontend\src\global.d.ts</li><li>frontend\src\main.tsx</li><li>frontend\src\components\Header.tsx</li><li>frontend\src\components\MainLayout.tsx</li><li>frontend\src\components\Modal.tsx</li><li>frontend\src\components\Pagination.tsx</li><li>frontend\src\components\PermissionRoute.tsx</li><li>frontend\src\components\ProcessoCreateSkeleton.tsx</li><li>frontend\src\components\ProcessoDetailSkeleton.tsx</li><li>frontend\src\components\ProcessoSkeletonCard.tsx</li><li>frontend\src\components\ProcessosModal.tsx</li><li>frontend\src\components\ProtectedRoute.tsx</li><li>frontend\src\components\SearchableSelect.tsx</li><li>frontend\src\components\Sidebar.tsx</li><li>frontend\src\components\StatusHistoryModal.tsx</li><li>frontend\src\components\SystemStatus.tsx</li><li>frontend\src\components\UserForm.tsx</li><li>frontend\src\components\UserManagementSkeleton.tsx</li><li>frontend\src\hooks\reportGenerator.ts</li><li>frontend\src\hooks\useAuth.tsx</li><li>frontend\src\pages\App.tsx</li><li>frontend\src\pages\Dashboard.tsx</li><li>frontend\src\pages\GerenciarEmpresas.tsx</li><li>frontend\src\pages\Login.tsx</li><li>frontend\src\pages\ManageCRDII.tsx</li><li>frontend\src\pages\ProcessoCreate.tsx</li><li>frontend\src\pages\ProcessoDetail.tsx</li><li>frontend\src\pages\Processos.tsx</li><li>frontend\src\pages\UserManagement.tsx</li><li>frontend\src\services\api.ts</li><li>frontend\src\styles\dashboard.css</li><li>frontend\src\styles\global-animations.css</li><li>frontend\src\styles\global.css</li><li>frontend\src\styles\header.css</li><li>frontend\src\styles\login.css</li><li>frontend\src\styles\mainLayout.css</li><li>frontend\src\styles\modal.css</li><li>frontend\src\styles\pagination.css</li><li>frontend\src\styles\processoCreate.css</li><li>frontend\src\styles\processoCreateSkeleton.css</li><li>frontend\src\styles\ProcessoDetail.css</li><li>frontend\src\styles\processoDetailSkeleton.css</li><li>frontend\src\styles\processos.css</li><li>frontend\src\styles\processoSkeletonCard.css</li><li>frontend\src\styles\ProcessosModal.css</li><li>frontend\src\styles\searchableSelect.css</li><li>frontend\src\styles\sidebar.css</li><li>frontend\src\styles\statusHistoryModal.css</li><li>frontend\src\styles\systemStatus.css</li><li>frontend\src\styles\userForm.css</li><li>frontend\src\styles\userManagement.css</li><li>frontend\src\styles\userManagementSkeleton.css</li><li>frontend\src\styles\variables.css</li></ul><hr>
        <div class="content-wrapper">
            
                            <div class="file-container">
                                <div class="file-header">backend\audit\apps.py <span style="float:right">(6 linhas)</span></div>
                                <pre class="code-block">from django.apps import AppConfig
class AuditConfig(AppConfig):
    default_auto_field = &#x27;django.db.models.BigAutoField&#x27;
    name = &#x27;audit&#x27;
    def ready(self):
        import audit.signals</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\audit\middleware.py <span style="float:right">(14 linhas)</span></div>
                                <pre class="code-block">import threading
_thread_locals = threading.local()
def get_current_user():
    return getattr(_thread_locals, &#x27;user&#x27;, None)
def get_current_ip():
    return getattr(_thread_locals, &#x27;ip&#x27;, None)
class AuditMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response
    def __call__(self, request):
        _thread_locals.user = getattr(request, &#x27;user&#x27;, None)
        _thread_locals.ip = request.META.get(&#x27;REMOTE_ADDR&#x27;)
        response = self.get_response(request)
        return response</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\audit\models.py <span style="float:right">(25 linhas)</span></div>
                                <pre class="code-block">from django.db import models
from django.conf import settings
from django.contrib.contenttypes.models import ContentType
from django.contrib.contenttypes.fields import GenericForeignKey
class AuditLog(models.Model):
    ACTION_CHOICES = (
        (&#x27;CREATE&#x27;, &#x27;Create&#x27;),
        (&#x27;UPDATE&#x27;, &#x27;Update&#x27;),
        (&#x27;DELETE&#x27;, &#x27;Delete&#x27;),
        (&#x27;LOGIN&#x27;, &#x27;Login&#x27;),
        (&#x27;LOGOUT&#x27;, &#x27;Logout&#x27;),
    )
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True, blank=True)
    action = models.CharField(max_length=10, choices=ACTION_CHOICES)
    timestamp = models.DateTimeField(auto_now_add=True)
    ip_address = models.GenericIPAddressField(null=True, blank=True)
    content_type = models.ForeignKey(ContentType, on_delete=models.SET_NULL, null=True, blank=True)
    object_id = models.CharField(max_length=255, null=True, blank=True)
    content_object = GenericForeignKey(&#x27;content_type&#x27;, &#x27;object_id&#x27;)
    changes = models.JSONField(null=True, blank=True)
    description = models.TextField(blank=True)
    class Meta:
        ordering = [&#x27;-timestamp&#x27;]
    def __str__(self):
        return f&quot;{self.user} - {self.action} - {self.timestamp}&quot;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\audit\signals.py <span style="float:right">(50 linhas)</span></div>
                                <pre class="code-block">import json
from django.db.models.signals import post_save, post_delete
from django.dispatch import receiver
from django.core.serializers.json import DjangoJSONEncoder
from django.contrib.contenttypes.models import ContentType
from .models import AuditLog
from .middleware import get_current_user, get_current_ip
from users.models import CustomUser
from purchases.models import Processo, Arquivo
AUDITED_MODELS = [CustomUser, Processo, Arquivo]
def get_changes(instance, created):
    if created:
        return {&quot;action&quot;: &quot;created&quot;}
    return {&quot;action&quot;: &quot;updated&quot;, &quot;data&quot;: str(instance)}
@receiver(post_save)
def audit_log_save(sender, instance, created, **kwargs):
    if sender not in AUDITED_MODELS:
        return
    user = get_current_user()
    if not user or not user.is_authenticated:
        return
    action = &#x27;CREATE&#x27; if created else &#x27;UPDATE&#x27;
    try:
        AuditLog.objects.create(
            user=user,
            action=action,
            ip_address=get_current_ip(),
            content_object=instance,
            changes=json.loads(json.dumps(get_changes(instance, created), cls=DjangoJSONEncoder)),
            description=f&quot;{action} {sender.__name__} {instance}&quot;
        )
    except Exception as e:
        print(f&quot;Error creating audit log: {e}&quot;)
@receiver(post_delete)
def audit_log_delete(sender, instance, **kwargs):
    if sender not in AUDITED_MODELS:
        return
    user = get_current_user()
    if not user or not user.is_authenticated:
        return
    try:
        AuditLog.objects.create(
            user=user,
            action=&#x27;DELETE&#x27;,
            ip_address=get_current_ip(),
            content_object=instance,
            description=f&quot;DELETE {sender.__name__} {instance}&quot;
        )
    except Exception as e:
        print(f&quot;Error creating audit log: {e}&quot;)</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\core\api_urls.py <span style="float:right">(15 linhas)</span></div>
                                <pre class="code-block">from django.urls import path, include
from rest_framework.routers import DefaultRouter
from users.views import CookieTokenObtainPairView, CookieTokenRefreshView
from drf_spectacular.views import SpectacularAPIView, SpectacularRedocView, SpectacularSwaggerView
router = DefaultRouter()
urlpatterns = [
    path(&#x27;schema/&#x27;, SpectacularAPIView.as_view(), name=&#x27;schema&#x27;),
    path(&#x27;docs/&#x27;, SpectacularSwaggerView.as_view(url_name=&#x27;schema&#x27;), name=&#x27;swagger-ui&#x27;),
    path(&#x27;redoc/&#x27;, SpectacularRedocView.as_view(url_name=&#x27;schema&#x27;), name=&#x27;redoc&#x27;),
    path(&quot;auth/&quot;, include(&quot;users.urls&quot;)), # ex: /api/auth/users/, /api/auth/permissions/, /api/auth/logout/
    path(&quot;&quot;, include(&quot;purchases.urls&quot;)),
    path(&quot;&quot;, include(&quot;tenants.urls&quot;)),
    path(&#x27;token/&#x27;, CookieTokenObtainPairView.as_view(), name=&#x27;token_obtain_pair&#x27;),
    path(&#x27;token/refresh/&#x27;, CookieTokenRefreshView.as_view(), name=&#x27;token_refresh&#x27;),
]</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\core\apps.py <span style="float:right">(4 linhas)</span></div>
                                <pre class="code-block">from django.apps import AppConfig
class CoreConfig(AppConfig):
    default_auto_field = &quot;django.db.models.BigAutoField&quot;
    name = &quot;core&quot;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\core\asgi.py <span style="float:right">(4 linhas)</span></div>
                                <pre class="code-block">import os
from django.core.asgi import get_asgi_application
os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;core.settings&quot;)
application = get_asgi_application()</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\core\middleware.py <span style="float:right">(32 linhas)</span></div>
                                <pre class="code-block">from django_tenants.middleware.main import TenantMainMiddleware
from django_tenants.utils import get_tenant_model, get_public_schema_name
from django.db import connection
class TenantIdentificationMiddleware(TenantMainMiddleware):
    &quot;&quot;&quot;
    Middleware customizado para selecionar o tenant.
    Prioridade:
    1. Header &#x27;X-Tenant-ID&#x27; (Frontend)
    2. Subdomínio/Hostname (Navegador/Admin)
    3. Fallback para Public (Segurança)
    &quot;&quot;&quot;
    def process_request(self, request):
        self.request = request
        return super().process_request(request)
    def get_public_schema_tenant(self):
        try:
            return get_tenant_model().objects.get(schema_name=get_public_schema_name())
        except get_tenant_model().DoesNotExist:
            return None
    def get_tenant(self, domain_model, hostname):
        tenant_schema_from_header = self.request.headers.get(&#x27;X-Tenant-ID&#x27;)
        if tenant_schema_from_header:
            try:
                tenant = get_tenant_model().objects.get(schema_name=tenant_schema_from_header)
                return tenant
            except get_tenant_model().DoesNotExist:
                pass
        try:
            return super().get_tenant(domain_model, hostname)
        except domain_model.DoesNotExist:
            pass
        return self.get_public_schema_tenant()</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\core\settings.py <span style="float:right">(176 linhas)</span></div>
                                <pre class="code-block">import os
from pathlib import Path
from datetime import timedelta
from dotenv import load_dotenv
load_dotenv()
BASE_DIR = Path(__file__).resolve().parent.parent
DEBUG = os.environ.get(&quot;DEBUG&quot;, &quot;False&quot;).lower() == &quot;true&quot;
SECRET_KEY = os.environ.get(&quot;SECRET_KEY&quot;)
if not SECRET_KEY:
    if DEBUG:
        SECRET_KEY = &quot;dev_secret_key_for_testing_purposes_only&quot;
    else:
        raise ValueError(&quot;A variável de ambiente SECRET_KEY deve ser definida em produção.&quot;)
ALLOWED_HOSTS_FROM_ENV = [
    host.strip() for host in os.environ.get(&quot;ALLOWED_HOSTS&quot;, &quot;&quot;).split(&quot;,&quot;) if host.strip()
]
if DEBUG:
    ALLOWED_HOSTS = [&quot;localhost&quot;, &quot;127.0.0.1&quot;] + ALLOWED_HOSTS_FROM_ENV
else:
    if not ALLOWED_HOSTS_FROM_ENV:
        raise ValueError(&quot;A variável de ambiente ALLOWED_HOSTS deve ser definida em produção.&quot;)
    ALLOWED_HOSTS = ALLOWED_HOSTS_FROM_ENV
ALLOWED_HOSTS = list(set(ALLOWED_HOSTS))
CSRF_TRUSTED_ORIGINS_ENV = os.environ.get(&quot;CSRF_TRUSTED_ORIGINS&quot;)
if CSRF_TRUSTED_ORIGINS_ENV:
    CSRF_TRUSTED_ORIGINS = [origin.strip() for origin in CSRF_TRUSTED_ORIGINS_ENV.split(&quot;,&quot;)]
else:
    CSRF_TRUSTED_ORIGINS = []
if DEBUG and not CSRF_TRUSTED_ORIGINS:
     CSRF_TRUSTED_ORIGINS = [&#x27;http://localhost:5174&#x27;, &#x27;http://127.0.0.1:5174&#x27;]
SECURE_PROXY_SSL_HEADER = (&#x27;HTTP_X_FORWARDED_PROTO&#x27;, &#x27;https&#x27;)
USE_X_FORWARDED_HOST = True
USE_X_FORWARDED_PORT = True
SHARED_APPS = [
    &#x27;django_tenants&#x27;,
    &#x27;tenants&#x27;,
    &#x27;users&#x27;, 
    &#x27;django.contrib.auth&#x27;,
    &#x27;django.contrib.contenttypes&#x27;,
    &#x27;django.contrib.sessions&#x27;,
    &#x27;django.contrib.admin&#x27;,
    &#x27;django.contrib.messages&#x27;,
    &#x27;django.contrib.staticfiles&#x27;, 
    &#x27;rest_framework&#x27;,
    &#x27;rest_framework_simplejwt&#x27;,
    &#x27;corsheaders&#x27;,
    &#x27;drf_spectacular&#x27;,
]
TENANT_APPS = (
    &#x27;purchases&#x27;,
    &#x27;audit&#x27;,
)
INSTALLED_APPS = list(SHARED_APPS) + [app for app in TENANT_APPS if app not in SHARED_APPS]
TENANT_MODEL = &quot;tenants.Empresa&quot;
TENANT_DOMAIN_MODEL = &quot;tenants.Dominio&quot;
DATABASE_ROUTERS = (
    &#x27;django_tenants.routers.TenantSyncRouter&#x27;,
)
MIDDLEWARE = [
    &#x27;core.middleware.TenantIdentificationMiddleware&#x27;,
    &quot;django.middleware.security.SecurityMiddleware&quot;,
    &quot;django.contrib.sessions.middleware.SessionMiddleware&quot;,
    &quot;corsheaders.middleware.CorsMiddleware&quot;,
    &quot;django.middleware.common.CommonMiddleware&quot;,
    &quot;django.middleware.csrf.CsrfViewMiddleware&quot;,
    &quot;django.contrib.auth.middleware.AuthenticationMiddleware&quot;,
    &quot;django.contrib.messages.middleware.MessageMiddleware&quot;,
    &quot;django.middleware.clickjacking.XFrameOptionsMiddleware&quot;,
    &quot;audit.middleware.AuditMiddleware&quot;,
]
ROOT_URLCONF = &quot;core.urls&quot;
TENANT_IDENTIFIER_CLASS = &#x27;django_tenants.middleware.identificators.HeaderIdentificator&#x27;
TENANT_IDENTIFIER_HEADER = &#x27;X-Tenant-ID&#x27;
TEMPLATES = [
    {
        &quot;BACKEND&quot;: &quot;django.template.backends.django.DjangoTemplates&quot;,
        &quot;DIRS&quot;: [
            os.path.join(BASE_DIR, &quot;..&quot;, &quot;frontend&quot;, &quot;dist&quot;),
        ],
        &quot;APP_DIRS&quot;: True,
        &quot;OPTIONS&quot;: {
            &quot;context_processors&quot;: [
                &quot;django.template.context_processors.debug&quot;,
                &quot;django.template.context_processors.request&quot;,
                &quot;django.contrib.auth.context_processors.auth&quot;,
                &quot;django.contrib.messages.context_processors.messages&quot;,
            ]
        },
    }
]
WSGI_APPLICATION = &quot;core.wsgi.application&quot;
if os.environ.get(&quot;POSTGRES_DB&quot;):
    DATABASES = {
        &quot;default&quot;: {
            &quot;ENGINE&quot;: &quot;django_tenants.postgresql_backend&quot;,
            &quot;NAME&quot;: os.environ.get(&quot;POSTGRES_DB&quot;),
            &quot;USER&quot;: os.environ.get(&quot;POSTGRES_USER&quot;),
            &quot;PASSWORD&quot;: os.environ.get(&quot;POSTGRES_PASSWORD&quot;),
            &quot;HOST&quot;: os.environ.get(&quot;POSTGRES_HOST&quot;, &quot;db&quot;),
            &quot;PORT&quot;: os.environ.get(&quot;POSTGRES_PORT&quot;, &quot;5432&quot;),
        }
    }
else:
    DATABASES = {
        &quot;default&quot;: {
            &quot;ENGINE&quot;: &quot;django.db.backends.sqlite3&quot;,
            &quot;NAME&quot;: BASE_DIR / &quot;db.sqlite3&quot;,
        }
    }
AUTH_USER_MODEL = &quot;users.CustomUser&quot;
AUTH_PASSWORD_VALIDATORS = [
    {
        &#x27;NAME&#x27;: &#x27;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&#x27;,
    },
    {
        &#x27;NAME&#x27;: &#x27;django.contrib.auth.password_validation.MinimumLengthValidator&#x27;,
        &#x27;OPTIONS&#x27;: {
            &#x27;min_length&#x27;: 8,
        }
    },
    {
        &#x27;NAME&#x27;: &#x27;django.contrib.auth.password_validation.CommonPasswordValidator&#x27;,
    },
    {
        &#x27;NAME&#x27;: &#x27;django.contrib.auth.password_validation.NumericPasswordValidator&#x27;,
    },
]
LANGUAGE_CODE = &quot;pt-br&quot;
TIME_ZONE = &quot;America/Sao_Paulo&quot;
USE_I18N = True
USE_TZ = True
STATIC_URL = &quot;/static/&quot;
STATIC_ROOT = BASE_DIR / &quot;staticfiles&quot;
MEDIA_URL = &quot;/media/&quot;
MEDIA_ROOT = BASE_DIR / &quot;media&quot;
REST_FRAMEWORK = {
    &quot;DEFAULT_AUTHENTICATION_CLASSES&quot;: (
        &quot;users.authentication.CookieJWTAuthentication&quot;,
    ),
    &quot;DEFAULT_PERMISSION_CLASSES&quot;: (&quot;rest_framework.permissions.IsAuthenticated&quot;,),
    &quot;DEFAULT_SCHEMA_CLASS&quot;: &quot;drf_spectacular.openapi.AutoSchema&quot;,
    &quot;DEFAULT_THROTTLE_RATES&quot;: {
        &quot;anon&quot;: &quot;5/minute&quot;,
        &quot;user&quot;: &quot;1000/day&quot;,
        &quot;login&quot;: &quot;5/minute&quot;, # Throttle especifico para login
    },
}
SPECTACULAR_SETTINGS = {
    &#x27;TITLE&#x27;: &#x27;Gestão de Compras API&#x27;,
    &#x27;DESCRIPTION&#x27;: &#x27;API para sistema de gestão de compras e processos.&#x27;,
    &#x27;VERSION&#x27;: &#x27;1.0.0&#x27;,
    &#x27;SERVE_INCLUDE_SCHEMA&#x27;: False,
}
SIMPLE_JWT = {
    &quot;ACCESS_TOKEN_LIFETIME&quot;: timedelta(minutes=15),
    &quot;REFRESH_TOKEN_LIFETIME&quot;: timedelta(hours=1),
    &quot;ROTATE_REFRESH_TOKENS&quot;: True,
    &quot;BLACKLIST_AFTER_ROTATION&quot;: True,
}
CORS_ALLOW_CREDENTIALS = True
if DEBUG:
    CORS_ALLOW_ALL_ORIGINS = False
    CORS_ALLOWED_ORIGINS = [
        &quot;http://localhost:5174&quot;,
        &quot;http://127.0.0.1:5174&quot;,
    ]
else:
    CORS_ALLOW_ALL_ORIGINS = False
    cors_origins = os.environ.get(&quot;CORS_ALLOWED_ORIGINS&quot;)
    if not cors_origins:
        raise ValueError(&quot;A variável de ambiente CORS_ALLOWED_ORIGINS deve ser definida em produção (ex: &#x27;https://meufrontend.com&#x27;).&quot;)
    CORS_ALLOWED_ORIGINS = [origin.strip() for origin in cors_origins.split(&quot;,&quot;)]
LOGIN_REDIRECT_URL = &quot;/&quot;
STATICFILES_DIRS = [
    os.path.join(BASE_DIR, &quot;..&quot;, &quot;frontend&quot;, &quot;dist&quot;, &quot;static&quot;),
]</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\core\urls.py <span style="float:right">(20 linhas)</span></div>
                                <pre class="code-block">from django.contrib import admin
from django.urls import path, include, re_path
from django.conf import settings
from django.conf.urls.static import static
from django.views.generic import TemplateView
from drf_spectacular.views import SpectacularAPIView, SpectacularRedocView, SpectacularSwaggerView
urlpatterns = [
    path(&quot;admin/&quot;, admin.site.urls),
    path(&quot;api/&quot;, include(&quot;core.api_urls&quot;)),
    path(&#x27;api/schema/&#x27;, SpectacularAPIView.as_view(), name=&#x27;schema&#x27;),
    path(&#x27;api/schema/swagger-ui/&#x27;, SpectacularSwaggerView.as_view(url_name=&#x27;schema&#x27;), name=&#x27;swagger-ui&#x27;),
    path(&#x27;api/schema/redoc/&#x27;, SpectacularRedocView.as_view(url_name=&#x27;schema&#x27;), name=&#x27;redoc&#x27;),
    re_path(
        r&quot;^(?!api/|admin/|admin$|static/|media/).*$&quot;,
        TemplateView.as_view(template_name=&quot;index.html&quot;),
    ),
]
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
    urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\core\wsgi.py <span style="float:right">(6 linhas)</span></div>
                                <pre class="code-block">import os
from django.core.wsgi import get_wsgi_application
from dotenv import load_dotenv
load_dotenv()
os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;core.settings&quot;)
application = get_wsgi_application()</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\purchases\admin.py <span style="float:right">(29 linhas)</span></div>
                                <pre class="code-block">from django.contrib import admin
from .models import Processo, Arquivo, LogUso, CRDII, StatusHistory
@admin.register(CRDII)
class CRDIIAdmin(admin.ModelAdmin):
    list_display = (&#x27;nome&#x27;, &#x27;slug&#x27;)
    search_fields = (&#x27;nome&#x27;,)
    prepopulated_fields = {&#x27;slug&#x27;: (&#x27;nome&#x27;,)}
@admin.register(Processo)
class ProcessoAdmin(admin.ModelAdmin):
    list_display = (&#x27;nome&#x27;, &#x27;crdii&#x27;, &#x27;status&#x27;, &#x27;criado_por&#x27;, &#x27;data_criacao&#x27;)
    list_filter = (&#x27;status&#x27;, &#x27;crdii&#x27;, &#x27;criado_por&#x27;)
    search_fields = (&#x27;nome&#x27;, &#x27;crdii__nome&#x27;)
    readonly_fields = (&#x27;criado_por&#x27;, &#x27;data_criacao&#x27;, &#x27;slug&#x27;)
@admin.register(Arquivo)
class ArquivoAdmin(admin.ModelAdmin):
    list_display = (&#x27;nome_atual&#x27;, &#x27;processo&#x27;, &#x27;criado_por&#x27;, &#x27;data_upload&#x27;)
    search_fields = (&#x27;nome_atual&#x27;, &#x27;processo__nome&#x27;)
    readonly_fields = (&#x27;criado_por&#x27;, &#x27;data_upload&#x27;)
@admin.register(LogUso)
class LogUsoAdmin(admin.ModelAdmin):
    list_display = (&#x27;usuario&#x27;, &#x27;acao&#x27;, &#x27;data_hora&#x27;)
    list_filter = (&#x27;usuario&#x27;, &#x27;acao&#x27;)
    readonly_fields = (&#x27;usuario&#x27;, &#x27;acao&#x27;, &#x27;detalhe&#x27;, &#x27;data_hora&#x27;)
@admin.register(StatusHistory)
class StatusHistoryAdmin(admin.ModelAdmin):
    list_display = (&#x27;processo&#x27;, &#x27;usuario&#x27;, &#x27;status_anterior&#x27;, &#x27;status_novo&#x27;, &#x27;data_mudanca&#x27;)
    list_filter = (&#x27;usuario&#x27;, &#x27;status_novo&#x27;)
    search_fields = (&#x27;processo__nome&#x27;,)
    readonly_fields = (&#x27;processo&#x27;, &#x27;usuario&#x27;, &#x27;status_anterior&#x27;, &#x27;status_novo&#x27;, &#x27;data_mudanca&#x27;)</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\purchases\apps.py <span style="float:right">(6 linhas)</span></div>
                                <pre class="code-block">from django.apps import AppConfig
class PurchasesConfig(AppConfig):
    default_auto_field = &quot;django.db.models.BigAutoField&quot;
    name = &quot;purchases&quot;
    def ready(self):
        import purchases.signals</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\purchases\middleware.py <span style="float:right">(8 linhas)</span></div>
                                <pre class="code-block">from .request_utils import set_current_user
class CurrentUserMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response
    def __call__(self, request):
        set_current_user(request.user if request.user.is_authenticated else None)
        response = self.get_response(request)
        return response</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\purchases\models.py <span style="float:right">(104 linhas)</span></div>
                                <pre class="code-block">from django.db import models
from django.conf import settings
from django.utils.text import slugify
from django.utils import timezone
from django.db import connection
def get_upload_path(instance, filename):
    try:
        tenant_name = connection.tenant.schema_name
    except AttributeError:
        tenant_name = &quot;public&quot;
    crdii_nome = instance.processo.crdii.nome if instance.processo.crdii else &quot;sem-crdii&quot;
    processo_nome = instance.processo.nome
    return f&quot;{tenant_name}/{crdii_nome}/{processo_nome}/{filename}&quot;
class CRDII(models.Model):
    id = models.BigAutoField(primary_key=True)
    nome = models.CharField(max_length=100, unique=True)
    slug = models.SlugField(max_length=100, unique=True, blank=True)
    class Meta:
        verbose_name = &quot;CRDII&quot;
        verbose_name_plural = &quot;CRDIIs&quot;
    def __str__(self):
        return self.nome
class Processo(models.Model):
    class Status(models.TextChoices):
        NAO_CONCLUIDO = &quot;nao_concluido&quot;, &quot;Em Andamento&quot;
        CONCLUIDO = &quot;concluido&quot;, &quot;Concluído&quot;
        PARCIAL = &quot;parcial&quot;, &quot;Parcial&quot;
        ARQUIVADO = &quot;arquivado&quot;, &quot;Arquivado&quot;
        CANCELADO = &quot;cancelado&quot;, &quot;Cancelado&quot;
    id = models.BigAutoField(primary_key=True)
    crdii = models.ForeignKey(
        CRDII,
        on_delete=models.PROTECT,
        related_name=&quot;processos&quot;,
        null=True,
        blank=True,
    )
    nome = models.CharField(max_length=255)
    slug = models.SlugField(
        max_length=255,
        unique=True,
        blank=True,
    )
    criado_por = models.ForeignKey(
        settings.AUTH_USER_MODEL,
        related_name=&quot;processos_criados&quot;,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
    )
    data_criacao = models.DateTimeField(auto_now_add=True)
    status = models.CharField(
        max_length=32, choices=Status.choices, default=Status.NAO_CONCLUIDO
    )
    data_em_andamento = models.DateTimeField(null=True, blank=True)
    data_parcial = models.DateTimeField(null=True, blank=True)
    data_concluido = models.DateTimeField(null=True, blank=True)
    data_arquivado = models.DateTimeField(null=True, blank=True)
    data_cancelado = models.DateTimeField(null=True, blank=True)
    class Meta:
        unique_together = (&#x27;crdii&#x27;, &#x27;nome&#x27;)
    def __str__(self):
        return f&quot;{self.nome} ({self.id})&quot;
class Arquivo(models.Model):
    id = models.BigAutoField(primary_key=True)
    processo = models.ForeignKey(
        Processo, on_delete=models.CASCADE, related_name=&quot;arquivos&quot;
    )
    nome_original = models.CharField(max_length=255)
    nome_atual = models.CharField(max_length=255)
    arquivo = models.FileField(upload_to=get_upload_path)
    data_upload = models.DateTimeField(auto_now_add=True)
    criado_por = models.ForeignKey(
        settings.AUTH_USER_MODEL,
        related_name=&quot;arquivos_criados&quot;,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
    )
    def __str__(self):
        return self.nome_atual
class LogUso(models.Model):
    id = models.BigAutoField(primary_key=True)
    usuario = models.ForeignKey(
        settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True
    )
    acao = models.CharField(max_length=128)
    detalhe = models.TextField(blank=True)
    data_hora = models.DateTimeField(auto_now_add=True)
    def __str__(self):
        return f&quot;{self.usuario} - {self.acao}&quot;
class StatusHistory(models.Model):
    id = models.BigAutoField(primary_key=True)
    processo = models.ForeignKey(Processo, related_name=&#x27;status_history&#x27;, on_delete=models.CASCADE)
    usuario = models.ForeignKey(settings.AUTH_USER_MODEL, null=True, blank=True, on_delete=models.SET_NULL)
    status_anterior = models.CharField(max_length=32, null=True, blank=True, choices=[(&quot;nao_concluido&quot;, &quot;Em Andamento&quot;), (&quot;concluido&quot;, &quot;Concluído&quot;), (&quot;parcial&quot;, &quot;Parcial&quot;), (&quot;arquivado&quot;, &quot;Arquivado&quot;), (&quot;cancelado&quot;, &quot;Cancelado&quot;)])
    status_novo = models.CharField(max_length=32, choices=[(&quot;nao_concluido&quot;, &quot;Em Andamento&quot;), (&quot;concluido&quot;, &quot;Concluído&quot;), (&quot;parcial&quot;, &quot;Parcial&quot;), (&quot;arquivado&quot;, &quot;Arquivado&quot;), (&quot;cancelado&quot;, &quot;Cancelado&quot;)])
    data_mudanca = models.DateTimeField(auto_now_add=True)
    class Meta:
        ordering = [&#x27;-data_mudanca&#x27;]
        verbose_name = &quot;Histórico de Status&quot;
        verbose_name_plural = &quot;Históricos de Status&quot;
    def __str__(self):
        return f&#x27;Processo {self.processo.id}: {self.status_anterior} -&gt; {self.status_novo}&#x27;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\purchases\permissions.py <span style="float:right">(24 linhas)</span></div>
                                <pre class="code-block">from rest_framework.permissions import BasePermission
from users.models import UserPermission
class HasPermission(BasePermission):
    &quot;&quot;&quot;
    Verifica se o usuário tem a permissão (booleana) ativa na tabela UserPermission
    do tenant atual.
    &quot;&quot;&quot;
    def __init__(self, codename):
        self.codename = codename # Ex: &#x27;can_create_processo&#x27;
    def has_permission(self, request, view):
        if not request.user or not request.user.is_authenticated:
            return False
        if request.user.is_superuser or request.user.role == &#x27;dev&#x27;:
            return True
        perms_dict = UserPermission.get_user_permissions_dict(request.user, request.tenant)
        return perms_dict.get(self.codename, False)
class CanViewStatusHistory(BasePermission):
    def has_permission(self, request, view):
        if not request.user or not request.user.is_authenticated:
            return False
        if request.user.is_superuser or request.user.role == &#x27;dev&#x27;:
            return True
        perms_dict = UserPermission.get_user_permissions_dict(request.user, request.tenant)
        return perms_dict.get(&#x27;view_status_history&#x27;, False)</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\purchases\request_utils.py <span style="float:right">(6 linhas)</span></div>
                                <pre class="code-block">import threading
_thread_locals = threading.local()
def set_current_user(user):
    _thread_locals.user = user
def get_current_user():
    return getattr(_thread_locals, &quot;user&quot;, None)</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\purchases\serializers.py <span style="float:right">(105 linhas)</span></div>
                                <pre class="code-block">from rest_framework import serializers
from .models import Processo, Arquivo, LogUso, CRDII
from .models import StatusHistory
class CRDIISerializer(serializers.ModelSerializer):
    class Meta:
        model = CRDII
        fields = [&quot;id&quot;, &quot;nome&quot;, &quot;slug&quot;]
class ArquivoSerializer(serializers.ModelSerializer):
    criado_por = serializers.CharField(source=&quot;criado_por.username&quot;, read_only=True)
    arquivo_url = serializers.SerializerMethodField()
    class Meta:
        model = Arquivo
        fields = [
            &quot;id&quot;,
            &quot;processo&quot;,
            &quot;nome_original&quot;,
            &quot;nome_atual&quot;,
            &quot;arquivo&quot;,
            &quot;arquivo_url&quot;,
            &quot;data_upload&quot;,
            &quot;criado_por&quot;,
        ]
    def get_arquivo_url(self, obj):
        request = self.context.get(&quot;request&quot;)
        if obj.arquivo and request:
            return request.build_absolute_uri(obj.arquivo.url)
        return None
    def create(self, validated_data):
        user = self.context[&quot;request&quot;].user
        arquivo = Arquivo.objects.create(**validated_data, criado_por=user)
        return arquivo
class ProcessoSerializer(serializers.ModelSerializer):
    arquivos = ArquivoSerializer(many=True, read_only=True)
    criado_por = serializers.StringRelatedField(
        read_only=True, default=serializers.CurrentUserDefault()
    )
    crdii_nome = serializers.SerializerMethodField()
    arquivos_count = serializers.SerializerMethodField()
    data_status = serializers.SerializerMethodField()
    class Meta:
        model = Processo
        fields = [
            &quot;id&quot;,
            &quot;crdii&quot;,
            &quot;crdii_nome&quot;,
            &quot;nome&quot;,
            &quot;slug&quot;,
            &quot;criado_por&quot;,
            &quot;data_criacao&quot;,
            &quot;status&quot;,
            &quot;arquivos&quot;,
            &quot;arquivos_count&quot;,
            &quot;data_em_andamento&quot;,
            &quot;data_parcial&quot;,
            &quot;data_concluido&quot;,
            &quot;data_arquivado&quot;,
            &quot;data_cancelado&quot;,
            &quot;data_status&quot;,
        ]
    def get_crdii_nome(self, obj):
        return obj.crdii.nome if obj.crdii else None
    def get_arquivos_count(self, obj):
        return obj.arquivos.count()
    def get_data_status(self, obj):
        if obj.status == Processo.Status.CONCLUIDO:
            return obj.data_concluido
        if obj.status == Processo.Status.PARCIAL:
            return obj.data_parcial
        if obj.status == Processo.Status.NAO_CONCLUIDO:
            return obj.data_em_andamento
        if obj.status == Processo.Status.ARQUIVADO:
            return obj.data_arquivado
        if obj.status == Processo.Status.CANCELADO:
            return obj.data_cancelado
        return obj.data_criacao
    def validate(self, data):
        &quot;&quot;&quot;
        Verifica se já existe um processo com o mesmo nome no mesmo CRDII.
        &quot;&quot;&quot;
        nome = data.get(&quot;nome&quot;)
        crdii = data.get(&quot;crdii&quot;)
        if crdii and Processo.objects.filter(nome=nome, crdii=crdii).exists():
            raise serializers.ValidationError(
                f&quot;Já existe um processo com o nome &#x27;{nome}&#x27; no CRDII &#x27;{crdii.nome}&#x27;.&quot;
            )
        return data
class LogUsoSerializer(serializers.ModelSerializer):
    class Meta:
        model = LogUso
        fields = [&quot;id&quot;, &quot;usuario&quot;, &quot;acao&quot;, &quot;detalhe&quot;, &quot;data_hora&quot;]
class StatusHistorySerializer(serializers.ModelSerializer):
    usuario_nome = serializers.CharField(source=&#x27;usuario.username&#x27;, read_only=True, allow_null=True)
    status_anterior_display = serializers.CharField(source=&#x27;get_status_anterior_display&#x27;, read_only=True)
    status_novo_display = serializers.CharField(source=&#x27;get_status_novo_display&#x27;, read_only=True)
    class Meta:
        model = StatusHistory
        fields = [
            &#x27;id&#x27;,
            &#x27;usuario_nome&#x27;,
            &#x27;status_anterior&#x27;,
            &#x27;status_novo&#x27;,
            &#x27;status_anterior_display&#x27;,
            &#x27;status_novo_display&#x27;,
            &#x27;data_mudanca&#x27;,
        ]</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\purchases\signals.py <span style="float:right">(57 linhas)</span></div>
                                <pre class="code-block">from django.db.models.signals import pre_save, post_save
from django.dispatch import receiver
from django.utils.text import slugify
from django.utils import timezone
from .models import Processo, CRDII, StatusHistory
@receiver(pre_save, sender=CRDII)
def pre_save_crdii(sender, instance, **kwargs):
    &quot;&quot;&quot;
    Força o nome para maiúsculas e gera o slug se necessário.
    &quot;&quot;&quot;
    if instance.nome:
        instance.nome = instance.nome.upper()
    if not instance.slug and instance.nome:
        instance.slug = slugify(instance.nome.lower())
@receiver(pre_save, sender=Processo)
def pre_save_processo(sender, instance, **kwargs):
    &quot;&quot;&quot;
    Gerencia regras de negócio antes de salvar o Processo:
    1. Força nome para maiúsculas.
    2. Gera Slug.
    3. Atualiza timestamps baseados no Status.
    &quot;&quot;&quot;
    if instance.nome:
        instance.nome = instance.nome.upper()
    if not instance.slug:
        crdii_part = f&quot;{instance.crdii.nome} &quot; if instance.crdii else &quot;&quot;
        base_name = instance.nome or &quot;novo-processo&quot;
        base_slug = slugify(f&quot;{crdii_part}{base_name}&quot;)
        instance.slug = base_slug
    is_new = instance._state.adding
    status_changed = False
    if not is_new:
        try:
            old_instance = Processo.objects.get(pk=instance.pk)
            if instance.status != old_instance.status:
                status_changed = True
        except Processo.DoesNotExist:
            pass
    if is_new or status_changed:
        now = timezone.now()
        if instance.status == Processo.Status.NAO_CONCLUIDO:
            if not instance.data_em_andamento: # Evita sobrescrever se já existir (historicamente)
                 instance.data_em_andamento = now
        elif instance.status == Processo.Status.PARCIAL:
             if not instance.data_parcial:
                instance.data_parcial = now
        elif instance.status == Processo.Status.CONCLUIDO:
             if not instance.data_concluido:
                instance.data_concluido = now
        elif instance.status == Processo.Status.ARQUIVADO:
             if not instance.data_arquivado:
                instance.data_arquivado = now
        elif instance.status == Processo.Status.CANCELADO:
             if not instance.data_cancelado:
                instance.data_cancelado = now
    if is_new and not instance.data_em_andamento:
        instance.data_em_andamento = instance.data_criacao or timezone.now()</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\purchases\urls.py <span style="float:right">(24 linhas)</span></div>
                                <pre class="code-block">from django.urls import path, include
from rest_framework import routers
from .views import (
    DashboardStatsView,
    ComprasPorMesView,
    ProcessoViewSet,
    ArquivoViewSet,
    LogUsoViewSet,
    CRDIIViewSet,
)
router = routers.DefaultRouter()
router.register(r&quot;processos&quot;, ProcessoViewSet)
router.register(r&quot;crdiis&quot;, CRDIIViewSet) # Correção: Removido o basename desnecessário
router.register(r&quot;arquivos&quot;, ArquivoViewSet)
router.register(r&quot;logs&quot;, LogUsoViewSet)
urlpatterns = [
    path(&quot;&quot;, include(router.urls)),
    path(&quot;dashboard/stats/&quot;, DashboardStatsView.as_view(), name=&quot;dashboard-stats&quot;),
    path(
        &quot;dashboard/compras-por-mes/&quot;,
        ComprasPorMesView.as_view(),
        name=&quot;compras-por-mes&quot;,
    ),
]</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\purchases\views.py <span style="float:right">(338 linhas)</span></div>
                                <pre class="code-block">from rest_framework import viewsets, permissions, status
from rest_framework.decorators import action
from rest_framework.response import Response
from rest_framework.views import APIView
from rest_framework.permissions import IsAuthenticated
from rest_framework.filters import SearchFilter, OrderingFilter
from django_filters.rest_framework import DjangoFilterBackend
from rest_framework.pagination import PageNumberPagination
from django.core.exceptions import PermissionDenied
from django.db.models import Count, Q, F, Avg
from django.db.models.functions import TruncMonth
from django.utils import timezone
from datetime import datetime, timedelta
import traceback
from .models import CRDII, Arquivo, LogUso, Processo, StatusHistory
from users.models import UserPermission
from .permissions import CanViewStatusHistory, HasPermission
from .serializers import (
    ProcessoSerializer,
    ArquivoSerializer,
    LogUsoSerializer,
    CRDIISerializer,
    StatusHistorySerializer,
)
class StandardResultsSetPagination(PageNumberPagination):
    page_size = 20
    page_size_query_param = &#x27;page_size&#x27;
    max_page_size = 100
class CRDIIViewSet(viewsets.ModelViewSet):
    queryset = CRDII.objects.all()
    serializer_class = CRDIISerializer
    permission_classes = [IsAuthenticated]
    pagination_class = None
    def get_queryset(self):
        _user = self.request._user
        tenant = self.request.tenant
        if _user.is_superuser or _user.role in [&quot;dev&quot;]:
            return CRDII.objects.all().order_by(&quot;nome&quot;)
        permissions_dict = UserPermission.get_user_permissions_dict(_user, tenant)
        allowed_ids = permissions_dict.get(&#x27;allowed_crdii&#x27;, [])
        if not allowed_ids:
             return CRDII.objects.none()
        return CRDII.objects.filter(id__in=allowed_ids).order_by(&quot;nome&quot;)
    def perform_create(self, serializer):
        crdii = serializer.save()
        user = self.request.user
        tenant = self.request.tenant
        user_perm, created = UserPermission.objects.get_or_create(user=user, tenant=tenant)
        if user_perm.allowed_crdii is None:
            user_perm.allowed_crdii = []
        if crdii.id not in user_perm.allowed_crdii:
            user_perm.allowed_crdii.append(crdii.id)
            user_perm.save()
class ProcessoViewSet(viewsets.ModelViewSet):
    queryset = Processo.objects.all()
    serializer_class = ProcessoSerializer
    pagination_class = StandardResultsSetPagination
    filter_backends = [DjangoFilterBackend, SearchFilter, OrderingFilter]
    filterset_fields = [&#x27;status&#x27;, &#x27;crdii&#x27;, &#x27;criado_por&#x27;]
    search_fields = [&#x27;nome&#x27;, &#x27;crdii__nome&#x27;, &#x27;id&#x27;]
    ordering_fields = [&#x27;data_criacao&#x27;, &#x27;data_concluido&#x27;, &#x27;nome&#x27;]
    ordering = [&#x27;-data_criacao&#x27;]
    def get_permissions(self):
        if self.action == &#x27;create&#x27;:
            return [IsAuthenticated(), HasPermission(&#x27;can_create_processo&#x27;)]
        elif self.action in [&#x27;update&#x27;, &#x27;partial_update&#x27;]:
            return [IsAuthenticated(), HasPermission(&#x27;can_edit_processo&#x27;)]
        elif self.action == &#x27;destroy&#x27;:
            return [IsAuthenticated(), HasPermission(&#x27;can_delete_processo&#x27;)]
        else:
            return [IsAuthenticated()]
    def get_queryset(self):
        _user = self.request._user
        tenant = self.request.tenant
        if _user.is_superuser or _user.role in [&quot;dev&quot;]:
            return Processo.objects.prefetch_related(&quot;arquivos&quot;).all().order_by(&quot;-data_criacao&quot;)
        permissions_dict = UserPermission.get_user_permissions_dict(_user, tenant)
        allowed_ids = permissions_dict.get(&#x27;allowed_crdii&#x27;, [])
        return Processo.objects.prefetch_related(&quot;arquivos&quot;).filter(
            Q(crdii__id__in=allowed_ids) | Q(crdii__isnull=True)
        ).order_by(&quot;-data_criacao&quot;)
    def update(self, request, *args, **kwargs):
        _user = request._user
        processo = self.get_object()
        old_status = processo.status
        new_status = request.data.get(&quot;status&quot;)
        if new_status and _user.role == &quot;obra&quot;:
            current_status = processo.status
            if current_status in [Processo.Status.CANCELADO, Processo.Status.ARQUIVADO]:
                raise PermissionDenied(&quot;Processos cancelados ou arquivados não podem ser alterados pela Obra.&quot;)
            status_order = {
                Processo.Status.NAO_CONCLUIDO: 1,
                Processo.Status.PARCIAL: 2,
                Processo.Status.CONCLUIDO: 3,
            }
            current_order = status_order.get(current_status)
            new_order = status_order.get(new_status)          
            if current_order and new_order and new_order &lt; current_order:
                raise PermissionDenied(&quot;Usuários do tipo &#x27;Obra&#x27; não podem retroceder o status.&quot;)
        response = super().update(request, *args, **kwargs)
        if response.status_code == 200 and new_status and new_status != old_status:
            StatusHistory.objects.create(
                processo=processo,
                usuario=request.user,
                status_anterior=old_status,
                status_novo=new_status,
            )
        return response
    def perform_create(self, serializer):
        processo = serializer.save(criado_por=self.request.user)
        StatusHistory.objects.create(
            processo=processo,
            usuario=self.request.user,
            status_anterior=None,
            status_novo=processo.status,
        )
    @action(detail=True, methods=[&quot;post&quot;], permission_classes=[IsAuthenticated, HasPermission(&#x27;can_upload_file&#x27;)])
    def upload(self, request, pk=None):
        processo = self.get_object()
        f = request.FILES.get(&quot;file&quot;)
        nome = request.data.get(&quot;nome&quot;) or (f.name if f else &quot;&quot;)
        if not f:
            return Response({&quot;detail&quot;: &quot;Nenhum arquivo enviado.&quot;}, status=status.HTTP_400_BAD_REQUEST)
        arquivo = Arquivo.objects.create(
            processo=processo,
            nome_original=f.name,
            nome_atual=nome,
            arquivo=f,
            criado_por=request.user,
        )
        LogUso.objects.create(
            usuario=request.user,
            acao=&quot;upload&quot;,
            detalhe=f&quot;Upload arquivo {arquivo.nome_atual} no processo {processo.id}&quot;,
        )
        return Response(ArquivoSerializer(arquivo, context={&quot;request&quot;: request}).data, status=status.HTTP_201_CREATED)
    @action(detail=True, methods=[&#x27;get&#x27;], permission_classes=[IsAuthenticated, CanViewStatusHistory])
    def history(self, request, pk=None):
        processo = self.get_object()
        history_qs = processo.status_history.all().order_by(&#x27;-data_mudanca&#x27;)
        serializer = StatusHistorySerializer(history_qs, many=True, context={&#x27;request&#x27;: request})
        return Response(serializer.data)
class ArquivoViewSet(viewsets.ModelViewSet):
    queryset = Arquivo.objects.all()
    serializer_class = ArquivoSerializer
    def get_permissions(self):
        if self.action == &#x27;destroy&#x27;:
            return [IsAuthenticated(), HasPermission(&#x27;can_delete_file&#x27;)]
        return [IsAuthenticated()]
    @action(detail=True, methods=[&quot;post&quot;])
    def rename(self, request, pk=None):
        arquivo = self.get_object()
        novo_nome = request.data.get(&quot;nome&quot;)
        if not novo_nome:
            return Response({&quot;detail&quot;: &quot;Nome vazio&quot;}, status=status.HTTP_400_BAD_REQUEST)
        arquivo.nome_atual = novo_nome
        arquivo.save()
        LogUso.objects.create(
            usuario=request.user, acao=&quot;rename&quot;, detalhe=f&quot;Renomeou arquivo {arquivo.id} para {novo_nome}&quot;
        )
        return Response(ArquivoSerializer(arquivo, context={&quot;request&quot;: request}).data)
class LogUsoViewSet(viewsets.ReadOnlyModelViewSet):
    queryset = LogUso.objects.all().order_by(&quot;-data_hora&quot;)
    serializer_class = LogUsoSerializer
class DashboardStatsView(APIView):
    permission_classes = [IsAuthenticated]
    def get(self, request, *args, **kwargs):
        stats = {
            &#x27;total_processos&#x27;: 0, &#x27;concluidos&#x27;: 0, &#x27;em_andamento&#x27;: 0,
            &#x27;parcial&#x27;: 0, &#x27;arquivados&#x27;: 0, &#x27;cancelados&#x27;: 0
        }
        tempo_medio_dias = 0
        top_crdiis = []
        stagnant_count = 0
        top_users = []
        recent_activity = []
        chart_data = []
        try:
            year = request.query_params.get(&#x27;year&#x27;)
            month = request.query_params.get(&#x27;month&#x27;)
            crdii_id = request.query_params.get(&#x27;crdii&#x27;)
            _user = request.user
            tenant = request.tenant
            qs = Processo.objects.all()
            if not (_user.is_superuser or _user.role in [&quot;dev&quot;]):
                permissions_dict = UserPermission.get_user_permissions_dict(_user, tenant)
                allowed_ids = permissions_dict.get(&#x27;allowed_crdii&#x27;, [])
                qs = qs.filter(Q(crdii__id__in=allowed_ids) | Q(crdii__isnull=True))
            if year:
                qs = qs.filter(data_criacao__year=year)
            if month:
                qs = qs.filter(data_criacao__month=month)
            if crdii_id:
                 qs = qs.filter(crdii__id=crdii_id)
            try:
                stats = qs.aggregate(
                    total_processos=Count(&#x27;id&#x27;),
                    concluidos=Count(&#x27;id&#x27;, filter=Q(status=&#x27;concluido&#x27;)),
                    em_andamento=Count(&#x27;id&#x27;, filter=Q(status=&#x27;nao_concluido&#x27;)),
                    parcial=Count(&#x27;id&#x27;, filter=Q(status=&#x27;parcial&#x27;)),
                    arquivados=Count(&#x27;id&#x27;, filter=Q(status=&#x27;arquivado&#x27;)),
                    cancelados=Count(&#x27;id&#x27;, filter=Q(status=&#x27;cancelado&#x27;))
                )
            except Exception:
                print(&quot;Erro ao calcular stats gerais&quot;)
                traceback.print_exc()
            try:
                avg_time_qs = qs.filter(
                    status=Processo.Status.CONCLUIDO, 
                    data_concluido__isnull=False
                )
                avg_time = avg_time_qs.annotate(
                    duration=F(&#x27;data_concluido&#x27;) - F(&#x27;data_criacao&#x27;)
                ).aggregate(media=Avg(&#x27;duration&#x27;))[&#x27;media&#x27;]
                tempo_medio_dias = avg_time.days if avg_time else 0
            except Exception:
                print(&quot;Erro ao calcular tempo médio&quot;)
                traceback.print_exc()
            try:
                top_crdiis_qs = qs.values(&#x27;crdii__nome&#x27;).annotate(
                    total=Count(&#x27;id&#x27;)
                ).order_by(&#x27;-total&#x27;)[:5]
                top_crdiis = [
                    {&#x27;name&#x27;: item[&#x27;crdii__nome&#x27;] or &#x27;Sem CRDII&#x27;, &#x27;total&#x27;: item[&#x27;total&#x27;]} 
                    for item in top_crdiis_qs
                ]
            except Exception:
                print(&quot;Erro ao calcular top CRDIIs&quot;)
                traceback.print_exc()
            try:
                thirty_days_ago = timezone.now() - timedelta(days=30)
                stagnant_qs = qs.filter(
                    Q(status=Processo.Status.NAO_CONCLUIDO, data_em_andamento__lt=thirty_days_ago) |
                    Q(status=Processo.Status.PARCIAL, data_parcial__lt=thirty_days_ago)
                )
                stagnant_count = stagnant_qs.count()
            except Exception:
                print(&quot;Erro ao calcular estagnados&quot;)
                traceback.print_exc()
            try:
                top_users_qs = qs.values(&#x27;criado_por__username&#x27;).annotate(
                    total=Count(&#x27;id&#x27;)
                ).order_by(&#x27;-total&#x27;)[:5]
                top_users = [
                    {&#x27;username&#x27;: item[&#x27;criado_por__username&#x27;] or &#x27;Desconhecido&#x27;, &#x27;total&#x27;: item[&#x27;total&#x27;]}
                    for item in top_users_qs
                ]
            except Exception:
                print(&quot;Erro ao calcular top usuários&quot;)
                traceback.print_exc()
            try:
                recent_qs = StatusHistory.objects.filter(processo__in=qs).select_related(&#x27;usuario&#x27;, &#x27;processo&#x27;).order_by(&#x27;-data_mudanca&#x27;)[:20]
                recent_activity = [
                    {
                        &#x27;id&#x27;: h.id,
                        &#x27;usuario&#x27;: h.usuario.username if h.usuario else &#x27;Sistema&#x27;,
                        &#x27;processo&#x27;: f&quot;{h.processo.nome}&quot;,
                        &#x27;status_novo&#x27;: h.get_status_novo_display(),
                        &#x27;data&#x27;: h.data_mudanca
                    }
                    for h in recent_qs
                ]
            except Exception:
                print(&quot;Erro ao calcular atividade recente&quot;)
                traceback.print_exc()
            try:
                if year:
                    evolution_data = (
                        qs.annotate(month=TruncMonth(&#x27;data_criacao&#x27;))
                        .values(&#x27;month&#x27;)
                        .annotate(
                            criados=Count(&#x27;id&#x27;),
                            concluidos=Count(&#x27;id&#x27;, filter=Q(status=&#x27;concluido&#x27;))
                        )
                        .order_by(&#x27;month&#x27;)
                    )
                    chart_data = [
                        {
                            &quot;name&quot;: item[&#x27;month&#x27;].strftime(&quot;%b&quot;) if item[&#x27;month&#x27;] else &quot;N/A&quot;, 
                            &quot;criados&quot;: item[&#x27;criados&#x27;], 
                            &quot;concluidos&quot;: item[&#x27;concluidos&#x27;]
                        }
                        for item in evolution_data
                    ]
                else:
                    last_12_months = timezone.now() - timedelta(days=365)
                    evolution_qs = qs.filter(data_criacao__gte=last_12_months)
                    evolution_data = (
                        evolution_qs.annotate(month=TruncMonth(&#x27;data_criacao&#x27;))
                        .values(&#x27;month&#x27;)
                        .annotate(
                            criados=Count(&#x27;id&#x27;),
                            concluidos=Count(&#x27;id&#x27;, filter=Q(status=&#x27;concluido&#x27;))
                        )
                        .order_by(&#x27;month&#x27;)
                    )
                    chart_data = [
                        {
                            &quot;name&quot;: item[&#x27;month&#x27;].strftime(&quot;%b/%Y&quot;) if item[&#x27;month&#x27;] else &quot;N/A&quot;, 
                            &quot;criados&quot;: item[&#x27;criados&#x27;], 
                            &quot;concluidos&quot;: item[&#x27;concluidos&#x27;]
                        }
                        for item in evolution_data
                    ]
            except Exception:
                print(&quot;Erro ao calcular gráfico&quot;)
                traceback.print_exc()
            return Response({
                &#x27;stats&#x27;: stats,
                &#x27;extra_stats&#x27;: {
                    &#x27;tempo_medio_dias&#x27;: tempo_medio_dias,
                    &#x27;top_crdiis&#x27;: top_crdiis,
                    &#x27;stagnant_count&#x27;: stagnant_count,
                    &#x27;top_users&#x27;: top_users,
                    &#x27;recent_activity&#x27;: recent_activity,
                },
                &#x27;chart_data&#x27;: chart_data
            })
        except Exception as e:
            traceback.print_exc()
            return Response({&#x27;detail&#x27;: f&#x27;Erro crítico no Dashboard: {str(e)}&#x27;}, status=400)
class ComprasPorMesView(APIView):
    permission_classes = [IsAuthenticated]
    def get(self, request, *args, **kwargs):
        last_year = datetime.now() - timedelta(days=365)
        compras_data = (
            Processo.objects
            .filter(status=&#x27;concluido&#x27;, data_criacao__gte=last_year)
            .annotate(month=TruncMonth(&#x27;data_criacao&#x27;))
            .values(&#x27;month&#x27;)
            .annotate(total=Count(&#x27;id&#x27;))
            .order_by(&#x27;month&#x27;)
        )
        chart_data = [
            {&quot;name&quot;: item[&#x27;month&#x27;].strftime(&quot;%b/%Y&quot;), &quot;total&quot;: item[&#x27;total&#x27;]}
            for item in compras_data
        ]
        return Response(chart_data)</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\purchases\management\commands\sync_files.py <span style="float:right">(90 linhas)</span></div>
                                <pre class="code-block">import os
import time
from django.core.management.base import BaseCommand
from django.conf import settings
from users.models import CustomUser
from purchases.models import Processo, CRDII, Arquivo
class Command(BaseCommand):
    help = &#x27;Sincroniza arquivos e pastas do diretorio de midia com o banco de dados.&#x27;
    def handle(self, *args, **options):
        self.stdout.write(&quot;Iniciando o servico de sincronizacao de arquivos...&quot;)
        try:
            system_user = CustomUser.objects.get(username=&#x27;sistema&#x27;)
        except CustomUser.DoesNotExist:
            self.stderr.write(self.style.ERROR(
                &quot;Usuario &#x27;sistema&#x27; nao encontrado. Por favor, crie este usuario no Django Admin para continuar.&quot;
            ))
            self.stdout.write(&quot;Criando usuario &#x27;sistema&#x27; padrao...&quot;)
            system_user = CustomUser.objects.create_user(
                username=&#x27;sistema&#x27;,
                email=&#x27;sistema@localhost&#x27;,
                password=&#x27;a_senha_muito_forte_e_aleatoria_que_nao_sera_usada_para_login&#x27;,
                is_active=False # Este usuario nao deve poder fazer login
            )
            self.stdout.write(self.style.SUCCESS(&quot;Usuario &#x27;sistema&#x27; criado.&quot;))
        media_root = settings.MEDIA_ROOT
        while True:
            self.stdout.write(f&quot;[{time.ctime()}] Executando varredura...&quot;)
            crdiis_no_disco = set()
            processos_no_disco = set() 
            arquivos_no_disco = set()
            for crdii_name in os.listdir(media_root):
                crdii_path = os.path.join(media_root, crdii_name)
                if os.path.isdir(crdii_path):
                    crdii_obj, created = CRDII.objects.get_or_create(
                        nome__iexact=crdii_name,
                        defaults={&#x27;nome&#x27;: crdii_name.upper()}
                    )
                    if created:
                        self.stdout.write(self.style.SUCCESS(f&quot;CRDII criado: {crdii_obj.nome}&quot;))
                    crdiis_no_disco.add(crdii_obj.nome)
                    for processo_name in os.listdir(crdii_path):
                        processo_path = os.path.join(crdii_path, processo_name)
                        if os.path.isdir(processo_path):
                            processo_obj, created = Processo.objects.get_or_create(
                                nome__iexact=processo_name, # type: ignore
                                crdii=crdii_obj,
                                defaults={
                                    &#x27;nome&#x27;: processo_name.upper(),
                                    &#x27;criado_por&#x27;: system_user,
                                    &#x27;status&#x27;: Processo.Status.NAO_CONCLUIDO
                                }
                            )
                            if created:
                                self.stdout.write(self.style.SUCCESS(f&quot;  Processo criado: {processo_obj.nome}&quot;)) # type: ignore
                            processos_no_disco.add((crdii_obj.nome, processo_obj.nome))
                            for file_name in os.listdir(processo_path):
                                file_path = os.path.join(processo_path, file_name)
                                if os.path.isfile(file_path):
                                    relative_path = os.path.relpath(file_path, media_root)
                                    arquivos_no_disco.add(relative_path)
                                    if not Arquivo.objects.filter(arquivo__iexact=relative_path).exists():
                                        Arquivo.objects.create(
                                            processo=processo_obj,
                                            nome_original=file_name,
                                            nome_atual=file_name,
                                            arquivo=relative_path,
                                            criado_por=system_user
                                        )
                                        self.stdout.write(self.style.SUCCESS(f&quot;    Arquivo sincronizado: {file_name}&quot;))
            crdiis_no_db = set(CRDII.objects.values_list(&#x27;nome&#x27;, flat=True))
            crdiis_para_remover = crdiis_no_db - crdiis_no_disco
            if crdiis_para_remover:
                removidos, _ = CRDII.objects.filter(nome__in=crdiis_para_remover).delete()
                self.stdout.write(self.style.WARNING(f&quot;Removidos {removidos} CRDIIs orfaos do banco de dados.&quot;))
            processos_no_db = set(Processo.objects.select_related(&#x27;crdii&#x27;).values_list(&#x27;crdii__nome&#x27;, &#x27;nome&#x27;))
            processos_para_remover = processos_no_db - processos_no_disco
            if processos_para_remover:
                count = 0
                for crdii_nome, processo_nome in processos_para_remover:
                    deletados, _ = Processo.objects.filter(crdii__nome=crdii_nome, nome=processo_nome).delete()
                    count += deletados
                if count &gt; 0:
                    self.stdout.write(self.style.WARNING(f&quot;Removidos {count} Processos orfaos do banco de dados.&quot;))
            arquivos_no_db = set(Arquivo.objects.values_list(&#x27;arquivo&#x27;, flat=True))
            arquivos_para_remover = arquivos_no_db - arquivos_no_disco
            if arquivos_para_remover:
                arquivos_removidos, _ = Arquivo.objects.filter(arquivo__in=arquivos_para_remover).delete()
                self.stdout.write(self.style.WARNING(f&quot;Removidos {arquivos_removidos} registros de arquivos orfao do banco de dados.&quot;))
            self.stdout.write(f&quot;[{time.ctime()}] Varredura concluida. Proxima execucao em 15 minutos.&quot;)
            time.sleep(900) # 15 minutos</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\tenants\admin.py <span style="float:right">(4 linhas)</span></div>
                                <pre class="code-block">from django.contrib import admin
from .models import Empresa, Dominio
admin.site.register(Empresa)
admin.site.register(Dominio)</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\tenants\apps.py <span style="float:right">(4 linhas)</span></div>
                                <pre class="code-block">from django.apps import AppConfig
class TenantsConfig(AppConfig):
    default_auto_field = &#x27;django.db.models.BigAutoField&#x27;
    name = &#x27;tenants&#x27;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\tenants\models.py <span style="float:right">(10 linhas)</span></div>
                                <pre class="code-block">from django.db import models
from django_tenants.models import TenantMixin, DomainMixin
class Empresa(TenantMixin):
    nome = models.CharField(max_length=100, unique=True)
    criado_em = models.DateField(auto_now_add=True)
    auto_create_schema = True
    def __str__(self):
        return self.nome
class Dominio(DomainMixin):
    pass</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\tenants\permissions.py <span style="float:right">(16 linhas)</span></div>
                                <pre class="code-block">from rest_framework.permissions import BasePermission
class CanCreateDeleteTenants(BasePermission):
    &quot;&quot;&quot;
    Permissão personalizada para verificar se um usuário pode criar ou deletar empresas (tenants).
    A criação/deleção de tenants são ações &#x27;globais&#x27; que ocorrem fora do contexto 
    de um tenant específico (no schema &#x27;public&#x27;). Portanto, esta permissão se baseia
    em uma flag direta no modelo do usuário, em vez de uma permissão dentro de um tenant.
    &quot;&quot;&quot;
    message = &quot;Você não tem permissão para criar ou excluir empresas.&quot;
    def has_permission(self, request, view):
        user = request.user
        if not user or not user.is_authenticated:
            return False
        if user.is_superuser:
            return True
        return getattr(user, &#x27;can_create_tenant&#x27;, False)</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\tenants\serializers.py <span style="float:right">(35 linhas)</span></div>
                                <pre class="code-block">from rest_framework import serializers
from .models import Empresa, Dominio
import re
class TenantSerializer(serializers.ModelSerializer):
    domain_url = serializers.CharField(write_only=True, required=True)
    domain = serializers.SerializerMethodField()
    class Meta:
        model = Empresa
        fields = [&#x27;id&#x27;, &#x27;nome&#x27;, &#x27;schema_name&#x27;, &#x27;domain_url&#x27;, &#x27;domain&#x27;, &#x27;criado_em&#x27;]
        read_only_fields = [&#x27;id&#x27;, &#x27;criado_em&#x27;, &#x27;domain&#x27;]
    def get_domain(self, obj):
        &quot;&quot;&quot;
        Retorna o domínio primário da empresa de forma otimizada.
        Este método depende que a ViewSet que o chama tenha usado &#x27;prefetch_related&#x27;
        com o to_attr=&#x27;primary_domain_list&#x27; no queryset.
        &quot;&quot;&quot;
        if hasattr(obj, &#x27;primary_domain_list&#x27;) and obj.primary_domain_list:
            return obj.primary_domain_list[0].domain
        return None
    def validate_schema_name(self, value):
        value = value.lower().replace(&#x27; &#x27;, &#x27;_&#x27;)
        if not re.match(r&#x27;^[a-z0-9_]+$&#x27;, value):
            raise serializers.ValidationError(&quot;O schema deve ter apenas letras minúsculas, números e underlines.&quot;)
        if Empresa.objects.filter(schema_name=value).exists():
            raise serializers.ValidationError(&quot;Este nome de schema já está em uso.&quot;)
        return value
    def create(self, validated_data):
        domain_url = validated_data.pop(&#x27;domain_url&#x27;)
        empresa = Empresa.objects.create(**validated_data)
        Dominio.objects.create(
            domain=domain_url,
            tenant=empresa,
            is_primary=True
        )
        return empresa</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\tenants\urls.py <span style="float:right">(8 linhas)</span></div>
                                <pre class="code-block">from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .views import TenantViewSet
router = DefaultRouter()
router.register(r&#x27;tenants&#x27;, TenantViewSet, basename=&#x27;tenant&#x27;)
urlpatterns = [
    path(&#x27;&#x27;, include(router.urls)),
]</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\tenants\views.py <span style="float:right">(64 linhas)</span></div>
                                <pre class="code-block">from rest_framework import viewsets, status
from rest_framework.response import Response
from rest_framework.permissions import IsAuthenticated
from rest_framework.exceptions import APIException
from django.db import transaction
from django.db.models import Prefetch
from django_tenants.utils import schema_context
from .models import Empresa, Dominio
from .serializers import TenantSerializer
from .permissions import CanCreateDeleteTenants
class TenantViewSet(viewsets.ModelViewSet):
    serializer_class = TenantSerializer
    def get_queryset(self):
        &quot;&quot;&quot;
        Sobrescreve o queryset padrão para retornar apenas as empresas
        associadas ao usuário logado, e otimiza a busca de domínios.
        &quot;&quot;&quot;
        try:
            user = self.request.user
            if not user or not user.is_authenticated:
                return Empresa.objects.none()
            domain_prefetch = Prefetch(
                &#x27;domains&#x27;,
                queryset=Dominio.objects.filter(is_primary=True),
                to_attr=&#x27;primary_domain_list&#x27; # Armazena o resultado em um novo atributo
            )
            if user.is_superuser:
                return Empresa.objects.prefetch_related(domain_prefetch).all().order_by(&#x27;-criado_em&#x27;)
            return user.tenants.prefetch_related(domain_prefetch).order_by(&#x27;-criado_em&#x27;)
        except Exception as e:
            raise APIException(f&quot;Erro ao processar a lista de empresas: {type(e).__name__} - {e}&quot;)
    def get_permissions(self):
        &quot;&quot;&quot;
        Sobrescreve para usar permissões diferentes baseadas na ação.
        &quot;&quot;&quot;
        if self.action in [&#x27;create&#x27;, &#x27;destroy&#x27;]:
            self.permission_classes = [CanCreateDeleteTenants]
        else:
            self.permission_classes = [IsAuthenticated]
        return super().get_permissions()
    @transaction.atomic
    def create(self, request, *args, **kwargs):
        with schema_context(&#x27;public&#x27;):
            serializer = self.get_serializer(data=request.data)
            serializer.is_valid(raise_exception=True)
            try:
                empresa = serializer.save()
                empresa.users.add(request.user)
                headers = self.get_success_headers(serializer.data)
                return Response(
                    serializer.data, 
                    status=status.HTTP_201_CREATED, 
                    headers=headers
                )
            except Exception as e:
                return Response(
                    {&quot;detail&quot;: f&quot;Erro ao criar empresa: {str(e)}&quot;}, 
                    status=status.HTTP_400_BAD_REQUEST
                )
    def destroy(self, request, *args, **kwargs):
        with schema_context(&#x27;public&#x27;):
            instance = self.get_object()
            self.perform_destroy(instance)
        return Response(status=status.HTTP_204_NO_CONTENT)</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\users\admin.py <span style="float:right">(15 linhas)</span></div>
                                <pre class="code-block">from django.contrib import admin
from django.contrib.auth.admin import UserAdmin
from .models import CustomUser, UserPermission
class CustomUserAdmin(UserAdmin):
    model = CustomUser
    filter_horizontal = (&#x27;tenants&#x27;, &#x27;groups&#x27;, &#x27;user_permissions&#x27;,)
    list_display = (&#x27;username&#x27;, &#x27;email&#x27;, &#x27;first_name&#x27;, &#x27;last_name&#x27;, &#x27;is_staff&#x27;, &#x27;role&#x27;)
    fieldsets = UserAdmin.fieldsets + (
        (&#x27;Papel e Empresas&#x27;, {&#x27;fields&#x27;: (&#x27;role&#x27;, &#x27;tenants&#x27;)}),
    )
admin.site.register(CustomUser, CustomUserAdmin)
@admin.register(UserPermission)
class UserPermissionAdmin(admin.ModelAdmin):
    list_display = (&#x27;user&#x27;,)
    search_fields = (&#x27;user__username&#x27;,)</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\users\apps.py <span style="float:right">(4 linhas)</span></div>
                                <pre class="code-block">from django.apps import AppConfig
class UsersConfig(AppConfig):
    default_auto_field = &quot;django.db.models.BigAutoField&quot;
    name = &quot;users&quot;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\users\authentication.py <span style="float:right">(12 linhas)</span></div>
                                <pre class="code-block">from rest_framework_simplejwt.authentication import JWTAuthentication
class CookieJWTAuthentication(JWTAuthentication):
    def authenticate(self, request):
        header = self.get_header(request)
        if header is not None:
            raw_token = self.get_raw_token(header)
        else:
            raw_token = request.COOKIES.get(&#x27;access_token&#x27;)
        if raw_token is None:
            return None
        validated_token = self.get_validated_token(raw_token)
        return self.get_user(validated_token), validated_token</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\users\models.py <span style="float:right">(178 linhas)</span></div>
                                <pre class="code-block">from django.contrib.auth.models import AbstractUser
from django.db import models
class CustomUser(AbstractUser):
    ROLE_CHOICES = (
        (&quot;administrador&quot;, &quot;Administrador&quot;),
        (&quot;gestor&quot;, &quot;Gestor&quot;),
        (&quot;diretoria&quot;, &quot;Diretoria&quot;),
        (&quot;compras&quot;, &quot;Compras&quot;),
        (&quot;obra&quot;, &quot;Obras&quot;),
        (&quot;financeiro&quot;, &quot;Financeiro&quot;),
        (&quot;dev&quot;, &quot;Desenvolvedor&quot;),
    )
    role = models.CharField(
       max_length=15, choices=ROLE_CHOICES, default=&quot;dev&quot;, verbose_name=&quot;Papel&quot;
    )
    tenants = models.ManyToManyField(
        &quot;tenants.Empresa&quot;, blank=True, related_name=&quot;users&quot;, verbose_name=&quot;Empresas&quot;
    )
    can_create_tenant = models.BooleanField(
        default=False, verbose_name=&quot;Pode Criar Empresas&quot;
    )
    def save(self, *args, **kwargs):
        if self.role == &quot;dev&quot;:
            self.is_staff = True
            self.is_superuser = True
        else:
            self.is_staff = False
            self.is_superuser = False
        super().save(*args, **kwargs)
    class Meta:
        permissions = [
            (&quot;page_dashboard&quot;, &quot;Pode visualizar a página Dashboard&quot;),
            (&quot;page_compras&quot;, &quot;Pode visualizar a página de Processos&quot;),
            (&quot;page_admin&quot;, &quot;Pode visualizar a página de Administração (Usuários)&quot;),
            (&quot;can_create_processo&quot;, &quot;Pode criar novos processos&quot;),
            (&quot;can_edit_processo&quot;, &quot;Pode editar processos existentes&quot;),
            (&quot;can_delete_processo&quot;, &quot;Pode excluir processos&quot;),
            (&quot;can_change_status&quot;, &quot;Pode alterar o status de um processo&quot;),
            (&quot;can_upload_file&quot;, &quot;Pode fazer upload de arquivos&quot;),
            (&quot;can_delete_file&quot;, &quot;Pode excluir arquivos&quot;),
            (&quot;can_edit_user&quot;, &quot;Pode editar outros usuários&quot;),
        ]
class UserPermission(models.Model):
    user = models.ForeignKey(
        CustomUser, on_delete=models.CASCADE, related_name=&quot;permissions&quot;
    )
    tenant = models.ForeignKey(
        &quot;tenants.Empresa&quot;, 
        on_delete=models.CASCADE, 
        related_name=&quot;user_permissions&quot;,
        verbose_name=&quot;Empresa&quot;
    )
    page_dashboard = models.BooleanField(default=True)
    page_compras = models.BooleanField(default=True)
    gerenciar = models.JSONField(default=dict, null=True, blank=True)
    relatorios = models.JSONField(default=dict, null=True, blank=True)
    can_create_processo = models.BooleanField(default=False)
    can_edit_processo = models.BooleanField(default=False)
    can_delete_processo = models.BooleanField(default=False)
    can_change_status = models.BooleanField(default=False)
    can_upload_file = models.BooleanField(default=False)
    can_delete_file = models.BooleanField(default=False)
    can_edit_user = models.BooleanField(default=False)
    can_delete_user = models.BooleanField(default=False) # Nova permissão
    view_status_history = models.BooleanField(default=False)
    status_limits = models.JSONField(default=dict, null=True, blank=True)
    allowed_crdii = models.JSONField(default=list, null=True, blank=True)
    class Meta:
        unique_together = (&quot;user&quot;, &quot;tenant&quot;)
        verbose_name = &quot;Permissão de Usuário&quot;
        verbose_name_plural = &quot;Permissões de Usuários&quot;
    def __str__(self):
        return f&quot;Permissões de {self.user.username} em {self.tenant.nome}&quot;
    @staticmethod
    def get_default_permissions():
        &quot;&quot;&quot;
        Retorna um dicionário com as permissões padrão para um novo usuário.
        &quot;&quot;&quot;
        return {
            &quot;page_dashboard&quot;: True,
            &quot;page_compras&quot;: True,
            &quot;gerenciar&quot;: {&quot;usuarios&quot;: False, &quot;empresas&quot;: False, &quot;crdiis&quot;: False},
            &quot;relatorios&quot;: {
                &quot;geral&quot;: False,
                &quot;financeiro&quot;: False,
            },
            &quot;can_create_processo&quot;: False,
            &quot;can_edit_processo&quot;: False,
            &quot;can_delete_processo&quot;: False,
            &quot;can_change_status&quot;: False,
            &quot;can_upload_file&quot;: False,
            &quot;can_delete_file&quot;: False,
            &quot;can_edit_user&quot;: False,
            &quot;can_delete_user&quot;: False,
            &quot;view_status_history&quot;: False,
            &quot;status_limits&quot;: {},
            &quot;allowed_crdii&quot;: [],
        }
    @staticmethod
    def get_user_permissions_dict(user, tenant):
        &quot;&quot;&quot;
        Retorna um dicionário com as permissões de um usuário no contexto de um tenant.
        Se o usuário for superusuário, concede todas as permissões.
        &quot;&quot;&quot;
        if user.is_superuser:
            all_permissions = UserPermission.get_default_permissions()
            all_permissions[&quot;can_delete_user&quot;] = True  # Superuser pode deletar
            for key in all_permissions:
                if key not in [&quot;status_limits&quot;, &quot;allowed_crdii&quot;, &quot;relatorios&quot;, &quot;gerenciar&quot;]:
                    all_permissions[key] = True
                elif key == &quot;status_limits&quot;:
                    all_permissions[key] = {
                        &quot;nao_concluido&quot;: True,
                        &quot;parcial&quot;: True,
                        &quot;concluido&quot;: True,
                        &quot;arquivado&quot;: True,
                        &quot;cancelado&quot;: True,
                    }
                elif key == &quot;gerenciar&quot;:
                    all_permissions[key] = {
                        &quot;usuarios&quot;: True,
                        &quot;empresas&quot;: True,
                        &quot;crdiis&quot;: True,
                    }
                elif key == &quot;relatorios&quot;:
                    all_permissions[key] = {
                        &quot;geral&quot;: True,
                        &quot;financeiro&quot;: True,
                    }
                elif key == &quot;allowed_crdii&quot;:
                    all_permissions[key] = []
            return all_permissions
        try:
            permissions = UserPermission.objects.get(user=user, tenant=tenant)
            perms_data = UserPermission.get_default_permissions()
            saved_data = {
                &quot;page_dashboard&quot;: permissions.page_dashboard,
                &quot;page_compras&quot;: permissions.page_compras,
                &quot;can_create_processo&quot;: permissions.can_create_processo,
                &quot;can_edit_processo&quot;: permissions.can_edit_processo,
                &quot;can_delete_processo&quot;: permissions.can_delete_processo,
                &quot;can_change_status&quot;: permissions.can_change_status,
                &quot;can_upload_file&quot;: permissions.can_upload_file,
                &quot;can_delete_file&quot;: permissions.can_delete_file,
                &quot;can_edit_user&quot;: permissions.can_edit_user,
                &quot;can_delete_user&quot;: permissions.can_delete_user,
                &quot;view_status_history&quot;: permissions.view_status_history,
                &quot;allowed_crdii&quot;: permissions.allowed_crdii,
            }
            if hasattr(permissions, &#x27;gerenciar&#x27;) and isinstance(permissions.gerenciar, dict):
                perms_data[&#x27;gerenciar&#x27;].update(permissions.gerenciar)
                saved_data[&#x27;gerenciar&#x27;] = perms_data[&#x27;gerenciar&#x27;]
            if hasattr(permissions, &#x27;relatorios&#x27;) and isinstance(permissions.relatorios, dict):
                perms_data[&#x27;relatorios&#x27;].update(permissions.relatorios)
                saved_data[&#x27;relatorios&#x27;] = perms_data[&#x27;relatorios&#x27;]
            if hasattr(permissions, &#x27;status_limits&#x27;) and isinstance(permissions.status_limits, dict):
                perms_data[&#x27;status_limits&#x27;].update(permissions.status_limits)
                saved_data[&#x27;status_limits&#x27;] = perms_data[&#x27;status_limits&#x27;]
            perms_data.update(saved_data)
            return perms_data
        except (UserPermission.DoesNotExist, AttributeError):
            return UserPermission.get_default_permissions()
    @staticmethod
    def update_user_permissions(user, tenant, permissions_data):
        &quot;&quot;&quot;
        Atualiza ou cria as permissões de um usuário para um tenant específico.
        &quot;&quot;&quot;
        defaults = {}
        model_fields = [f.name for f in UserPermission._meta.get_fields()]
        for key, value in permissions_data.items():
            if key in model_fields and key not in [&#x27;user&#x27;, &#x27;tenant&#x27;, &#x27;id&#x27;]:
                defaults[key] = value
        obj, created = UserPermission.objects.update_or_create(
            user=user,
            tenant=tenant,
            defaults=defaults
        )
        return obj</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\users\permissions.py <span style="float:right">(57 linhas)</span></div>
                                <pre class="code-block">from rest_framework.permissions import BasePermission
from .models import UserPermission
ROLE_HIERARCHY = {
    &quot;dev&quot;: 100,
    &quot;diretoria&quot;: 90,
    &quot;gestor&quot;: 90,
    &quot;administrador&quot;: 70,
    &quot;financeiro&quot;: 60,
    &quot;compras&quot;: 50,
    &quot;obra&quot;: 10,
}
class IsAdminUser(BasePermission):
    &quot;&quot;&quot;
    Define quem pode ACESSAR a rota de usuários (Listar/Ver).
    &quot;&quot;&quot;
    def has_permission(self, request, view):
        if not request.user or not request.user.is_authenticated:
            return False
        perms = UserPermission.get_user_permissions_dict(request.user, request.tenant)
        can_access_page = perms.get(&quot;gerenciar&quot;, {}).get(&quot;usuarios&quot;, False)
        return (
            request.user.is_superuser 
            or request.user.role == &quot;dev&quot;
            or can_access_page
        )
class CanManageUser(BasePermission):
    &quot;&quot;&quot;
    Define quem pode CRIAR, EDITAR ou EXCLUIR usuários.
    &quot;&quot;&quot;
    def has_permission(self, request, view):
        if request.user.role == &quot;dev&quot;:
            return True
        perms = UserPermission.get_user_permissions_dict(request.user, request.tenant)
        if not perms.get(&quot;can_edit_user&quot;, False):
            return False
        if view.action == &quot;create&quot;:
            requesting_user_level = ROLE_HIERARCHY.get(request.user.role, 0)
            target_role = request.data.get(&quot;role&quot;)
            if target_role:
                target_level = ROLE_HIERARCHY.get(target_role, 0)
                if target_level &gt; requesting_user_level:
                    return False
        return True
    def has_object_permission(self, request, view, obj):
        requesting_user = request.user
        if requesting_user.role == &quot;dev&quot;:
            return True
        if obj.role == &quot;dev&quot;:
            return False
        requesting_user_level = ROLE_HIERARCHY.get(requesting_user.role, 0)
        target_user_level = ROLE_HIERARCHY.get(obj.role, 0)
        if target_user_level &gt; requesting_user_level:
            return False
        perms = UserPermission.get_user_permissions_dict(requesting_user, request.tenant)
        if view.action == &#x27;destroy&#x27;:
            return perms.get(&quot;can_delete_user&quot;, False)
        return perms.get(&quot;can_edit_user&quot;, False)</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\users\serializers.py <span style="float:right">(97 linhas)</span></div>
                                <pre class="code-block">from rest_framework import serializers
from rest_framework_simplejwt.serializers import TokenObtainPairSerializer
from django.contrib.auth.models import Group
from django.contrib.auth.hashers import make_password
from .models import CustomUser, UserPermission
from tenants.models import Empresa
from tenants.serializers import TenantSerializer
class MyTokenObtainPairSerializer(TokenObtainPairSerializer):
    tenant_schema_name = serializers.CharField(write_only=True, required=False)
    @classmethod
    def get_token(cls, user):
        token = super().get_token(user)
        token[&quot;username&quot;] = user.username
        token[&quot;role&quot;] = user.role
        return token
    def validate(self, attrs):
        data = super().validate(attrs)
        tenant_schema_name = attrs.get(&#x27;tenant_schema_name&#x27;)
        user_tenants = self.user.tenants.all()
        tenant_count = user_tenants.count()
        selected_tenant = None
        if tenant_schema_name:
            try:
                selected_tenant = user_tenants.get(schema_name=tenant_schema_name)
            except Empresa.DoesNotExist:
                if self.user.is_superuser:
                    try:
                        selected_tenant = Empresa.objects.get(schema_name=tenant_schema_name)
                    except Empresa.DoesNotExist:
                         raise serializers.ValidationError({&quot;detail&quot;: &quot;Empresa não encontrada.&quot;})
                else:
                    raise serializers.ValidationError({&quot;detail&quot;: &quot;Você não tem permissão nesta empresa.&quot;})
        else:
            if tenant_count == 0:
                if self.user.is_superuser:
                    try:
                        selected_tenant = Empresa.objects.get(schema_name=&#x27;public&#x27;)
                    except Empresa.DoesNotExist:
                        pass # Segue sem tenant (modo global restrito)
                else:
                    raise serializers.ValidationError({&quot;detail&quot;: &quot;Seu usuário não está vinculado a nenhuma empresa.&quot;})
            elif tenant_count == 1:
                selected_tenant = user_tenants.first()
            else:
                return {
                    &#x27;action&#x27;: &#x27;select_tenant&#x27;, 
                    &#x27;tenants&#x27;: [
                        {&#x27;schema_name&#x27;: t.schema_name, &#x27;nome&#x27;: t.nome} 
                        for t in user_tenants
                    ]
                }
        if selected_tenant:
            data[&#x27;tenant&#x27;] = {
                &#x27;schema_name&#x27;: selected_tenant.schema_name,
                &#x27;nome&#x27;: selected_tenant.nome,
            }
        return data
class LoggedInUserSerializer(serializers.ModelSerializer):
    permissions = serializers.SerializerMethodField()
    class Meta:
        model = CustomUser
        fields = [&quot;id&quot;, &quot;username&quot;, &quot;email&quot;, &quot;role&quot;, &quot;is_superuser&quot;, &quot;permissions&quot;]
    def get_permissions(self, obj):
        request = self.context.get(&#x27;request&#x27;)
        tenant = getattr(request, &#x27;tenant&#x27;, None)
        if not tenant:
            permissions = UserPermission.get_default_permissions()
        else:
            permissions = UserPermission.get_user_permissions_dict(obj, tenant)
        permissions[&#x27;can_create_tenant&#x27;] = obj.can_create_tenant
        if &#x27;can_delete_user&#x27; not in permissions:
             permissions[&#x27;can_delete_user&#x27;] = False # Garante que a chave exista
        return permissions
class UserSerializer(serializers.ModelSerializer):
    tenants = TenantSerializer(many=True, read_only=True)
    groups = serializers.SlugRelatedField(many=True, queryset=Group.objects.all(), slug_field=&quot;name&quot;)
    class Meta:
        model = CustomUser
        fields = [
            &quot;id&quot;, &quot;username&quot;, &quot;email&quot;, &quot;role&quot;, &quot;first_name&quot;, &quot;last_name&quot;,
            &quot;is_active&quot;, &quot;is_staff&quot;, &quot;is_superuser&quot;, &quot;groups&quot;, &quot;tenants&quot;, 
            &quot;can_create_tenant&quot;,
        ]
        read_only_fields = [&quot;is_staff&quot;, &quot;is_superuser&quot;, &quot;groups&quot;, &quot;tenants&quot;]
class UserCreateSerializer(serializers.ModelSerializer):
    class Meta:
        model = CustomUser
        fields = [
            &quot;username&quot;, &quot;email&quot;, &quot;password&quot;, &quot;role&quot;, &quot;is_active&quot;,
            &quot;first_name&quot;, &quot;last_name&quot;
        ]
        extra_kwargs = {&quot;password&quot;: {&quot;write_only&quot;: True}}
    def validate_password(self, value: str) -&gt; str:
        return make_password(value)
    def create(self, validated_data):
        user = CustomUser.objects.create(**validated_data)
        return user</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\users\signals.py <span style="float:right">(10 linhas)</span></div>
                                <pre class="code-block">from django.db.models.signals import post_save
from django.dispatch import receiver
from .models import CustomUser, UserPermission
@receiver(post_save, sender=CustomUser)
def create_user_permission(sender, instance, created, **kwargs):
    &quot;&quot;&quot;
    Cria um objeto UserPermission automaticamente para cada novo CustomUser.
    &quot;&quot;&quot;
    if created:
        UserPermission.objects.create(user=instance)</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\users\throttles.py <span style="float:right">(6 linhas)</span></div>
                                <pre class="code-block">from rest_framework.throttling import AnonRateThrottle
class CheckTenantThrottle(AnonRateThrottle):
    rate = &#x27;5/min&#x27; # Permite apenas 5 tentativas por minuto por IP
class LoginRateThrottle(AnonRateThrottle):
    scope = &#x27;login&#x27;
    rate = &#x27;5/min&#x27;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\users\urls.py <span style="float:right">(11 linhas)</span></div>
                                <pre class="code-block">from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .views import CookieTokenObtainPairView, UserManagementViewSet, CurrentUserView, LogoutView
router = DefaultRouter()
router.register(r&quot;users&quot;, UserManagementViewSet, basename=&quot;users&quot;)
urlpatterns = [
    path(&quot;login/&quot;, CookieTokenObtainPairView.as_view(), name=&quot;token_obtain_pair&quot;),
    path(&quot;logout/&quot;, LogoutView.as_view(), name=&quot;logout&quot;),
    path(&quot;me/&quot;, CurrentUserView.as_view(), name=&quot;current-user&quot;),
    path(&quot;&quot;, include(router.urls)),
]</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">backend\users\views.py <span style="float:right">(154 linhas)</span></div>
                                <pre class="code-block">from rest_framework import viewsets, status
from rest_framework.decorators import action
from rest_framework.response import Response
from rest_framework.views import APIView
from rest_framework.permissions import IsAuthenticated
from django.core.exceptions import PermissionDenied, ObjectDoesNotExist
from rest_framework_simplejwt.views import TokenObtainPairView, TokenRefreshView
from django.conf import settings
from .models import CustomUser, UserPermission
from .permissions import CanManageUser, IsAdminUser, ROLE_HIERARCHY
from .serializers import (
    UserSerializer,
    UserCreateSerializer,
    LoggedInUserSerializer,
    MyTokenObtainPairSerializer,
)
from .throttles import LoginRateThrottle
class CookieTokenObtainPairView(TokenObtainPairView):
    serializer_class = MyTokenObtainPairSerializer
    throttle_classes = [LoginRateThrottle]
    def post(self, request, *args, **kwargs):
        response = super().post(request, *args, **kwargs)
        if response.status_code == 200:
            access_token = response.data.get(&#x27;access&#x27;)
            refresh_token = response.data.get(&#x27;refresh&#x27;)
            if access_token:
                response.set_cookie(
                    &#x27;access_token&#x27;,
                    access_token,
                    httponly=True,
                    secure=not settings.DEBUG,
                    samesite=&#x27;Lax&#x27;,
                    max_age=int(settings.SIMPLE_JWT[&#x27;ACCESS_TOKEN_LIFETIME&#x27;].total_seconds())
                )
            if refresh_token:
                response.set_cookie(
                    &#x27;refresh_token&#x27;,
                    refresh_token,
                    httponly=True,
                    secure=not settings.DEBUG,
                    samesite=&#x27;Lax&#x27;,
                    max_age=int(settings.SIMPLE_JWT[&#x27;REFRESH_TOKEN_LIFETIME&#x27;].total_seconds())
                )
        return response
class CookieTokenRefreshView(TokenRefreshView):
    throttle_classes = [LoginRateThrottle]
    def post(self, request, *args, **kwargs):
        refresh_token = request.COOKIES.get(&#x27;refresh_token&#x27;)
        if refresh_token and &#x27;refresh&#x27; not in request.data:
            if hasattr(request.data, &#x27;_mutable&#x27;):
                request.data._mutable = True
                request.data[&#x27;refresh&#x27;] = refresh_token
                request.data._mutable = False
            else:
                request.data[&#x27;refresh&#x27;] = refresh_token
        response = super().post(request, *args, **kwargs)
        if response.status_code == 200:
            access_token = response.data.get(&#x27;access&#x27;)
            refresh_token = response.data.get(&#x27;refresh&#x27;) # Pode vir se ROTATE_REFRESH_TOKENS=True
            if access_token:
                response.set_cookie(
                    &#x27;access_token&#x27;,
                    access_token,
                    httponly=True,
                    secure=not settings.DEBUG,
                    samesite=&#x27;Lax&#x27;,
                    max_age=int(settings.SIMPLE_JWT[&#x27;ACCESS_TOKEN_LIFETIME&#x27;].total_seconds())
                )
            if refresh_token:
                response.set_cookie(
                    &#x27;refresh_token&#x27;,
                    refresh_token,
                    httponly=True,
                    secure=not settings.DEBUG,
                    samesite=&#x27;Lax&#x27;,
                    max_age=int(settings.SIMPLE_JWT[&#x27;REFRESH_TOKEN_LIFETIME&#x27;].total_seconds())
                )
        return response
class LogoutView(APIView):
    permission_classes = [] 
    def post(self, request):
        response = Response({&quot;message&quot;: &quot;Logged out successfully&quot;})
        response.delete_cookie(&#x27;access_token&#x27;)
        response.delete_cookie(&#x27;refresh_token&#x27;)
        return response
class CurrentUserView(APIView):
    permission_classes = [IsAuthenticated]
    def get(self, request, *args, **kwargs):
        user = request.user
        serializer = LoggedInUserSerializer(user, context={&#x27;request&#x27;: request})
        return Response(serializer.data)
class UserManagementViewSet(viewsets.ModelViewSet):
    def get_permissions(self):
        &quot;&quot;&quot;
        Define permissões dinamicamente com base na ação.
        - Ações de leitura (&#x27;list&#x27;, &#x27;retrieve&#x27;) exigem apenas acesso à página.
        - Ações de escrita (&#x27;create&#x27;, &#x27;update&#x27;, etc.) exigem permissões de gerenciamento.
        &quot;&quot;&quot;
        if self.action in [&#x27;list&#x27;, &#x27;retrieve&#x27;]:
            self.permission_classes = [IsAdminUser]
        else:
            self.permission_classes = [IsAdminUser, CanManageUser]
        return super().get_permissions()
    def get_queryset(self):
        user = self.request.user
        tenant = self.request.tenant
        base_queryset = CustomUser.objects.prefetch_related(
            &#x27;tenants__domains&#x27;
        )
        if user.is_superuser or user.role == &quot;dev&quot;:
            if tenant.schema_name == &#x27;public&#x27;:
                return base_queryset.all().order_by(&quot;username&quot;)
            return base_queryset.filter(tenants=tenant).order_by(&quot;username&quot;).distinct()
        user_level = ROLE_HIERARCHY.get(user.role, 0)
        allowed_roles = [
            role for role, level in ROLE_HIERARCHY.items() 
            if level &lt;= user_level
        ]
        return base_queryset.filter(
            tenants=tenant,
            role__in=allowed_roles
        ).order_by(&quot;username&quot;).distinct()
    def get_serializer_class(self):
        if self.action == &quot;create&quot;:
            return UserCreateSerializer
        return UserSerializer
    @action(detail=True, methods=[&quot;get&quot;, &quot;put&quot;], url_path=&quot;permissions&quot;)
    def permissions(self, request, pk=None):
        user = self.get_object()
        tenant = request.tenant
        if request.method == &quot;GET&quot;:
            permissions_data = UserPermission.get_user_permissions_dict(user, tenant)
            permissions_data[&#x27;can_create_tenant&#x27;] = user.can_create_tenant
            permissions_data[&#x27;allowed_tenants&#x27;] = list(user.tenants.all().values_list(&#x27;id&#x27;, flat=True))
            return Response(permissions_data)
        elif request.method == &quot;PUT&quot;:
            data_to_update = request.data.get(&quot;permissions&quot;, request.data)
            if &#x27;can_create_tenant&#x27; in data_to_update:
                can_create = data_to_update.pop(&#x27;can_create_tenant&#x27;)
                if isinstance(can_create, bool):
                    user.can_create_tenant = can_create
                    user.save(update_fields=[&#x27;can_create_tenant&#x27;])
            if &#x27;allowed_tenants&#x27; in data_to_update:
                tenant_ids = data_to_update.pop(&#x27;allowed_tenants&#x27;)
                if isinstance(tenant_ids, list):
                    user.tenants.set(tenant_ids)
            UserPermission.update_user_permissions(user, tenant, data_to_update)
            return Response(
                {&quot;status&quot;: &quot;permissions updated&quot;}, status=status.HTTP_200_OK
            )
    def perform_create(self, serializer):
        user = serializer.save()
        user.tenants.add(self.request.tenant)
    http_method_names = [&quot;get&quot;, &quot;post&quot;, &quot;put&quot;, &quot;patch&quot;, &quot;delete&quot;, &quot;head&quot;, &quot;options&quot;]</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\global.d.ts <span style="float:right">(75 linhas)</span></div>
                                <pre class="code-block">declare module &quot;*.css&quot; {
  const content: { [className: string]: string };
  export default content;
}
declare module &quot;*.scss&quot; {
  const content: { [className: string]: string };
  export default content;
}
declare module &quot;*.sass&quot; {
  const content: { [className:string]: string };
  export default content;
}
declare module &quot;*.less&quot; {
  const content: { [className: string]: string };
  export default content;
}
declare module &quot;*.png&quot; {
  const value: string;
  export default value;
}
declare module &quot;*.jpg&quot; {
  const value: string;
  export default value;
}
declare module &quot;*.jpeg&quot; {
  const value: string;
  export default value;
}
declare module &quot;*.gif&quot; {
  const value: string;
  export default value;
}
declare module &quot;*.svg&quot; {
  import * as React from &quot;react&quot;;
  export const ReactComponent: React.FunctionComponent&lt;
    React.SVGProps&lt;SVGSVGElement&gt;
  &gt;;
  const src: string;
  export default src;
}
declare module &quot;*.webp&quot; {
  const value: string;
  export default value;
}
declare module &quot;*.mp3&quot; {
  const value: string;
  export default value;
}
declare module &quot;*.woff&quot; {
  const value: string;
  export default value;
}
declare module &quot;*.woff2&quot; {
  const value: string;
  export default value;
}
declare module &quot;*.eot&quot; {
  const value: string;
  export default value;
}
declare module &quot;*.ttf&quot; {
  const value: string;
  export default value;
}
declare module &quot;*.otf&quot; {
  const value: string;
  export default value;
}
interface ImportMetaEnv {
  readonly VITE_API_URL: string;
}
interface ImportMeta {
  readonly env: ImportMetaEnv;
}
declare module &#x27;xlsx/dist/xlsx.full.min.js&#x27;;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\main.tsx <span style="float:right">(25 linhas)</span></div>
                                <pre class="code-block">import React from &quot;react&quot;;
import ReactDOM from &quot;react-dom/client&quot;;
import { QueryClient, QueryClientProvider } from &quot;@tanstack/react-query&quot;;
import { ReactQueryDevtools } from &quot;@tanstack/react-query-devtools&quot;;
import App from &quot;./pages/App&quot;;
import &quot;./styles/global.css&quot;;
import &quot;./styles/variables.css&quot;;
import { Toaster } from &quot;react-hot-toast&quot;;
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      refetchOnWindowFocus: false, // Opcional: evita refetch ao focar na janela
      retry: 1,
    },
  },
});
ReactDOM.createRoot(document.getElementById(&quot;root&quot;)!).render(
  &lt;React.StrictMode&gt;
    &lt;QueryClientProvider client={queryClient}&gt;
      &lt;App /&gt;
      &lt;ReactQueryDevtools initialIsOpen={false} /&gt;
      &lt;Toaster position=&quot;top-center&quot; toastOptions={{ duration: 1500 }} /&gt;
    &lt;/QueryClientProvider&gt;
  &lt;/React.StrictMode&gt;,
);</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\Header.tsx <span style="float:right">(21 linhas)</span></div>
                                <pre class="code-block">import React from &quot;react&quot;;
import { Menu } from &quot;lucide-react&quot;;
import &quot;../styles/header.css&quot;;
interface HeaderProps {
  toggleSidebar: () =&gt; void;
}
const Header: React.FC&lt;HeaderProps&gt; = ({ toggleSidebar }) =&gt; {
  return (
    &lt;header className=&quot;app-header&quot;&gt;
      &lt;button
        className=&quot;mobile-menu-btn&quot;
        onClick={toggleSidebar}
        title=&quot;Abrir menu&quot;
      &gt;
        &lt;Menu size={24} /&gt;
      &lt;/button&gt;
      &lt;div className=&quot;header-title&quot;&gt;Gestão de Compras&lt;/div&gt;
    &lt;/header&gt;
  );
};
export default Header;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\MainLayout.tsx <span style="float:right">(69 linhas)</span></div>
                                <pre class="code-block">import React, { useState, useEffect } from &quot;react&quot;;
import { Outlet } from &quot;react-router-dom&quot;;
import { useAuth } from &quot;../hooks/useAuth&quot;;
import &quot;../styles/mainLayout.css&quot;;
import Sidebar from &quot;./Sidebar&quot;;
import Header from &quot;./Header&quot;;
import Modal from &quot;./Modal&quot;;
const MainLayout: React.FC = () =&gt; {
  const [isSidebarOpen, setSidebarOpen] = useState(false); // Começa fechado para mobile
  const {
    isWarningModalOpen,
    countdown,
    resetInactivityTimer,
    continueSession, // Nova função para o botão
    logout, // Função de logout para o novo botão
  } = useAuth();
  useEffect(() =&gt; {
    const events = [&quot;mousemove&quot;, &quot;keydown&quot;, &quot;click&quot;, &quot;scroll&quot;];
    events.forEach((event) =&gt;
      window.addEventListener(event, resetInactivityTimer),
    );
    return () =&gt; {
      events.forEach((event) =&gt;
        window.removeEventListener(event, resetInactivityTimer),
      );
    };
  }, [resetInactivityTimer]);
  const toggleSidebar = () =&gt; {
    setSidebarOpen(!isSidebarOpen);
  };
  return (
    &lt;div className={`main-layout ${isSidebarOpen ? &quot;sidebar-is-open&quot; : &quot;&quot;}`}&gt;
      &lt;Sidebar isSidebarOpen={isSidebarOpen} /&gt;
      &lt;div className=&quot;main-content&quot;&gt;
        &lt;Header toggleSidebar={toggleSidebar} /&gt;
        &lt;main className=&quot;content-area page-container&quot;&gt;
          &lt;Outlet /&gt; {/* O conteúdo da rota aninhada será renderizado aqui */}
        &lt;/main&gt;
      &lt;/div&gt;
      &lt;div
        className={`sidebar-overlay ${isSidebarOpen ? &quot;open&quot; : &quot;&quot;}`}
        onClick={toggleSidebar}
      &gt;&lt;/div&gt;
      {/* Modal de Aviso de Inatividade */}
      &lt;Modal
        isOpen={isWarningModalOpen}
        onClose={continueSession} // Clicar fora ou no &#x27;X&#x27; também continua a sessão
        title=&quot;Sessão prestes a expirar&quot;
        footer={
          &lt;div className=&quot;modal-footer-buttons&quot;&gt;
            &lt;button onClick={logout} className=&quot;btn btn-danger&quot;&gt;
              Sair (Logout)
            &lt;/button&gt;
            &lt;button onClick={continueSession} className=&quot;btn btn-primary&quot;&gt;
              Continuar Sessão
            &lt;/button&gt;
          &lt;/div&gt;
        }
      &gt;
        &lt;p&gt;
          Sua sessão será encerrada automaticamente por inatividade em{&quot; &quot;}
          &lt;strong&gt;{countdown} segundos&lt;/strong&gt;.
        &lt;/p&gt;
        &lt;p&gt;Clique em &quot;Continuar Sessão&quot; para permanecer conectado.&lt;/p&gt;
      &lt;/Modal&gt;
    &lt;/div&gt;
  );
};
export default MainLayout;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\Modal.tsx <span style="float:right">(75 linhas)</span></div>
                                <pre class="code-block">import ReactDOM from &quot;react-dom&quot;;
import &quot;../styles/modal.css&quot;;
import { useState } from &quot;react&quot;;
interface ModalProps {
  isOpen: boolean;
  onClose: () =&gt; void;
  onConfirm?: () =&gt; void | Promise&lt;void&gt;;
  title: string;
  children: React.ReactNode;
  showFooter?: boolean;
  footer?: React.ReactNode;
  closeOnOverlay?: boolean;
  size?: &quot;small&quot; | &quot;medium&quot; | &quot;large&quot;;
}
const Modal: React.FC&lt;ModalProps&gt; = ({
  isOpen,
  onClose,
  onConfirm,
  title,
  children,
  showFooter = true,
  footer,
  closeOnOverlay = true,
  size = &quot;medium&quot;,
}) =&gt; {
  const [closing, setClosing] = useState(false);
  if (!isOpen &amp;&amp; !closing) return null;
  const handleClose = () =&gt; {
    setClosing(true);
    setTimeout(() =&gt; {
      setClosing(false);
      onClose();
    }, 250);
  };
  return ReactDOM.createPortal(
    &lt;div
      className={`modal-overlay ${closing ? &quot;closing&quot; : &quot;open&quot;}`}
      onClick={() =&gt; closeOnOverlay &amp;&amp; handleClose()}
    &gt;
      &lt;div
        className={`modal-content modal-animate modal-${size} ${
          closing ? &quot;closing-content&quot; : &quot;&quot;
        }`}
        onClick={(e) =&gt; e.stopPropagation()}
      &gt;
        &lt;div className=&quot;modal-header&quot;&gt;
          &lt;h3&gt;{title}&lt;/h3&gt;
          &lt;button className=&quot;modal-close-btn&quot; onClick={handleClose}&gt;
            &amp;times;
          &lt;/button&gt;
        &lt;/div&gt;
        &lt;div className=&quot;modal-body&quot;&gt;{children}&lt;/div&gt;
        {/* Preferência: footer custom vence o automático */}
        {footer ? (
          &lt;div className=&quot;modal-footer&quot;&gt;{footer}&lt;/div&gt;
        ) : (
          showFooter &amp;&amp; (
            &lt;div className=&quot;modal-footer&quot;&gt;
              &lt;button className=&quot;btn-cancel&quot; onClick={handleClose}&gt;
                Cancelar
              &lt;/button&gt;
              {onConfirm &amp;&amp; (
                &lt;button className=&quot;btn-confirm&quot; onClick={onConfirm}&gt;
                  Confirmar
                &lt;/button&gt;
              )}
            &lt;/div&gt;
          )
        )}
      &lt;/div&gt;
    &lt;/div&gt;,
    document.body,
  );
};
export default Modal;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\Pagination.tsx <span style="float:right">(49 linhas)</span></div>
                                <pre class="code-block">import React from &quot;react&quot;;
import { ChevronLeft, ChevronRight } from &quot;lucide-react&quot;;
import &quot;../styles/pagination.css&quot;;
interface PaginationProps {
  currentPage: number;
  totalPages: number;
  onPageChange: (page: number) =&gt; void;
}
const Pagination: React.FC&lt;PaginationProps&gt; = ({
  currentPage,
  totalPages,
  onPageChange,
}) =&gt; {
  if (totalPages &lt;= 1) {
    return null; // Não renderiza nada se houver apenas uma página
  }
  const handlePrevious = () =&gt; {
    if (currentPage &gt; 1) {
      onPageChange(currentPage - 1);
    }
  };
  const handleNext = () =&gt; {
    if (currentPage &lt; totalPages) {
      onPageChange(currentPage + 1);
    }
  };
  return (
    &lt;div className=&quot;pagination-container&quot;&gt;
      &lt;button
        onClick={handlePrevious}
        disabled={currentPage === 1}
        className=&quot;pagination-button&quot;
      &gt;
        &lt;ChevronLeft size={18} /&gt; Anterior
      &lt;/button&gt;
      &lt;span className=&quot;pagination-info&quot;&gt;
        Página {currentPage} de {totalPages}
      &lt;/span&gt;
      &lt;button
        onClick={handleNext}
        disabled={currentPage === totalPages}
        className=&quot;pagination-button&quot;
      &gt;
        Próximo &lt;ChevronRight size={18} /&gt;
      &lt;/button&gt;
    &lt;/div&gt;
  );
};
export default Pagination;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\PermissionRoute.tsx <span style="float:right">(31 linhas)</span></div>
                                <pre class="code-block">import React from &quot;react&quot;;
import { Navigate, Outlet } from &quot;react-router-dom&quot;;
import { useAuth } from &quot;../hooks/useAuth&quot;;
import { PermissionSet } from &quot;../pages/UserManagement&quot;;
interface PermissionRouteProps {
  permission: string; // Ex: &quot;page_compras&quot; ou &quot;gerenciar.usuarios&quot;
}
const PermissionRoute: React.FC&lt;PermissionRouteProps&gt; = ({ permission }) =&gt; {
  const { user } = useAuth();
  const checkPermission = (
    permissions: Partial&lt;PermissionSet&gt;,
    permString: string
  ): boolean =&gt; {
    const keys = permString.split(&quot;.&quot;);
    let current: any = permissions;
    for (const key of keys) {
      if (current === undefined || typeof current !== &quot;object&quot; || current === null) {
        return false;
      }
      current = current[key];
    }
    return !!current;
  };
  const hasPermission =
    user?.is_superuser || checkPermission(user?.permissions || {}, permission);
  if (!hasPermission) {
    return &lt;Navigate to=&quot;/processos&quot; replace /&gt;;
  }
  return &lt;Outlet /&gt;;
};
export default PermissionRoute;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\ProcessoCreateSkeleton.tsx <span style="float:right">(32 linhas)</span></div>
                                <pre class="code-block">import React from &quot;react&quot;;
import { ArrowLeft } from &quot;lucide-react&quot;;
import &quot;../styles/processoCreateSkeleton.css&quot;;
const ProcessoCreateSkeleton: React.FC = () =&gt; {
  return (
    &lt;div className=&quot;processo-create-page&quot;&gt;
      &lt;header className=&quot;create-header&quot;&gt;
        &lt;div className=&quot;skeleton-line skeleton-h1&quot;&gt;&lt;/div&gt;
        &lt;div className=&quot;skeleton-back-link&quot;&gt;
          &lt;ArrowLeft size={18} /&gt;
          &lt;div className=&quot;skeleton-line skeleton-back-link-text&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/header&gt;
      &lt;div className=&quot;form-container&quot;&gt;
        &lt;div className=&quot;skeleton-form-group&quot;&gt;
          &lt;div className=&quot;skeleton-line skeleton-label&quot;&gt;&lt;/div&gt;
          &lt;div className=&quot;skeleton-line skeleton-input&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div className=&quot;skeleton-form-group&quot;&gt;
          &lt;div className=&quot;skeleton-line skeleton-label&quot;&gt;&lt;/div&gt;
          &lt;div className=&quot;skeleton-line skeleton-input&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div className=&quot;skeleton-form-group&quot;&gt;
          &lt;div className=&quot;skeleton-line skeleton-label&quot;&gt;&lt;/div&gt;
          &lt;div className=&quot;skeleton-line skeleton-input&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div className=&quot;skeleton-line skeleton-button&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};
export default ProcessoCreateSkeleton;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\ProcessoDetailSkeleton.tsx <span style="float:right">(32 linhas)</span></div>
                                <pre class="code-block">import React from &quot;react&quot;;
import { ArrowLeft } from &quot;lucide-react&quot;;
import &quot;../styles/ProcessoDetail.css&quot;;
import &quot;../styles/processoDetailSkeleton.css&quot;;
const ProcessoDetailSkeleton: React.FC = () =&gt; {
  return (
    &lt;div className=&quot;processo-detail-page&quot;&gt;
      &lt;header className=&quot;detail-header&quot;&gt;
        &lt;div className=&quot;skeleton-line skeleton-h1&quot;&gt;&lt;/div&gt;
        &lt;div className=&quot;skeleton-back-link&quot;&gt;
          &lt;ArrowLeft size={18} /&gt;
          &lt;div className=&quot;skeleton-line skeleton-back-link-text&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/header&gt;
      &lt;div className=&quot;processo-detail-content&quot;&gt;
        &lt;div className=&quot;detail-grid&quot;&gt;
          &lt;div className=&quot;skeleton-detail-item&quot;&gt;&lt;/div&gt;
          &lt;div className=&quot;skeleton-detail-item&quot;&gt;&lt;/div&gt;
          &lt;div className=&quot;skeleton-detail-item&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div className=&quot;skeleton-line skeleton-h4&quot;&gt;&lt;/div&gt;
        &lt;div className=&quot;skeleton-file-item&quot;&gt;&lt;/div&gt;
        &lt;div className=&quot;skeleton-file-item&quot;&gt;&lt;/div&gt;
        &lt;div className=&quot;skeleton-upload-section&quot;&gt;
          &lt;div className=&quot;skeleton-line skeleton-h4&quot;&gt;&lt;/div&gt;
          &lt;div className=&quot;skeleton-upload-form&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};
export default ProcessoDetailSkeleton;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\ProcessoSkeletonCard.tsx <span style="float:right">(19 linhas)</span></div>
                                <pre class="code-block">import React from &quot;react&quot;;
import &quot;../styles/processoSkeletonCard.css&quot;;
const ProcessoSkeletonCard: React.FC = () =&gt; {
  return (
    &lt;div className=&quot;skeleton-card&quot;&gt;
      &lt;div className=&quot;skeleton-header&quot;&gt;
        &lt;div className=&quot;skeleton-icon&quot;&gt;&lt;/div&gt;
        &lt;div className=&quot;skeleton-status&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;div className=&quot;skeleton-line skeleton-title&quot;&gt;&lt;/div&gt;
      &lt;div className=&quot;skeleton-line skeleton-subtitle&quot;&gt;&lt;/div&gt;
      &lt;div className=&quot;skeleton-footer&quot;&gt;
        &lt;div className=&quot;skeleton-line skeleton-footer-text&quot;&gt;&lt;/div&gt;
        &lt;div className=&quot;skeleton-line skeleton-footer-text&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};
export default ProcessoSkeletonCard;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\ProcessosModal.tsx <span style="float:right">(133 linhas)</span></div>
                                <pre class="code-block">import React, { useState } from &quot;react&quot;;
import Modal from &quot;./Modal&quot;;
import { Processo } from &quot;../pages/Processos&quot;;
import { formatStatus } from &quot;../pages/Processos&quot;;
import { Search, FileText, Download } from &quot;lucide-react&quot;;
import &quot;../styles/ProcessosModal.css&quot;;
import &quot;../styles/userManagement.css&quot;;
interface ProcessosModalProps {
  isOpen: boolean;
  onClose: () =&gt; void;
  title: string;
  processos: Processo[];
  onDataChange: () =&gt; void;
}
const ProcessosModal: React.FC&lt;ProcessosModalProps&gt; = ({
  isOpen,
  onClose,
  title,
  processos,
}) =&gt; {
  const [searchTerm, setSearchTerm] = useState(&quot;&quot;);
  const filteredProcessos = processos
    .filter((p) =&gt; {
      const lowerCaseSearchTerm = searchTerm.toLowerCase();
      const formattedDate = new Date(p.data_status).toLocaleDateString(&quot;pt-BR&quot;);
      const formattedStatus = formatStatus(p.status).toLowerCase();
      return (
        p.nome.toLowerCase().includes(lowerCaseSearchTerm) ||
        (p.crdii_nome &amp;&amp;
          p.crdii_nome.toLowerCase().includes(lowerCaseSearchTerm)) ||
        p.criado_por.toLowerCase().includes(lowerCaseSearchTerm) ||
        formattedDate.includes(lowerCaseSearchTerm) ||
        formattedStatus.includes(lowerCaseSearchTerm)
      );
    })
    .sort(
      (a, b) =&gt;
        new Date(b.data_criacao).getTime() - new Date(a.data_criacao).getTime()
    );
  return (
    &lt;Modal
      isOpen={isOpen}
      onClose={onClose}
      title={title}
      showFooter={false}
      size=&quot;large&quot;
    &gt;
      &lt;div className=&quot;processos-modal-content&quot;&gt;
        &lt;div className=&quot;processos-modal-header&quot;&gt;
          &lt;div className=&quot;search-bar&quot;&gt;
            &lt;Search size={18} /&gt;
            &lt;input
              type=&quot;text&quot;
              placeholder=&quot;Buscar por processo, CRDII, solicitante, data ou status...&quot;
              value={searchTerm}
              onChange={(e) =&gt; setSearchTerm(e.target.value)}
            /&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div className=&quot;processos-modal-list user-list&quot;&gt;
          {filteredProcessos.length &gt; 0 ? (
            &lt;table className=&quot;user-table&quot;&gt;
              &lt;thead&gt;
                &lt;tr&gt;
                  &lt;th&gt;CRDII&lt;/th&gt;
                  &lt;th&gt;PROCESSOS&lt;/th&gt;
                  &lt;th&gt;SOLICITANTE&lt;/th&gt;
                  &lt;th&gt;DATA CRIAÇÃO&lt;/th&gt;
                  &lt;th&gt;DATA STATUS&lt;/th&gt;
                  &lt;th&gt;STATUS&lt;/th&gt;
                &lt;/tr&gt;
              &lt;/thead&gt;
              &lt;tbody&gt;
                {filteredProcessos.map((processo) =&gt; (
                  &lt;tr key={processo.id}&gt;
                    &lt;td data-label=&quot;CRDII&quot;&gt;{processo.crdii_nome || &quot;N/A&quot;}&lt;/td&gt;
                    &lt;td data-label=&quot;PROCESSOS&quot;&gt;
                      &lt;a
                        href={`/processos/${processo.id}`}
                        target=&quot;_self&quot;
                        rel=&quot;noopener noreferrer&quot;
                      &gt;
                        {processo.nome}
                      &lt;/a&gt;
                    &lt;/td&gt;
                    &lt;td data-label=&quot;SOLICITANTE&quot;&gt;{processo.criado_por}&lt;/td&gt;
                    &lt;td data-label=&quot;DATA CRIAÇÃO&quot;&gt;
                      {new Date(processo.data_criacao).toLocaleDateString(
                        &quot;pt-BR&quot;,
                        {
                          day: &quot;2-digit&quot;,
                          month: &quot;2-digit&quot;,
                          year: &quot;numeric&quot;,
                          hour: &quot;2-digit&quot;,
                          minute: &quot;2-digit&quot;,
                        }
                      )}
                    &lt;/td&gt;
                    &lt;td data-label=&quot;DATA STATUS&quot;&gt;
                      {new Date(processo.data_status).toLocaleDateString(
                        &quot;pt-BR&quot;,
                        {
                          day: &quot;2-digit&quot;,
                          month: &quot;2-digit&quot;,
                          year: &quot;numeric&quot;,
                          hour: &quot;2-digit&quot;,
                          minute: &quot;2-digit&quot;,
                        }
                      )}
                    &lt;/td&gt;
                    &lt;td data-label=&quot;STATUS&quot;&gt;
                      &lt;span
                        className={`status-badge status-${processo.status}`}
                      &gt;
                        {formatStatus(processo.status)}
                      &lt;/span&gt;
                    &lt;/td&gt;
                  &lt;/tr&gt;
                ))}
              &lt;/tbody&gt;
            &lt;/table&gt;
          ) : (
            &lt;div className=&quot;no-results-modal&quot;&gt;
              &lt;FileText size={40} /&gt;
              &lt;p&gt;Nenhum processo encontrado para esta categoria.&lt;/p&gt;
            &lt;/div&gt;
          )}
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/Modal&gt;
  );
};
export default ProcessosModal;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\ProtectedRoute.tsx <span style="float:right">(18 linhas)</span></div>
                                <pre class="code-block">import React from &quot;react&quot;;
import { Navigate, Outlet } from &quot;react-router-dom&quot;;
import { useAuth } from &quot;../hooks/useAuth&quot;;
const ProtectedRoute: React.FC = () =&gt; {
  const { user, loading } = useAuth();
  if (loading) {
    return (
      &lt;div className=&quot;flex items-center justify-center h-screen text-lg&quot;&gt;
        Carregando...
      &lt;/div&gt;
    );
  }
  if (!user) {
    return &lt;Navigate to=&quot;/login&quot; replace /&gt;;
  }
  return &lt;Outlet /&gt;;
};
export default ProtectedRoute;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\SearchableSelect.tsx <span style="float:right">(109 linhas)</span></div>
                                <pre class="code-block">import React, { useState, useEffect, useRef } from &quot;react&quot;;
import { ChevronDown, X } from &quot;lucide-react&quot;;
import &quot;../styles/searchableSelect.css&quot;;
interface Option {
  id: number;
  nome?: string;
  username?: string;
}
interface SearchableSelectProps {
  options: Option[];
  value: string;
  onChange: (value: string) =&gt; void;
  placeholder: string;
}
const SearchableSelect: React.FC&lt;SearchableSelectProps&gt; = ({
  options,
  value,
  onChange,
  placeholder,
}) =&gt; {
  const [inputValue, setInputValue] = useState(&quot;&quot;);
  const [isOpen, setIsOpen] = useState(false);
  const wrapperRef = useRef&lt;HTMLDivElement&gt;(null);
  const getOptionName = (option: Option) =&gt; option.nome || option.username || &quot;&quot;;
  useEffect(() =&gt; {
    const selectedOption = options.find((opt) =&gt; String(opt.id) === value);
    if (selectedOption) {
      setInputValue(getOptionName(selectedOption));
    } else {
      setInputValue(&quot;&quot;);
    }
  }, [value, options]);
  useEffect(() =&gt; {
    const handleClickOutside = (event: MouseEvent) =&gt; {
      if (
        wrapperRef.current &amp;&amp;
        !wrapperRef.current.contains(event.target as Node)
      ) {
        setIsOpen(false);
      }
    };
    document.addEventListener(&quot;mousedown&quot;, handleClickOutside);
    return () =&gt; {
      document.removeEventListener(&quot;mousedown&quot;, handleClickOutside);
    };
  }, []);
  const handleInputChange = (e: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; {
    setInputValue(e.target.value);
    if (!isOpen) {
      setIsOpen(true);
    }
  };
  const handleSelectOption = (option: Option) =&gt; {
    onChange(String(option.id));
    setInputValue(getOptionName(option));
    setIsOpen(false);
  };
  const clearSelection = () =&gt; {
    onChange(&quot;&quot;);
    setInputValue(&quot;&quot;);
  };
  const filteredOptions = options.filter((option) =&gt;
    getOptionName(option).toLowerCase().includes(inputValue.toLowerCase())
  );
  return (
    &lt;div className=&quot;searchable-select-wrapper&quot; ref={wrapperRef}&gt;
      &lt;div className=&quot;searchable-select-input-container&quot;&gt;
        &lt;input
          type=&quot;text&quot;
          value={inputValue}
          onChange={handleInputChange}
          onFocus={() =&gt; setIsOpen(true)}
          placeholder={placeholder}
          className=&quot;searchable-select-input&quot;
        /&gt;
        {value ? (
          &lt;X
            size={16}
            className=&quot;searchable-select-icon clear-icon&quot;
            onClick={clearSelection}
          /&gt;
        ) : (
          &lt;ChevronDown
            size={16}
            className={`searchable-select-icon ${isOpen ? &quot;open&quot; : &quot;&quot;}`}
          /&gt;
        )}
      &lt;/div&gt;
      {isOpen &amp;&amp; (
        &lt;ul className=&quot;searchable-select-dropdown&quot;&gt;
          {filteredOptions.length &gt; 0 ? (
            filteredOptions.map((option) =&gt; (
              &lt;li
                key={option.id}
                onClick={() =&gt; handleSelectOption(option)}
                className={String(option.id) === value ? &quot;selected&quot; : &quot;&quot;}
              &gt;
                {getOptionName(option)}
              &lt;/li&gt;
            ))
          ) : (
            &lt;li className=&quot;no-options&quot;&gt;Nenhuma opção encontrada&lt;/li&gt;
          )}
        &lt;/ul&gt;
      )}
    &lt;/div&gt;
  );
};
export default SearchableSelect;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\Sidebar.tsx <span style="float:right">(244 linhas)</span></div>
                                <pre class="code-block">import React, { useState } from &quot;react&quot;;
import {
  FileText,
  LogOut,
  FilePlus,
  User,
  Users,
  BarChart2,
  ChevronLeft,
  ChevronRight,
  ChevronDown,
  Briefcase,
} from &quot;lucide-react&quot;;
import Modal from &quot;./Modal&quot;;
import { useAuth } from &quot;../hooks/useAuth&quot;;
import { NavLink } from &quot;react-router-dom&quot;;
import logo from &quot;../assets/logo.png&quot;;
import logoSmall from &quot;../assets/logo-small.png&quot;; // Certifique-se de ter esta imagem ou altere o nome
import &quot;../styles/sidebar.css&quot;;
interface SidebarProps {
  isSidebarOpen?: boolean; // Tornar opcional, pois em desktop não será usado
}
const Sidebar: React.FC&lt;SidebarProps&gt; = ({ isSidebarOpen }) =&gt; {
  const { user, tenant, logout } = useAuth();
  const [isLogoutModalOpen, setLogoutModalOpen] = useState(false);
  const [isCollapsed, setIsCollapsed] = useState(false);
  const [openSubmenus, setOpenSubmenus] = useState&lt;Record&lt;string, boolean&gt;&gt;({});
  const toggleSubmenu = (key: string) =&gt; {
    if (isCollapsed) {
      setIsCollapsed(false);
      setTimeout(() =&gt; {
        setOpenSubmenus((prev) =&gt; ({ ...prev, [key]: !prev[key] }));
      }, 50);
    } else {
      setOpenSubmenus((prev) =&gt; ({ ...prev, [key]: !prev[key] }));
    }
  };
  return (
    &lt;&gt;
      &lt;aside
        className={`sidebar ${isSidebarOpen ? &quot;open&quot; : &quot;&quot;} ${isCollapsed ? &quot;collapsed&quot; : &quot;&quot;}`}
      &gt;
        &lt;div className=&quot;logo-container&quot;&gt;
          &lt;img
            src={isCollapsed ? logoSmall : logo}
            alt=&quot;Logo&quot;
            className=&quot;sidebar-logo&quot;
          /&gt;
        &lt;/div&gt;
        {user &amp;&amp; (
          &lt;div
            className=&quot;user-info-top&quot;
            data-tooltip={user.username || &quot;Usuário&quot;}
          &gt;
            &lt;User size={20} /&gt;
            &lt;span&gt;{user.username || &quot;Carregando...&quot;}&lt;/span&gt;
          &lt;/div&gt;
        )}
        &lt;nav className=&quot;sidebar-nav&quot;&gt;
          {/* Link para Criar Processo: visível se for superuser ou tiver a permissão &#x27;can_create_processo&#x27; */}
          {(user?.is_superuser || user?.permissions?.can_create_processo) &amp;&amp; (
            &lt;NavLink
              to=&quot;/processos/novo&quot;
              className=&quot;nav-item&quot;
              data-tooltip=&quot;Criar Processo&quot;
            &gt;
              &lt;FilePlus size={20} /&gt;
              &lt;span&gt;Criar Processo&lt;/span&gt;
            &lt;/NavLink&gt;
          )}
          {/* Link para Processos: visível se for superuser ou tiver a permissão &#x27;page_compras&#x27; */}
          {(user?.is_superuser || user?.permissions?.page_compras) &amp;&amp; (
            &lt;NavLink
              to=&quot;/processos&quot;
              className=&quot;nav-item&quot;
              data-tooltip=&quot;Processos&quot;
              end
            &gt;
              &lt;FileText size={20} /&gt;
              &lt;span&gt;Processos&lt;/span&gt;
            &lt;/NavLink&gt;
          )}
          {/* Link para Painel Financeiro: visível se for superuser ou tiver a permissão &#x27;page_financeiro&#x27; */}
          {(user?.is_superuser || user?.permissions?.page_dashboard) &amp;&amp; (
            &lt;NavLink
              to=&quot;/dashboard&quot;
              className=&quot;nav-item&quot;
              data-tooltip=&quot;Painel Dashboard&quot;
            &gt;
              &lt;BarChart2 size={20} /&gt;
              &lt;span&gt;Painel Dashboard&lt;/span&gt;
            &lt;/NavLink&gt;
          )}
          {user?.is_superuser &amp;&amp; (
            &lt;&gt;
              &lt;button
                className={`nav-item submenu-toggle ${openSubmenus[&quot;relatorios&quot;] ? &quot;open&quot; : &quot;&quot;}`}
                onClick={() =&gt; toggleSubmenu(&quot;relatorios&quot;)}
                data-tooltip=&quot;Relatórios&quot;
              &gt;
                &lt;FileText size={20} /&gt;
                &lt;span&gt;Relatórios&lt;/span&gt;
                {!isCollapsed &amp;&amp; (
                  &lt;ChevronDown
                    size={16}
                    className={`submenu-arrow ${openSubmenus[&quot;relatorios&quot;] ? &quot;rotated&quot; : &quot;&quot;}`}
                  /&gt;
                )}
              &lt;/button&gt;
              {/* Lista de Subitens */}
              &lt;div
                className={`submenu-list ${openSubmenus[&quot;relatorios&quot;] &amp;&amp; !isCollapsed ? &quot;expanded&quot; : &quot;&quot;}`}
              &gt;
                {(user?.is_superuser ||
                  user?.permissions?.relatorios?.geral) &amp;&amp; (
                  &lt;NavLink to=&quot;/relatorios/geral&quot; className=&quot;nav-item sub-item&quot;&gt;
                    &lt;span className=&quot;sub-item-dot&quot;&gt;•&lt;/span&gt;
                    &lt;span&gt;Geral&lt;/span&gt;
                  &lt;/NavLink&gt;
                )}
                {(user?.is_superuser ||
                  user?.permissions?.relatorios?.financeiro) &amp;&amp; (
                  &lt;NavLink
                    to=&quot;/relatorios/financeiro&quot;
                    className=&quot;nav-item sub-item&quot;
                  &gt;
                    &lt;span className=&quot;sub-item-dot&quot;&gt;•&lt;/span&gt;
                    &lt;span&gt;Financeiro&lt;/span&gt;
                  &lt;/NavLink&gt;
                )}
              &lt;/div&gt;
            &lt;/&gt;
          )}
          {/* Link para Gerenciar Usuários: visível se for superuser ou tiver a permissão &#x27;page_admin&#x27; ou cargos especificos */}
          {(user?.is_superuser ||
            user?.permissions?.gerenciar?.usuarios ||
            user?.permissions?.gerenciar?.empresas ||
            user?.permissions?.gerenciar?.crdiis) &amp;&amp; (
            &lt;&gt;
              &lt;button
                className={`nav-item submenu-toggle ${openSubmenus[&quot;admin&quot;] ? &quot;open&quot; : &quot;&quot;}`}
                onClick={() =&gt; toggleSubmenu(&quot;admin&quot;)}
                data-tooltip=&quot;Gerenciar&quot;
              &gt;
                &lt;Users size={20} /&gt;
                &lt;span&gt;Gerenciar&lt;/span&gt;
                {!isCollapsed &amp;&amp; (
                  &lt;ChevronDown
                    size={16}
                    className={`submenu-arrow ${openSubmenus[&quot;admin&quot;] ? &quot;rotated&quot; : &quot;&quot;}`}
                  /&gt;
                )}
              &lt;/button&gt;
              &lt;div
                className={`submenu-list ${openSubmenus[&quot;admin&quot;] &amp;&amp; !isCollapsed ? &quot;expanded&quot; : &quot;&quot;}`}
              &gt;
                {(user?.is_superuser ||
                  user?.permissions?.gerenciar?.usuarios) &amp;&amp; (
                  &lt;NavLink
                    to=&quot;/gerenciar-usuarios&quot;
                    className=&quot;nav-item sub-item&quot;
                    data-tooltip=&quot;Gerenciar Usuários&quot;
                  &gt;
                    &lt;span className=&quot;sub-item-dot&quot;&gt;•&lt;/span&gt;
                    &lt;span&gt;Gerenciar Usuários&lt;/span&gt;
                  &lt;/NavLink&gt;
                )}
                {(user?.is_superuser ||
                  user?.permissions?.gerenciar?.empresas) &amp;&amp; (
                  &lt;NavLink
                    to=&quot;/gerenciar-empresas&quot;
                    className=&quot;nav-item sub-item&quot;
                    data-tooltip=&quot;Gerenciar Empresas&quot;
                  &gt;
                    &lt;span className=&quot;sub-item-dot&quot;&gt;•&lt;/span&gt;
                    &lt;span&gt;Gerenciar Empresas&lt;/span&gt;
                  &lt;/NavLink&gt;
                )}
                {(user?.is_superuser ||
                  user?.permissions?.gerenciar?.crdiis) &amp;&amp; (
                  &lt;NavLink
                    to=&quot;/gerenciar-crdiis&quot;
                    className=&quot;nav-item sub-item&quot;
                    data-tooltip=&quot;Gerenciar CRDIIs&quot;
                  &gt;
                    &lt;span className=&quot;sub-item-dot&quot;&gt;•&lt;/span&gt;
                    &lt;span&gt;Gerenciar CRDIIs&lt;/span&gt;
                  &lt;/NavLink&gt;
                )}
              &lt;/div&gt;
            &lt;/&gt;
          )}
        &lt;/nav&gt;
        {/* Botão de Toggle centralizado na lateral */}
        &lt;button
          className=&quot;sidebar-toggle-btn-absolute&quot;
          onClick={() =&gt; setIsCollapsed(!isCollapsed)}
          title={isCollapsed ? &quot;Expandir Menu&quot; : &quot;Recolher Menu&quot;}
        &gt;
          {isCollapsed ? &lt;ChevronRight size={18} /&gt; : &lt;ChevronLeft size={18} /&gt;}
        &lt;/button&gt;
        &lt;div className=&quot;sidebar-footer&quot;&gt;
          &lt;div className=&quot;sidebar-footer-info&quot;&gt;
            {/* Exibe o nome da Empresa Logada */}
            &lt;div className=&quot;company-info&quot;&gt;
              &lt;Briefcase size={18} /&gt;
              &lt;span className=&quot;company-name&quot;&gt;{tenant?.nome || &quot;Empresa&quot;}&lt;/span&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          &lt;button
            onClick={() =&gt; setLogoutModalOpen(true)}
            className=&quot;logout-btn&quot;
            data-tooltip=&quot;Sair&quot;
          &gt;
            &lt;LogOut size={20} /&gt;
            &lt;span&gt;Sair&lt;/span&gt;
          &lt;/button&gt;
        &lt;/div&gt;
      &lt;/aside&gt;
      {/* Modal de Confirmação de Logout */}
      &lt;Modal
        isOpen={isLogoutModalOpen}
        onClose={() =&gt; setLogoutModalOpen(false)}
        title=&quot;Confirmar Saída&quot;
        footer={
          &lt;&gt;
            &lt;button
              onClick={() =&gt; setLogoutModalOpen(false)}
              className=&quot;btn btn-secondary&quot;
            &gt;
              Cancelar
            &lt;/button&gt;
            &lt;button onClick={logout} className=&quot;btn btn-danger&quot;&gt;
              Confirmar
            &lt;/button&gt;
          &lt;/&gt;
        }
      &gt;
        &lt;p&gt;Você tem certeza que deseja sair do sistema?&lt;/p&gt;
      &lt;/Modal&gt;
    &lt;/&gt;
  );
};
export default Sidebar;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\StatusHistoryModal.tsx <span style="float:right">(93 linhas)</span></div>
                                <pre class="code-block">import React, { useState, useEffect } from &#x27;react&#x27;;
import Modal from &#x27;./Modal&#x27;;
import api from &#x27;../services/api&#x27;;
import toast from &#x27;react-hot-toast&#x27;;
import &#x27;../styles/statusHistoryModal.css&#x27;;
import &#x27;../styles/userManagement.css&#x27;;
interface StatusHistory {
    id: number;
    usuario_nome: string | null;
    status_anterior_display: string | null;
    status_novo_display: string;
    data_mudanca: string;
}
interface StatusHistoryModalProps {
    isOpen: boolean;
    onClose: () =&gt; void;
    processoId: number;
}
const StatusHistoryModal: React.FC&lt;StatusHistoryModalProps&gt; = ({ isOpen, onClose, processoId }) =&gt; {
    const [history, setHistory] = useState&lt;StatusHistory[]&gt;([]);
    const [loading, setLoading] = useState(false);
    useEffect(() =&gt; {
        if (isOpen) {
            setLoading(true);
            api.get&lt;StatusHistory[]&gt;(`/processos/${processoId}/history/`)
                .then(response =&gt; {
                    setHistory(response.data);
                })
                .catch(err =&gt; {
                    console.error(&quot;Falha ao buscar histórico de status.&quot;, err);
                    toast.error(&quot;Não foi possível carregar o histórico.&quot;);
                })
                .finally(() =&gt; {
                    setLoading(false);
                });
        }
    }, [isOpen, processoId]);
    return (
        &lt;Modal
            isOpen={isOpen}
            onClose={onClose}
            title=&quot;Histórico de Movimentação de Status&quot;
            showFooter={true}
            footer={
                &lt;div className=&quot;modal-footer&quot;&gt;
                    &lt;button className=&quot;btn-cancel&quot; onClick={onClose}&gt;
                        Fechar
                    &lt;/button&gt;
                &lt;/div&gt;
            }
        &gt;
            &lt;div className=&quot;status-history-modal-content&quot;&gt;
                {loading ? (
                    &lt;p&gt;Carregando histórico...&lt;/p&gt;
                ) : history.length === 0 ? (
                    &lt;p&gt;Nenhuma movimentação de status registrada.&lt;/p&gt;
                ) : (
                    &lt;div className=&quot;user-list&quot;&gt;
                        &lt;table className=&quot;user-table&quot;&gt;
                            &lt;thead&gt;
                                &lt;tr&gt;
                                    &lt;th&gt;Status Anterior&lt;/th&gt;
                                    &lt;th&gt;Novo Status&lt;/th&gt;
                                    &lt;th&gt;Usuário&lt;/th&gt;
                                    &lt;th&gt;Data/Hora&lt;/th&gt;
                                &lt;/tr&gt;
                            &lt;/thead&gt;
                            &lt;tbody&gt;
                                {history.map((item) =&gt; (
                                    &lt;tr key={item.id}&gt;
                                        &lt;td data-label=&quot;Status Anterior&quot;&gt;
                                            &lt;strong&gt;{item.status_anterior_display || &#x27;Criação&#x27;}&lt;/strong&gt;
                                        &lt;/td&gt;
                                        &lt;td data-label=&quot;Novo Status&quot;&gt;
                                            &lt;strong&gt;{item.status_novo_display}&lt;/strong&gt;
                                        &lt;/td&gt;
                                        &lt;td data-label=&quot;Usuário&quot;&gt;
                                            {item.usuario_nome || &#x27;Sistema&#x27;}
                                        &lt;/td&gt;
                                        &lt;td data-label=&quot;Data/Hora&quot;&gt;
                                            {new Date(item.data_mudanca).toLocaleString(&#x27;pt-BR&#x27;)}
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                ))}
                            &lt;/tbody&gt;
                        &lt;/table&gt;
                    &lt;/div&gt;
                )}
            &lt;/div&gt;
        &lt;/Modal&gt;
    );
};
export default StatusHistoryModal;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\SystemStatus.tsx <span style="float:right">(13 linhas)</span></div>
                                <pre class="code-block">import React from &quot;react&quot;;
const SystemStatus: React.FC = () =&gt; {
  const isOnline = true;
  return (
    &lt;div className=&quot;system-status&quot;&gt;
      &lt;span
        className={`status-indicator ${isOnline ? &quot;online&quot; : &quot;offline&quot;}`}
      &gt;&lt;/span&gt;
      {isOnline ? &quot;Sistema Online&quot; : &quot;Sistema Offline&quot;}
    &lt;/div&gt;
  );
};
export default SystemStatus;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\UserForm.tsx <span style="float:right">(200 linhas)</span></div>
                                <pre class="code-block">import React, { useState, useEffect } from &quot;react&quot;;
import { ManagedUser } from &quot;../pages/UserManagement&quot;;
import { useAuth } from &quot;../hooks/useAuth&quot;; // Importa o hook de autenticação
import &quot;../styles/userForm.css&quot;;
interface UserFormProps {
  initialData: ManagedUser | null;
  onSave: (data: Partial&lt;ManagedUser&gt;) =&gt; void;
  onCancel: () =&gt; void;
  loading: boolean;
  availableRoles: string[];
  roleDisplayNames: Record&lt;string, string&gt;;
}
interface UserFormData {
  username: string;
  email: string;
  first_name: string;
  last_name: string;
  password?: string;
  password2?: string;
  role: ManagedUser[&quot;role&quot;];
}
const UserForm: React.FC&lt;UserFormProps&gt; = ({
  initialData,
  onSave,
  onCancel,
  loading,
  availableRoles,
  roleDisplayNames,
}) =&gt; {
  useAuth(); // Pega o usuário logado
  const initialFormState: UserFormData = {
    username: &quot;&quot;,
    email: &quot;&quot;,
    first_name: &quot;&quot;,
    last_name: &quot;&quot;,
    password: &quot;&quot;,
    password2: &quot;&quot;,
    role: &quot;obra&quot;,
  };
  const [formData, setFormData] = useState&lt;UserFormData&gt;(initialFormState);
  const isEditing = !!initialData;
  useEffect(() =&gt; {
    if (initialData) {
      setFormData({
        username: initialData.username,
        email: initialData.email,
        first_name: initialData.first_name || &quot;&quot;,
        last_name: initialData.last_name || &quot;&quot;,
        password: &quot;&quot;,
        password2: &quot;&quot;,
        role: initialData.role,
      });
    } else {
      setFormData(initialFormState);
    }
  }, [initialData]);
  const handleChange = (
    e: React.ChangeEvent&lt;HTMLInputElement | HTMLSelectElement&gt;
  ) =&gt; {
    const { name, value } = e.target;
    setFormData((prev) =&gt; ({
      ...prev,
      [name]: name === &quot;role&quot; ? (value as ManagedUser[&quot;role&quot;]) : value,
    }));
  };
  const handleSubmit = (e: React.FormEvent) =&gt; {
    e.preventDefault();
    const dataToSave: Partial&lt;UserFormData&gt; = { ...formData };
    if (isEditing &amp;&amp; !formData.password) {
      delete (dataToSave as any).password;
      delete (dataToSave as any).password2;
    }
    onSave(dataToSave);
  };
  const canChangeRole =
    isEditing &amp;&amp; initialData ? availableRoles.includes(initialData.role) : true; // Permite a seleção ao criar um novo usuário.
  return (
    &lt;form onSubmit={handleSubmit} className=&quot;user-form&quot;&gt;
      &lt;div className=&quot;form-grid&quot;&gt;
        &lt;div className=&quot;form-group&quot;&gt;
          &lt;label htmlFor=&quot;username&quot;&gt;Usuário&lt;/label&gt;
          &lt;input
            id=&quot;username&quot;
            type=&quot;text&quot;
            name=&quot;username&quot;
            value={formData.username}
            onChange={handleChange}
            required
            disabled={isEditing}
            placeholder=&quot;Ex: joao.silva&quot;
            title={
              isEditing
                ? &quot;O nome de usuário não pode ser alterado.&quot;
                : &quot;Nome de usuário para login&quot;
            }
          /&gt;
        &lt;/div&gt;
        &lt;div className=&quot;form-group&quot;&gt;
          &lt;label htmlFor=&quot;email&quot;&gt;E-mail&lt;/label&gt;
          &lt;input
            id=&quot;email&quot;
            type=&quot;email&quot;
            name=&quot;email&quot;
            value={formData.email}
            onChange={handleChange}
            required
            placeholder=&quot;Ex: joao@exemplo.com&quot;
          /&gt;
        &lt;/div&gt;
        &lt;div className=&quot;form-group&quot;&gt;
          &lt;label htmlFor=&quot;first_name&quot;&gt;Nome&lt;/label&gt;
          &lt;input
            id=&quot;first_name&quot;
            type=&quot;text&quot;
            name=&quot;first_name&quot;
            value={formData.first_name}
            onChange={handleChange}
            placeholder=&quot;Ex: João&quot;
          /&gt;
        &lt;/div&gt;
        &lt;div className=&quot;form-group&quot;&gt;
          &lt;label htmlFor=&quot;last_name&quot;&gt;Sobrenome&lt;/label&gt;
          &lt;input
            id=&quot;last_name&quot;
            type=&quot;text&quot;
            name=&quot;last_name&quot;
            value={formData.last_name}
            onChange={handleChange}
            placeholder=&quot;Ex: Silva&quot;
          /&gt;
        &lt;/div&gt;
        &lt;div className=&quot;form-group&quot;&gt;
          &lt;label htmlFor=&quot;password&quot;&gt;Senha {isEditing &amp;&amp; &quot;(Opcional)&quot;}&lt;/label&gt;
          &lt;input
            id=&quot;password&quot;
            type=&quot;password&quot;
            name=&quot;password&quot;
            value={formData.password}
            onChange={handleChange}
            required={!isEditing}
            placeholder=&quot;Digite a senha&quot;
          /&gt;
        &lt;/div&gt;
        &lt;div className=&quot;form-group&quot;&gt;
          &lt;label htmlFor=&quot;password2&quot;&gt;Confirmar Senha&lt;/label&gt;
          &lt;input
            id=&quot;password2&quot;
            type=&quot;password&quot;
            name=&quot;password2&quot;
            value={formData.password2}
            onChange={handleChange}
            required={!isEditing || !!formData.password}
            placeholder=&quot;Confirme a senha&quot;
          /&gt;
        &lt;/div&gt;
        &lt;div className=&quot;form-group full-width&quot;&gt;
          &lt;label htmlFor=&quot;role&quot;&gt;Tipo&lt;/label&gt;
          &lt;select
            id=&quot;role&quot;
            name=&quot;role&quot;
            value={formData.role}
            onChange={handleChange}
            disabled={isEditing &amp;&amp; !canChangeRole}
            title={
              isEditing &amp;&amp; !canChangeRole
                ? &quot;Você não tem permissão para alterar este cargo&quot;
                : &quot;Selecione o tipo de usuário&quot;
            }
          &gt;
            {/* Se o cargo do usuário editado não estiver na lista, adicione-o como uma opção desabilitada */}
            {isEditing &amp;&amp; !canChangeRole &amp;&amp; initialData &amp;&amp; (
              &lt;option key={initialData.role} value={initialData.role}&gt;
                {roleDisplayNames[initialData.role] || initialData.role}
              &lt;/option&gt;
            )}
            {availableRoles.map((role) =&gt; (
              &lt;option key={role} value={role}&gt;
                {roleDisplayNames[role]}
              &lt;/option&gt;
            ))}
          &lt;/select&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div className=&quot;form-footer&quot;&gt;
        &lt;button
          type=&quot;button&quot;
          className=&quot;btn btn-secondary&quot;
          onClick={onCancel}
          disabled={loading}
        &gt;
          Cancelar
        &lt;/button&gt;
        &lt;button type=&quot;submit&quot; className=&quot;btn btn-primary&quot; disabled={loading}&gt;
          {loading ? &quot;Salvando...&quot; : &quot;Salvar&quot;}
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  );
};
export default UserForm;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\components\UserManagementSkeleton.tsx <span style="float:right">(62 linhas)</span></div>
                                <pre class="code-block">import React from &quot;react&quot;;
import { Users, Search } from &quot;lucide-react&quot;;
import &quot;../styles/userManagement.css&quot;;
import &quot;../styles/userManagementSkeleton.css&quot;;
const UserManagementSkeleton: React.FC = () =&gt; {
  return (
    &lt;div className=&quot;user-management-container&quot;&gt;
      &lt;header className=&quot;user-management-header&quot;&gt;
        &lt;div className=&quot;header-title&quot;&gt;
          &lt;Users size={28} /&gt;
          &lt;div className=&quot;skeleton-line skeleton-title&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div className=&quot;header-actions&quot;&gt;
          &lt;div className=&quot;search-bar&quot;&gt;
            &lt;Search size={18} /&gt;
            &lt;div className=&quot;skeleton-line skeleton-search&quot;&gt;&lt;/div&gt;
          &lt;/div&gt;
          &lt;div className=&quot;skeleton-line skeleton-action-btn&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/header&gt;
      &lt;div className=&quot;user-table-container&quot;&gt;
        &lt;table className=&quot;user-table is-loading&quot;&gt;
          &lt;thead&gt;
            &lt;tr&gt;
              &lt;th&gt;
                &lt;div className=&quot;skeleton-line skeleton-th-80&quot;&gt;&lt;/div&gt;
              &lt;/th&gt;
              &lt;th&gt;
                &lt;div className=&quot;skeleton-line skeleton-th-90&quot;&gt;&lt;/div&gt;
              &lt;/th&gt;
              &lt;th&gt;
                &lt;div className=&quot;skeleton-line skeleton-th-70&quot;&gt;&lt;/div&gt;
              &lt;/th&gt;
              &lt;th&gt;
                &lt;div className=&quot;skeleton-line skeleton-th-50&quot;&gt;&lt;/div&gt;
              &lt;/th&gt;
            &lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody&gt;
            {Array.from({ length: 5 }).map((_, index) =&gt; (
              &lt;tr key={index}&gt;
                &lt;td&gt;
                  &lt;div className=&quot;skeleton-line&quot;&gt;&lt;/div&gt;
                &lt;/td&gt;
                &lt;td&gt;
                  &lt;div className=&quot;skeleton-line&quot;&gt;&lt;/div&gt;
                &lt;/td&gt;
                &lt;td&gt;
                  &lt;div className=&quot;skeleton-line&quot;&gt;&lt;/div&gt;
                &lt;/td&gt;
                &lt;td&gt;
                  &lt;div className=&quot;skeleton-line&quot;&gt;&lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
            ))}
          &lt;/tbody&gt;
        &lt;/table&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};
export default UserManagementSkeleton;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\hooks\reportGenerator.ts <span style="float:right">(144 linhas)</span></div>
                                <pre class="code-block">import { Processo, formatStatus } from &quot;../pages/Processos&quot;;
import jsPDF from &quot;jspdf&quot;;
import autoTable, { HookData } from &quot;jspdf-autotable&quot;;
import * as XLSX from &quot;xlsx/dist/xlsx.full.min.js&quot;;
export const generateProcessosExcel = (
  processos: Processo[],
  title: string
) =&gt; {
  const reportHeader = [
    [title],
    [&quot;LAND Serviços e Engenharia Ltda&quot;],
    [
      `Relatório gerado em: ${new Date().toLocaleString(&quot;pt-BR&quot;, {
        day: &quot;2-digit&quot;,
        month: &quot;2-digit&quot;,
        year: &quot;numeric&quot;,
      })}`,
    ],
    [], // Linha em branco para espaçamento
  ];
  const tableHeader = [
    &quot;CRDII&quot;,
    &quot;PROCESSOS&quot;,
    &quot;SOLICITANTE&quot;,
    &quot;DATA CRIAÇÃO&quot;,
    &quot;DATA STATUS&quot;,
    &quot;STATUS&quot;,
  ];
  const tableRows = processos.map((processo) =&gt; [
    processo.crdii_nome || &quot;N/A&quot;,
    processo.nome,
    processo.criado_por,
    new Date(processo.data_criacao).toLocaleDateString(&quot;pt-BR&quot;),
    new Date(processo.data_status).toLocaleString(&quot;pt-BR&quot;, {
      day: &quot;2-digit&quot;,
      month: &quot;2-digit&quot;,
      year: &quot;numeric&quot;,
      hour: &quot;2-digit&quot;,
      minute: &quot;2-digit&quot;,
    }),
    formatStatus(processo.status),
  ]);
  const fullData = [...reportHeader, tableHeader, ...tableRows];
  const worksheet = XLSX.utils.aoa_to_sheet(fullData);
  worksheet[&quot;!merges&quot;] = [
    { s: { r: 0, c: 0 }, e: { r: 0, c: 5 } },
    { s: { r: 1, c: 0 }, e: { r: 1, c: 5 } },
    { s: { r: 2, c: 0 }, e: { r: 2, c: 5 } },
  ];
  worksheet[&quot;!cols&quot;] = [
    { wch: 20 }, // CRDII
    { wch: 40 }, // PROCESSOS
    { wch: 20 }, // SOLICITANTE
    { wch: 15 }, // DATA CRIAÇÃO
    { wch: 20 }, // DATA STATUS
    { wch: 15 }, // STATUS
  ];
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, &quot;Processos&quot;);
  XLSX.writeFile(
    workbook,
    `${title.replace(/ /g, &quot;_&quot;).toLowerCase()}_report.xlsx`
  );
};
export const generateProcessosPDF = (
  processos: Processo[],
  title: string,
  logo: string
) =&gt; {
  const doc = new jsPDF();
  const tableColumn = [
    &quot;CRDII&quot;,
    &quot;PROCESSOS&quot;,
    &quot;SOLICITANTE&quot;,
    &quot;DATA CRIAÇÃO&quot;,
    &quot;DATA STATUS&quot;,
    &quot;STATUS&quot;,
  ];
  const tableRows: (string | number)[][] = [];
  processos.forEach((processo) =&gt; {
    const processoData = [
      processo.crdii_nome || &quot;N/A&quot;,
      processo.nome,
      processo.criado_por,
      new Date(processo.data_criacao).toLocaleString(&quot;pt-BR&quot;, {
        day: &quot;2-digit&quot;,
        month: &quot;2-digit&quot;,
        year: &quot;numeric&quot;,
      }),
      new Date(processo.data_status).toLocaleString(&quot;pt-BR&quot;, {
        day: &quot;2-digit&quot;,
        month: &quot;2-digit&quot;,
        year: &quot;numeric&quot;,
        hour: &quot;2-digit&quot;,
        minute: &quot;2-digit&quot;,
      }),
      formatStatus(processo.status),
    ];
    tableRows.push(processoData);
  });
  autoTable(doc, {
    head: [tableColumn],
    body: tableRows,
    startY: 50,
    didDrawPage: (data: HookData) =&gt; {
      const pageWidth = doc.internal.pageSize.width;
      const margin = data.settings.margin.left;
      const logoWidth = 25;
      const logoHeight = 25;
      doc.addImage(logo, &quot;PNG&quot;, margin, 15, logoWidth, logoHeight);
      doc.setFontSize(8);
      doc.setTextColor(&quot;#6c757d&quot;);
      doc.text(&quot;LAND Serviços e Engenharia Ltda&quot;, pageWidth - margin, 34, {
        align: &quot;right&quot;,
      });
      doc.setFontSize(16);
      doc.setFont(&quot;helvetica&quot;, &quot;bold&quot;);
      doc.setTextColor(&quot;#4F7951FF&quot;);
      doc.text(title, pageWidth - margin, 22, { align: &quot;right&quot; });
      doc.setFontSize(9);
      doc.setFont(&quot;helvetica&quot;, &quot;normal&quot;);
      doc.setTextColor(&quot;#464A4EFF&quot;);
      doc.text(
        `Relatório gerado em: ${new Date().toLocaleString(&quot;pt-BR&quot;, {
          day: &quot;2-digit&quot;,
          month: &quot;2-digit&quot;,
          year: &quot;numeric&quot;,
        })}`,
        pageWidth - margin,
        28,
        { align: &quot;right&quot; }
      );
      const pageCount = doc.getNumberOfPages();
      doc.setFontSize(10);
      doc.text(
        `Página ${data.pageNumber} de ${pageCount}`,
        data.settings.margin.left,
        doc.internal.pageSize.height - 10
      );
    },
    margin: { top: 45 },
  });
  doc.save(`${title.replace(/ /g, &quot;_&quot;).toLowerCase()}_report.pdf`);
};</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\hooks\useAuth.tsx <span style="float:right">(262 linhas)</span></div>
                                <pre class="code-block">import { StatusLimits } from &quot;../pages/UserManagement&quot;;
import {
  createContext,
  Dispatch,
  useContext,
  useState,
  ReactNode,
  useCallback,
  useEffect,
  useRef,
} from &quot;react&quot;;
import api from &quot;../services/api&quot;;
export interface User {
  id: number;
  username: string;
  email: string;
  role:
    | &quot;administrador&quot;
    | &quot;gestor&quot;
    | &quot;diretoria&quot;
    | &quot;compras&quot;
    | &quot;obra&quot;
    | &quot;financeiro&quot;
    | &quot;dev&quot;;
  is_superuser: boolean;
  is_active: boolean;
  permissions: {
    page_dashboard: boolean;
    page_compras: boolean;
    view_status_history: boolean;
    gerenciar: {
      usuarios: boolean;
      empresas: boolean;
      crdiis: boolean;
    };
    relatorios: {
      geral: boolean;
      financeiro: boolean;
    };
    can_create_processo: boolean;
    can_edit_processo: boolean;
    can_delete_processo: boolean;
    can_change_status: boolean;
    can_upload_file: boolean;
    can_delete_file: boolean;
    can_edit_user: boolean;
    can_delete_user: boolean;
    can_create_tenant: boolean;
    status_limits: StatusLimits;
    allowed_crdii: number[];
  };
}
interface Tenant {
  schema_name: string;
  nome: string;
}
interface AuthContextType {
  login: (tenantInfo: Tenant) =&gt; Promise&lt;void&gt;;
  logout: () =&gt; Promise&lt;void&gt;;
  loading: boolean;
  user: User | null;
  tenant: Tenant | null;
  setUser: Dispatch&lt;React.SetStateAction&lt;User | null&gt;&gt;;
  isWarningModalOpen: boolean;
  countdown: number;
  resetInactivityTimer: () =&gt; void;
  continueSession: () =&gt; void;
}
export const AuthContext = createContext&lt;AuthContextType | null&gt;(null);
const setSessionCookie = () =&gt; {
  document.cookie = &quot;session_active=true; path=/&quot;;
};
const removeSessionCookie = () =&gt; {
  document.cookie = &quot;session_active=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;&quot;;
};
const hasSessionCookie = () =&gt; {
  return document.cookie.split(&#x27;;&#x27;).some((item) =&gt; item.trim().startsWith(&#x27;session_active=&#x27;));
};
const useAuthLogic = () =&gt; {
  const [user, setUser] = useState&lt;User | null&gt;(null);
  const [tenant, setTenant] = useState&lt;Tenant | null&gt;(null);
  const [loading, setLoading] = useState(true);
  const [isWarningModalOpen, setWarningModalOpen] = useState(false);
  const [countdown, setCountdown] = useState(60);
  const inactivityTimer = useRef&lt;NodeJS.Timeout&gt;();
  const countdownTimer = useRef&lt;NodeJS.Timeout&gt;();
  const isRefreshing = useRef(false);
  const failedQueue = useRef&lt;any[]&gt;([]);
  const logout = useCallback(async () =&gt; {
    clearTimeout(inactivityTimer.current);
    clearInterval(countdownTimer.current);
    try {
      await api.post(&quot;/auth/logout/&quot;);
    } catch (e) {
      console.error(&quot;Logout failed on backend&quot;, e);
    }
    setUser(null);
    setTenant(null);
    setWarningModalOpen(false);
    setCountdown(60);
    localStorage.removeItem(&quot;tenant_info&quot;);
    removeSessionCookie();
    delete api.defaults.headers.common[&quot;X-Tenant-ID&quot;];
    window.location.href = &quot;/login&quot;;
  }, []);
  const fetchAndSetUser = useCallback(async () =&gt; {
    setLoading(true);
    try {
      const { data } = await api.get&lt;User&gt;(&quot;/auth/me/&quot;);
      setUser(data);
    } catch (error) {
      console.error(&quot;Falha ao buscar dados do usuário, deslogando:&quot;, error);
      setUser(null);
      setTenant(null);
    } finally {
      setLoading(false);
    }
  }, []);
  const login = async (tenantInfo: Tenant) =&gt; {
    localStorage.setItem(&quot;tenant_info&quot;, JSON.stringify(tenantInfo));
    setSessionCookie();
    api.defaults.headers.common[&quot;X-Tenant-ID&quot;] = tenantInfo.schema_name;
    await fetchAndSetUser();
    setTenant(tenantInfo);
  };
  const resetInactivityTimer = useCallback(() =&gt; {
    clearTimeout(inactivityTimer.current);
    inactivityTimer.current = setTimeout(
      () =&gt; {
        setWarningModalOpen(true);
      },
      10 * 60 * 1000 // 10 minutes
    );
  }, []);
  const continueSession = useCallback(() =&gt; {
    setWarningModalOpen(false);
    clearInterval(countdownTimer.current);
    setCountdown(60);
    resetInactivityTimer();
  }, [resetInactivityTimer]);
  useEffect(() =&gt; {
    const activityEvents = [
      &quot;mousemove&quot;,
      &quot;keydown&quot;,
      &quot;click&quot;,
      &quot;scroll&quot;,
      &quot;touchstart&quot;,
    ];
    if (user) {
      resetInactivityTimer();
      activityEvents.forEach((event) =&gt;
        window.addEventListener(event, resetInactivityTimer)
      );
    }
    return () =&gt; {
      activityEvents.forEach((event) =&gt;
        window.removeEventListener(event, resetInactivityTimer)
      );
      clearTimeout(inactivityTimer.current);
    };
  }, [user, resetInactivityTimer]);
  useEffect(() =&gt; {
    const interceptor = api.interceptors.response.use(
      (response) =&gt; response,
      async (error) =&gt; {
        const originalRequest = error.config;
        if (
          error.response?.status === 401 &amp;&amp;
          !originalRequest._retry &amp;&amp;
          !originalRequest.url.includes(&quot;/token/&quot;) &amp;&amp;
          !originalRequest.url.includes(&quot;/auth/logout/&quot;)
        ) {
          if (isRefreshing.current) {
            return new Promise((resolve) =&gt; {
              failedQueue.current.push(() =&gt; resolve(api(originalRequest)));
            });
          }
          originalRequest._retry = true;
          isRefreshing.current = true;
          try {
            await api.post(&quot;/token/refresh/&quot;);
            failedQueue.current.forEach((promise) =&gt; promise());
            failedQueue.current = [];
            return api(originalRequest);
          } catch (refreshError) {
            await logout();
            return Promise.reject(refreshError);
          } finally {
            isRefreshing.current = false;
          }
        }
        return Promise.reject(error);
      }
    );
    return () =&gt; api.interceptors.response.eject(interceptor);
  }, [logout]);
  useEffect(() =&gt; {
    if (isWarningModalOpen) {
      countdownTimer.current = setInterval(() =&gt; {
        setCountdown((prev) =&gt; {
          if (prev &lt;= 1) {
            clearInterval(countdownTimer.current);
            logout();
            return 0;
          }
          return prev - 1;
        });
      }, 1000);
    }
    return () =&gt; clearInterval(countdownTimer.current);
  }, [isWarningModalOpen, logout]);
  useEffect(() =&gt; {
    const initializeAuth = async () =&gt; {
      if (!hasSessionCookie()) {
         await logout();
         setLoading(false);
         return;
      }
      const tenantInfoRaw = localStorage.getItem(&quot;tenant_info&quot;);
      if (tenantInfoRaw) {
        try {
          const tenantInfo = JSON.parse(tenantInfoRaw);
          api.defaults.headers.common[&quot;X-Tenant-ID&quot;] = tenantInfo.schema_name;
          setTenant(tenantInfo);
          await fetchAndSetUser();
        } catch (e) {
          console.error(&quot;Failed to parse tenant info, clearing it.&quot;, e);
          localStorage.removeItem(&quot;tenant_info&quot;);
          setLoading(false);
        }
      } else {
        setLoading(false);
      }
    };
    initializeAuth();
  }, [fetchAndSetUser, logout]);
  return {
    user,
    setUser,
    tenant,
    login,
    logout,
    loading,
    isWarningModalOpen,
    countdown,
    resetInactivityTimer,
    continueSession,
  };
};
export const AuthProvider = ({ children }: { children: ReactNode }) =&gt; {
  const authLogic = useAuthLogic();
  return (
    &lt;AuthContext.Provider value={authLogic}&gt;{children}&lt;/AuthContext.Provider&gt;
  );
};
export const useAuth = () =&gt; {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error(&quot;useAuth deve ser usado dentro de um AuthProvider&quot;);
  }
  return context;
};</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\pages\App.tsx <span style="float:right">(101 linhas)</span></div>
                                <pre class="code-block">import {
  BrowserRouter as Router,
  Route,
  Routes,
  useNavigate,
} from &quot;react-router-dom&quot;;
import { AuthProvider } from &quot;../hooks/useAuth&quot;;
import { Toaster } from &quot;react-hot-toast&quot;;
import ProtectedRoute from &quot;../components/ProtectedRoute&quot;;
import Login from &quot;./Login&quot;;
import Processos from &quot;./Processos&quot;;
import ProcessoCreate from &quot;./ProcessoCreate&quot;;
import ProcessoDetail from &quot;./ProcessoDetail&quot;;
import UserManagement from &quot;./UserManagement&quot;;
import PermissionRoute from &quot;../components/PermissionRoute&quot;;
import &quot;../styles/global-animations.css&quot;; // Importa as animações globais
import GerenciarEmpresas from &quot;./GerenciarEmpresas&quot;;
import ManageCRDII from &quot;./ManageCRDII&quot;;
import MainLayout from &quot;../components/MainLayout&quot;;
import Dashboard from &quot;./Dashboard&quot;;
import { useEffect } from &quot;react&quot;;
const LogoutNavigator = () =&gt; {
  const navigate = useNavigate();
  useEffect(() =&gt; {
    const handleLogout = () =&gt; {
      navigate(&quot;/login&quot;);
    };
    window.addEventListener(&quot;force-logout&quot;, handleLogout);
    return () =&gt; window.removeEventListener(&quot;force-logout&quot;, handleLogout);
  }, [navigate]);
  return null; // Este componente não renderiza nada
};
const AuthenticatedRoutes = () =&gt; {
  return (
    &lt;AuthProvider&gt;
      &lt;LogoutNavigator /&gt;
      &lt;Routes&gt;
        {/* Rotas Protegidas: Primeiro verifica a autenticação, depois renderiza o Layout */}
        &lt;Route element={&lt;ProtectedRoute /&gt;}&gt;
          &lt;Route element={&lt;MainLayout /&gt;}&gt;
            {/* Rota raiz (Dashboard) */}
            &lt;Route element={&lt;PermissionRoute permission=&quot;page_dashboard&quot; /&gt;}&gt;
              &lt;Route path=&quot;/&quot; element={&lt;Dashboard /&gt;} /&gt;
              &lt;Route path=&quot;/dashboard&quot; element={&lt;Dashboard /&gt;} /&gt;
            &lt;/Route&gt;
            {/* Rotas de Processos */}
            &lt;Route element={&lt;PermissionRoute permission=&quot;page_compras&quot; /&gt;}&gt;
              &lt;Route path=&quot;/processos&quot; element={&lt;Processos /&gt;} /&gt;
            &lt;/Route&gt;
            &lt;Route path=&quot;/processos/:id&quot; element={&lt;ProcessoDetail /&gt;} /&gt;
            &lt;Route
              element={&lt;PermissionRoute permission=&quot;can_create_processo&quot; /&gt;}
            &gt;
              &lt;Route path=&quot;/processos/novo&quot; element={&lt;ProcessoCreate /&gt;} /&gt;
            &lt;/Route&gt;
            {/* Rotas de Gerenciamento */}
            &lt;Route
              element={&lt;PermissionRoute permission=&quot;gerenciar.usuarios&quot; /&gt;}
            &gt;
              &lt;Route path=&quot;/gerenciar-usuarios&quot; element={&lt;UserManagement /&gt;} /&gt;
            &lt;/Route&gt;
            &lt;Route
              element={&lt;PermissionRoute permission=&quot;gerenciar.empresas&quot; /&gt;}
            &gt;
              &lt;Route
                path=&quot;/gerenciar-empresas&quot;
                element={&lt;GerenciarEmpresas /&gt;}
              /&gt;
            &lt;/Route&gt;
            &lt;Route path=&quot;/gerenciar-crdiis&quot; element={&lt;ManageCRDII /&gt;} /&gt;
          &lt;/Route&gt;
        &lt;/Route&gt;
      &lt;/Routes&gt;
    &lt;/AuthProvider&gt;
  );
};
const AppRoutes = () =&gt; {
  return (
    &lt;&gt;
      &lt;Toaster
        position=&quot;top-center&quot;
        reverseOrder={false}
        toastOptions={{
          duration: 3000,
        }}
      /&gt;
      &lt;Routes&gt;
        {/* Rota Pública - Login fica FORA do AuthProvider para evitar o loop */}
        &lt;Route path=&quot;/login&quot; element={&lt;Login /&gt;} /&gt;
        {/* Todas as outras rotas ficam DENTRO do AuthProvider */}
        &lt;Route path=&quot;/*&quot; element={&lt;AuthenticatedRoutes /&gt;} /&gt;
      &lt;/Routes&gt;
    &lt;/&gt;
  );
};
const App = () =&gt; (
  &lt;Router&gt;
    &lt;AppRoutes /&gt;
  &lt;/Router&gt;
);
export default App;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\pages\Dashboard.tsx <span style="float:right">(481 linhas)</span></div>
                                <pre class="code-block">import React, { useState, useEffect } from &quot;react&quot;;
import api from &quot;../services/api&quot;;
import {
  DollarSign,
  CheckCircle,
  Clock,
  Archive,
  PieChart,
  AlertCircle,
  BarChart2,
  TrendingUp,
  Activity,
  User,
  AlertTriangle,
  XCircle,
  Filter,
  X,
} from &quot;lucide-react&quot;;
import {
  ResponsiveContainer,
  PieChart as RechartsPieChart,
  Pie,
  Cell,
  Tooltip,
  Legend,
  BarChart as RechartsBarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  LineChart,
  Line,
} from &quot;recharts&quot;;
import &quot;../styles/dashboard.css&quot;;
import ProcessosModal from &quot;../components/ProcessosModal&quot;;
import &quot;../styles/ProcessosModal.css&quot;;
import { Processo } from &quot;./Processos&quot;;
import toast from &quot;react-hot-toast&quot;; // Importar toast para feedback
interface StatsData {
  total_processos: number;
  concluidos: number;
  em_andamento: number;
  parcial: number;
  arquivados: number;
  cancelados: number;
}
interface ExtraStatsData {
  tempo_medio_dias: number;
  stagnant_count: number;
  top_crdiis: { name: string; total: number }[];
  top_users: { username: string; total: number }[];
  recent_activity: {
    id: number;
    usuario: string;
    processo: string;
    status_novo: string;
    data: string;
  }[];
}
interface ChartDataPoint {
    name: string;
    criados: number;
    concluidos: number;
}
interface DashboardResponse {
  stats: StatsData;
  extra_stats: ExtraStatsData;
  chart_data: ChartDataPoint[];
}
interface CRDII {
    id: number;
    nome: string;
}
interface StatCardProps {
  title: string;
  value: number | string;
  icon: React.ReactNode;
  colorClass: string;
  onClick?: () =&gt; void; // Garantir que onClick seja opcional na interface
  clickable?: boolean;
}
const StatCard: React.FC&lt;StatCardProps&gt; = ({
  title,
  value,
  icon,
  colorClass,
  onClick,
  clickable = false
}) =&gt; (
  &lt;div 
    className={`stat-card ${colorClass} ${clickable ? &#x27;clickable-card&#x27; : &#x27;&#x27;}`} 
    onClick={clickable ? onClick : undefined}
    style={clickable ? { cursor: &#x27;pointer&#x27; } : {}}
  &gt;
    &lt;div className=&quot;stat-card-icon&quot;&gt;{icon}&lt;/div&gt;
    &lt;div className=&quot;stat-card-info&quot;&gt;
      &lt;span className=&quot;stat-card-value&quot;&gt;{value}&lt;/span&gt;
      &lt;span className=&quot;stat-card-title&quot;&gt;{title}&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;
);
const Dashboard: React.FC = () =&gt; {
  const [stats, setStats] = useState&lt;StatsData | null&gt;(null);
  const [extraStats, setExtraStats] = useState&lt;ExtraStatsData | null&gt;(null);
  const [chartData, setChartData] = useState&lt;ChartDataPoint[]&gt;([]);
  const [availableCrdiis, setAvailableCrdiis] = useState&lt;CRDII[]&gt;([]);
  const [filterYear, setFilterYear] = useState&lt;string&gt;(&quot;&quot;);
  const [filterMonth, setFilterMonth] = useState&lt;string&gt;(&quot;&quot;);
  const [filterCrdii, setFilterCrdii] = useState&lt;string&gt;(&quot;&quot;);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState&lt;string | null&gt;(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [loadingModal, setLoadingModal] = useState(false);
  const [modalContent, setModalContent] = useState&lt;{
    title: string;
    processos: Processo[];
  } | null&gt;(null);
  useEffect(() =&gt; {
      api.get&lt;CRDII[]&gt;(&#x27;crdiis/&#x27;).then(res =&gt; setAvailableCrdiis(res.data)).catch(console.error);
  }, []);
  const fetchDashboardData = async () =&gt; {
    setLoading(true);
    setError(null);
    try {
        const params = new URLSearchParams();
        if (filterYear) params.append(&#x27;year&#x27;, filterYear);
        if (filterMonth) params.append(&#x27;month&#x27;, filterMonth);
        if (filterCrdii) params.append(&#x27;crdii&#x27;, filterCrdii);
        const response = await api.get&lt;DashboardResponse&gt;(`dashboard/stats/?${params.toString()}`);
        setStats(response.data.stats);
        setExtraStats(response.data.extra_stats);
        setChartData(response.data.chart_data);
    } catch (err: any) {
        console.error(&quot;Erro ao carregar dashboard:&quot;, err);
        const msg = err.response?.data?.detail || &quot;Não foi possível carregar os dados.&quot;;
        setError(msg);
    } finally {
        setLoading(false);
    }
  };
  useEffect(() =&gt; {
      fetchDashboardData();
  }, [filterYear, filterMonth, filterCrdii]);
  const handleCardClick = async (statusKey: string, title: string) =&gt; {
      if (loadingModal) return;
      setLoadingModal(true);
      const toastId = toast.loading(&quot;Carregando detalhes...&quot;);
      try {
          const params = new URLSearchParams();
          if (statusKey !== &#x27;total&#x27;) {
              params.append(&#x27;status&#x27;, statusKey);
          }
          if (filterCrdii) params.append(&#x27;crdii&#x27;, filterCrdii);
          params.append(&#x27;page_size&#x27;, &#x27;100&#x27;); 
          const response = await api.get&lt;{ results: Processo[] }&gt;(`processos/?${params.toString()}`);
          let filteredResults = response.data.results;
          if (filterYear || filterMonth) {
              filteredResults = filteredResults.filter(p =&gt; {
                  const d = new Date(p.data_criacao);
                  const yearMatch = filterYear ? d.getFullYear().toString() === filterYear : true;
                  const monthMatch = filterMonth ? (d.getMonth() + 1).toString() === filterMonth : true;
                  return yearMatch &amp;&amp; monthMatch;
              });
          }
          setModalContent({
              title: title,
              processos: filteredResults
          });
          setIsModalOpen(true);
          toast.dismiss(toastId);
      } catch (err) {
          console.error(&quot;Erro ao abrir modal:&quot;, err);
          toast.error(&quot;Erro ao carregar detalhes.&quot;, { id: toastId });
      } finally {
          setLoadingModal(false);
      }
  };
  const getStatusColorClass = (status: string) =&gt; {
    if (!status) return &quot;&quot;;
    const s = status.toLowerCase();
    if (s.includes(&quot;andamento&quot;) || s.includes(&quot;nao&quot;) || s.includes(&quot;não&quot;)) return &quot;nao_concluido&quot;;
    if (s.includes(&quot;conclu&quot;)) return &quot;concluido&quot;;
    if (s.includes(&quot;parcial&quot;)) return &quot;parcial&quot;;
    if (s.includes(&quot;arquiv&quot;)) return &quot;arquivado&quot;;
    if (s.includes(&quot;cancel&quot;)) return &quot;cancelado&quot;;
    return s.replace(/\s+/g, &quot;_&quot;);
  };
  const pieChartData = stats
    ? [
        { name: &quot;Concluídos&quot;, value: stats.concluidos, color: &quot;#10B981&quot; },
        { name: &quot;Em Andamento&quot;, value: stats.em_andamento, color: &quot;#F59E0B&quot; },
        { name: &quot;Parcial&quot;, value: stats.parcial, color: &quot;#8B5CF6&quot; },
        { name: &quot;Arquivados&quot;, value: stats.arquivados, color: &quot;#6B7280&quot; },
        { name: &quot;Cancelados&quot;, value: stats.cancelados, color: &quot;#EF4444&quot; },
      ]
    : [];
  const RADIAN = Math.PI / 180;
  const renderCustomizedLabel = ({ cx, cy, midAngle, innerRadius, outerRadius, percent }: any) =&gt; {
    const radius = innerRadius + (outerRadius - innerRadius) * 0.5;
    const x = cx + radius * Math.cos(-midAngle * RADIAN);
    const y = cy + radius * Math.sin(-midAngle * RADIAN);
    return percent &gt; 0 ? (
      &lt;text x={x} y={y} fill=&quot;white&quot; textAnchor=&quot;middle&quot; dominantBaseline=&quot;central&quot;&gt;
        {`${(percent * 100).toFixed(0)}%`}
      &lt;/text&gt;
    ) : null;
  };
  return (
    &lt;div className=&quot;page-container&quot;&gt;
      &lt;div className=&quot;dashboard-page&quot;&gt;
        &lt;header className=&quot;dashboard-header&quot;&gt;
          &lt;div&gt;
            &lt;div className=&quot;header-title-container&quot;&gt;
              &lt;BarChart2 size={28} /&gt;
              &lt;h1&gt;Dashboard&lt;/h1&gt;
            &lt;/div&gt;
            &lt;p className=&quot;header-subtitle&quot;&gt;
              Visão geral, eficiência e atividade recente.
            &lt;/p&gt;
          &lt;/div&gt;
        &lt;/header&gt;
        {/* --- Barra de Filtros --- */}
        &lt;div className=&quot;dashboard-filters&quot;&gt;
          &lt;div className=&quot;filter-group&quot;&gt;
            &lt;Filter size={18} color=&quot;#6b7280&quot; /&gt;
            &lt;span className=&quot;filter-label&quot;&gt;Filtrar:&lt;/span&gt;
          &lt;/div&gt;
          &lt;select
            className=&quot;filter-select&quot;
            value={filterYear}
            onChange={(e) =&gt; setFilterYear(e.target.value)}
          &gt;
            &lt;option value=&quot;&quot;&gt;Todos os Anos&lt;/option&gt;
            &lt;option value=&quot;2026&quot;&gt;2026&lt;/option&gt;
            &lt;option value=&quot;2025&quot;&gt;2025&lt;/option&gt;
            &lt;option value=&quot;2024&quot;&gt;2024&lt;/option&gt;
          &lt;/select&gt;
          &lt;select
            className=&quot;filter-select&quot;
            value={filterMonth}
            onChange={(e) =&gt; setFilterMonth(e.target.value)}
          &gt;
            &lt;option value=&quot;&quot;&gt;Todos os Meses&lt;/option&gt;
            {Array.from({ length: 12 }, (_, i) =&gt; (
              &lt;option key={i + 1} value={i + 1}&gt;
                {new Date(0, i).toLocaleString(&quot;pt-BR&quot;, { month: &quot;long&quot; })}
              &lt;/option&gt;
            ))}
          &lt;/select&gt;
          &lt;select
            className=&quot;filter-select&quot;
            value={filterCrdii}
            onChange={(e) =&gt; setFilterCrdii(e.target.value)}
          &gt;
            &lt;option value=&quot;&quot;&gt;Todos os CRDIIs&lt;/option&gt;
            {availableCrdiis.map((crdii) =&gt; (
              &lt;option key={crdii.id} value={crdii.id}&gt;
                {crdii.nome}
              &lt;/option&gt;
            ))}
          &lt;/select&gt;
          {(filterYear || filterMonth || filterCrdii) &amp;&amp; (
            &lt;button
              className=&quot;btn-clear-filters&quot;
              onClick={() =&gt; {
                setFilterYear(&quot;&quot;);
                setFilterMonth(&quot;&quot;);
                setFilterCrdii(&quot;&quot;);
              }}
            &gt;
              &lt;X size={16} /&gt; Limpar
            &lt;/button&gt;
          )}
        &lt;/div&gt;
        &lt;div className=&quot;dashboard-content&quot;&gt;
          {loading &amp;&amp; (
            &lt;p className=&quot;loading-message&quot;&gt;Carregando estatísticas...&lt;/p&gt;
          )}
          {error &amp;&amp; (
            &lt;div className=&quot;error-message&quot;&gt;
              &lt;AlertCircle size={20} /&gt; {error}
            &lt;/div&gt;
          )}
          {stats &amp;&amp; extraStats &amp;&amp; !loading &amp;&amp; !error &amp;&amp; (
            &lt;&gt;
              {/* --- 1. Cartões de Estatísticas --- */}
              &lt;div className=&quot;stats-grid&quot;&gt;
                &lt;StatCard
                  title=&quot;Total de Processos&quot;
                  value={stats.total_processos}
                  icon={&lt;PieChart size={24} color=&quot;white&quot; /&gt;}
                  colorClass=&quot;blue&quot;
                  clickable={true}
                  onClick={() =&gt; handleCardClick(&#x27;total&#x27;, &#x27;Todos os Processos&#x27;)}
                /&gt;
                &lt;StatCard
                  title=&quot;Tempo Médio (Dias)&quot;
                  value={extraStats.tempo_medio_dias}
                  icon={&lt;TrendingUp size={24} color=&quot;white&quot; /&gt;}
                  colorClass={extraStats.tempo_medio_dias &gt; 30 ? &quot;red&quot; : &quot;green&quot;}
                /&gt;
                {extraStats.stagnant_count &gt; 0 &amp;&amp; (
                  &lt;StatCard
                    title=&quot;Processos Parados (&gt;30d)&quot;
                    value={extraStats.stagnant_count}
                    icon={&lt;AlertTriangle size={24} color=&quot;white&quot; /&gt;}
                    colorClass=&quot;red&quot;
                  /&gt;
                )}
                &lt;StatCard
                  title=&quot;Concluídos&quot;
                  value={stats.concluidos}
                  icon={&lt;CheckCircle size={24} color=&quot;white&quot; /&gt;}
                  colorClass=&quot;green&quot;
                  clickable={true}
                  onClick={() =&gt; handleCardClick(&#x27;concluido&#x27;, &#x27;Processos Concluídos&#x27;)}
                /&gt;
                &lt;StatCard
                  title=&quot;Em Andamento&quot;
                  value={stats.em_andamento}
                  icon={&lt;Clock size={24} color=&quot;white&quot; /&gt;}
                  colorClass=&quot;amber&quot;
                  clickable={true}
                  onClick={() =&gt; handleCardClick(&#x27;nao_concluido&#x27;, &#x27;Processos em Andamento&#x27;)}
                /&gt;
                &lt;StatCard
                  title=&quot;Parcial&quot;
                  value={stats.parcial}
                  icon={&lt;DollarSign size={24} color=&quot;white&quot; /&gt;}
                  colorClass=&quot;purple&quot;
                  clickable={true}
                  onClick={() =&gt; handleCardClick(&#x27;parcial&#x27;, &#x27;Processos Parcial&#x27;)}
                /&gt;
                &lt;StatCard
                  title=&quot;Arquivados&quot;
                  value={stats.arquivados}
                  icon={&lt;Archive size={24} color=&quot;white&quot; /&gt;}
                  colorClass=&quot;gray&quot;
                  clickable={true}
                  onClick={() =&gt; handleCardClick(&#x27;arquivado&#x27;, &#x27;Processos Arquivados&#x27;)}
                /&gt;
                &lt;StatCard
                  title=&quot;Cancelados&quot;
                  value={stats.cancelados}
                  icon={&lt;XCircle size={24} color=&quot;white&quot; /&gt;}
                  colorClass=&quot;red&quot;
                  clickable={true}
                  onClick={() =&gt; handleCardClick(&#x27;cancelado&#x27;, &#x27;Processos Cancelados&#x27;)}
                /&gt;
              &lt;/div&gt;
              {/* --- 2. Gráficos --- */}
              &lt;div className=&quot;charts-grid&quot;&gt;
                {/* Pizza */}
                &lt;div className=&quot;chart-container&quot;&gt;
                  &lt;h3&gt;Distribuição por Status&lt;/h3&gt;
                  &lt;ResponsiveContainer width=&quot;100%&quot; height={300}&gt;
                    &lt;RechartsPieChart&gt;
                      &lt;Pie
                        data={pieChartData}
                        cx=&quot;50%&quot;
                        cy=&quot;50%&quot;
                        labelLine={false}
                        label={renderCustomizedLabel}
                        outerRadius={100}
                        innerRadius={50}
                        fill=&quot;#8884d8&quot;
                        dataKey=&quot;value&quot;
                        nameKey=&quot;name&quot;
                        paddingAngle={2}
                      &gt;
                        {pieChartData.map((entry) =&gt; (
                          &lt;Cell key={`cell-${entry.name}`} fill={entry.color} /&gt;
                        ))}
                      &lt;/Pie&gt;
                      &lt;Tooltip /&gt;
                      &lt;Legend /&gt;
                    &lt;/RechartsPieChart&gt;
                  &lt;/ResponsiveContainer&gt;
                &lt;/div&gt;
                {/* Barras CRDII */}
                &lt;div className=&quot;chart-container&quot;&gt;
                  &lt;h3&gt;Top 5 CRDIIs&lt;/h3&gt;
                  &lt;ResponsiveContainer width=&quot;100%&quot; height={300}&gt;
                    &lt;RechartsBarChart
                      layout=&quot;vertical&quot;
                      data={extraStats.top_crdiis}
                      margin={{ top: 5, right: 30, left: 40, bottom: 5 }}
                    &gt;
                      &lt;CartesianGrid strokeDasharray=&quot;3 3&quot; /&gt;
                      &lt;XAxis type=&quot;number&quot; allowDecimals={false} /&gt;
                      &lt;YAxis
                        dataKey=&quot;name&quot;
                        type=&quot;category&quot;
                        width={100}
                        tick={{ fontSize: 11 }}
                      /&gt;
                      &lt;Tooltip cursor={{ fill: &quot;rgba(240, 240, 240, 0.5)&quot; }} /&gt;
                      &lt;Bar dataKey=&quot;total&quot; fill=&quot;#63b8f1&quot; radius={[0, 4, 4, 0]} barSize={20} /&gt;
                    &lt;/RechartsBarChart&gt;
                  &lt;/ResponsiveContainer&gt;
                &lt;/div&gt;
                {/* Linha Evolução */}
                {chartData.length &gt; 0 &amp;&amp; (
                  &lt;div className=&quot;chart-container chart-container-full-width&quot;&gt;
                    &lt;h3&gt;Evolução {filterYear ? &quot;Mensal&quot; : &quot;Anual&quot;}&lt;/h3&gt;
                    &lt;ResponsiveContainer width=&quot;100%&quot; height={250}&gt;
                      &lt;LineChart
                        data={chartData}
                        margin={{ top: 5, right: 20, left: -10, bottom: 5 }}
                      &gt;
                        &lt;CartesianGrid strokeDasharray=&quot;3 3&quot; /&gt;
                        &lt;XAxis dataKey=&quot;name&quot; /&gt;
                        &lt;YAxis allowDecimals={false} /&gt;
                        &lt;Tooltip /&gt;
                        &lt;Legend /&gt;
                        &lt;Line type=&quot;monotone&quot; dataKey=&quot;criados&quot; name=&quot;Criados&quot; stroke=&quot;#f6bb3b&quot; strokeWidth={2} dot={{ r: 4 }} /&gt;
                        &lt;Line type=&quot;monotone&quot; dataKey=&quot;concluidos&quot; name=&quot;Concluídos&quot; stroke=&quot;#10B981&quot; strokeWidth={2} dot={{ r: 4 }} /&gt;
                      &lt;/LineChart&gt;
                    &lt;/ResponsiveContainer&gt;
                  &lt;/div&gt;
                )}
              &lt;/div&gt;
              {/* --- 3. Listas --- */}
              &lt;div className=&quot;dashboard-lists-grid&quot;&gt;
                {/* Ranking Users */}
                &lt;div className=&quot;chart-container&quot;&gt;
                  &lt;div className=&quot;list-header&quot;&gt;
                    &lt;User size={20} className=&quot;list-header-icon&quot; /&gt;
                    &lt;h3&gt;Top Solicitantes&lt;/h3&gt;
                  &lt;/div&gt;
                  &lt;ul className=&quot;list-content&quot;&gt;
                    {extraStats.top_users.map((u, idx) =&gt; (
                      &lt;li key={idx} className=&quot;list-item&quot;&gt;
                        &lt;div className=&quot;list-item-row&quot;&gt;
                          &lt;span&gt;{idx + 1}. {u.username}&lt;/span&gt;
                          &lt;span className=&quot;list-item-value&quot;&gt;{u.total}&lt;/span&gt;
                        &lt;/div&gt;
                      &lt;/li&gt;
                    ))}
                  &lt;/ul&gt;
                &lt;/div&gt;
                {/* Atividade Recente */}
                &lt;div className=&quot;chart-container&quot;&gt;
                  &lt;div className=&quot;list-header&quot;&gt;
                    &lt;Activity size={20} className=&quot;list-header-icon&quot; /&gt;
                    &lt;h3&gt;Atividade Recente&lt;/h3&gt;
                  &lt;/div&gt;
                  &lt;ul className=&quot;list-content&quot;&gt;
                    {extraStats.recent_activity.map((act) =&gt; (
                      &lt;li key={act.id} className=&quot;list-item&quot;&gt;
                        &lt;div&gt;
                          &lt;strong&gt;{act.usuario}&lt;/strong&gt; mudou &lt;strong&gt;{act.processo}&lt;/strong&gt;
                        &lt;/div&gt;
                        &lt;div className=&quot;list-item-details&quot;&gt;
                          Para: &lt;span className={`status-badge status-${getStatusColorClass(act.status_novo)}`}&gt;{act.status_novo}&lt;/span&gt;
                          {&quot; • &quot;}
                          {new Date(act.data).toLocaleDateString()}
                        &lt;/div&gt;
                      &lt;/li&gt;
                    ))}
                  &lt;/ul&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/&gt;
          )}
        &lt;/div&gt;
      &lt;/div&gt;
      {/* Componente Modal */}
      {modalContent &amp;&amp; (
        &lt;ProcessosModal
          isOpen={isModalOpen}
          onClose={() =&gt; setIsModalOpen(false)}
          title={modalContent.title}
          processos={modalContent.processos}
          onDataChange={fetchDashboardData} // Recarrega dashboard se houver mudança no modal
        /&gt;
      )}
    &lt;/div&gt;
  );
};
export default Dashboard;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\pages\GerenciarEmpresas.tsx <span style="float:right">(346 linhas)</span></div>
                                <pre class="code-block">import React, { useState, useEffect, useCallback } from &quot;react&quot;;
import api from &quot;../services/api&quot;;
import toast from &quot;react-hot-toast&quot;;
import { Briefcase, PlusCircle, Pencil as Edit, Trash2, Search, Globe, Check, Filter, X } from &quot;lucide-react&quot;;
import &quot;../styles/userManagement.css&quot;; // Reutilizando estilos
import &quot;../styles/processos.css&quot;; // Reutilizar estilos de filtro
import Modal from &quot;../components/Modal&quot;;
import { useAuth } from &quot;../hooks/useAuth&quot;;
import UserManagementSkeleton from &quot;../components/UserManagementSkeleton&quot;;
interface Tenant {
  id: number;
  nome: string;
  schema_name: string;
  domain_url?: string; // Mantido se for usado em outro lugar, mas o retorno da API é &#x27;domain&#x27;
  domain?: string;
  criado_em?: string;
}
const GerenciarEmpresas: React.FC = () =&gt; {
  const [tenants, setTenants] = useState&lt;Tenant[]&gt;([]);
  const [loading, setLoading] = useState(true);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingTenant, setEditingTenant] = useState&lt;Tenant | null&gt;(null);
  const [tenantToDelete, setTenantToDelete] = useState&lt;Tenant | null&gt;(null);
  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);
  const [searchTerm, setSearchTerm] = useState(&quot;&quot;);
  const [ordering, setOrdering] = useState(&quot;-criado_em&quot;); // &#x27;-criado_em&#x27;, &#x27;criado_em&#x27;, &#x27;nome&#x27;, &#x27;-nome&#x27;
  const [showFilters, setShowFilters] = useState(false);
  const [newTenantName, setNewTenantName] = useState(&quot;&quot;);
  const [newTenantSchema, setNewTenantSchema] = useState(&quot;&quot;);
  const [newTenantDomain, setNewTenantDomain] = useState(&quot;&quot;);
  const [isSavingTenant, setIsSavingTenant] = useState(false);
  const { user: currentUser } = useAuth();
  const fetchTenants = useCallback(async () =&gt; {
    setLoading(true);
    try {
      const response = await api.get&lt;Tenant[]&gt;(&quot;/tenants/&quot;);
      setTenants(response.data);
    } catch (error) {
      console.error(&quot;Erro ao buscar empresas&quot;, error);
      toast.error(&quot;Não foi possível carregar as empresas.&quot;);
    } finally {
      setLoading(false);
    }
  }, []);
  useEffect(() =&gt; {
    if (currentUser?.is_superuser || currentUser?.permissions?.gerenciar?.empresas) {
      fetchTenants();
    }
  }, [fetchTenants, currentUser]);
  const handleCreateTenant = () =&gt; {
    setEditingTenant(null);
    setNewTenantName(&quot;&quot;);
    setNewTenantSchema(&quot;&quot;);
    setNewTenantDomain(&quot;&quot;);
    setIsModalOpen(true);
  };
  const handleEditTenant = (tenant: Tenant) =&gt; {
    setEditingTenant(tenant);
    setNewTenantName(tenant.nome);
    setNewTenantSchema(tenant.schema_name);
    setNewTenantDomain(tenant.domain || &quot;&quot;);
    setIsModalOpen(true);
  };
  const openDeleteModal = (tenant: Tenant) =&gt; {
    setTenantToDelete(tenant);
    setIsDeleteModalOpen(true);
  };
  const confirmDeleteTenant = async () =&gt; {
    if (!tenantToDelete) return;
    try {
      await api.delete(`/tenants/${tenantToDelete.id}/`);
      toast.success(&quot;Empresa excluída com sucesso!&quot;);
      fetchTenants();
    } catch (error: any) {
      toast.error(error.response?.data?.detail || &quot;Erro ao excluir empresa.&quot;);
    } finally {
      setTenantToDelete(null);
      setIsDeleteModalOpen(false);
    }
  };
    const handleSaveTenant = async (e: React.FormEvent) =&gt; {
    e.preventDefault();
    if (!newTenantName || !newTenantSchema || !newTenantDomain) {
      toast.error(&quot;Preencha todos os campos.&quot;);
      return;
    }
    if (newTenantDomain.match(/^https?:\/\//)) {
      toast.error(&quot;O domínio não deve conter protocolo (http:// ou https://).&quot;);
      return;
    }
    const domainRegex = /^(localhost|[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)+)$/;
    if (!domainRegex.test(newTenantDomain)) {
      toast.error(
        &quot;Domínio inválido. Use o formato &#x27;empresa.com.br&#x27; ou &#x27;empresa.localhost&#x27;.&quot;
      );
      return;
    }
    const schemaRegex = /^[a-z0-9_]+$/;
    if (!schemaRegex.test(newTenantSchema)) {
      toast.error(
        &quot;O Schema Name deve conter apenas letras minúsculas, números e sublinhados (sem espaços).&quot;
      );
      return;
    }
    setIsSavingTenant(true);
    try {
      if (editingTenant) {
        await api.patch(`/tenants/${editingTenant.id}/`, {
          nome: newTenantName,
          domain_url: newTenantDomain,
        });
        toast.success(&quot;Empresa atualizada com sucesso!&quot;);
      } else {
        await api.post(&quot;/tenants/&quot;, {
          nome: newTenantName,
          domain_url: newTenantDomain,
          schema_name: newTenantSchema,
        });
        toast.success(&quot;Empresa criada com sucesso!&quot;);
      }
      setIsModalOpen(false);
      fetchTenants();
    } catch (error: any) {
        toast.error(error.response?.data?.detail || &quot;Erro ao salvar empresa.&quot;);
    } finally {
      setIsSavingTenant(false);
    }
  };
  const filteredTenants = tenants
    .filter((tenant) =&gt;
      tenant.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||
      tenant.schema_name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      (tenant.domain || &quot;&quot;).toLowerCase().includes(searchTerm.toLowerCase())
    )
    .sort((a, b) =&gt; {
      if (ordering === &quot;nome&quot;) return a.nome.localeCompare(b.nome);
      if (ordering === &quot;-nome&quot;) return b.nome.localeCompare(a.nome);
      if (ordering === &quot;criado_em&quot;) {
        return (a.criado_em || &quot;&quot;).localeCompare(b.criado_em || &quot;&quot;);
      }
      if (ordering === &quot;-criado_em&quot;) {
        return (b.criado_em || &quot;&quot;).localeCompare(a.criado_em || &quot;&quot;);
      }
      return 0;
    });
  if (!currentUser?.permissions?.gerenciar?.empresas) {
    return (
      &lt;div className=&quot;user-management-container page-container&quot;&gt;
        &lt;h1&gt;Acesso Negado&lt;/h1&gt;
        &lt;p&gt;Você não tem permissão para acessar esta página.&lt;/p&gt;
      &lt;/div&gt;
    );
  }
  if (loading) return &lt;UserManagementSkeleton /&gt;;
  return (
    &lt;div className=&quot;user-management-container page-container&quot;&gt;
      &lt;header className=&quot;user-management-header&quot;&gt;
        &lt;div className=&quot;header-title&quot;&gt;
          &lt;Briefcase size={28} /&gt;
          &lt;h1&gt;Gerenciamento de Empresas&lt;/h1&gt;
        &lt;/div&gt;
        &lt;div className=&quot;header-actions&quot;&gt;
          &lt;div className=&quot;search-bar&quot;&gt;
            &lt;Search size={18} /&gt;
            &lt;input
              type=&quot;text&quot;
              placeholder=&quot;Buscar empresa...&quot;
              value={searchTerm}
              onChange={(e) =&gt; setSearchTerm(e.target.value)}
            /&gt;
          &lt;/div&gt;
          &lt;button
            className=&quot;btn-filter&quot;
            onClick={() =&gt; setShowFilters(!showFilters)}
          &gt;
            &lt;Filter size={18} /&gt;
            &lt;span&gt;Filtros&lt;/span&gt;
          &lt;/button&gt;
          &lt;button className=&quot;btn btn-primary&quot; onClick={handleCreateTenant}&gt;
            &lt;PlusCircle size={20} /&gt;
            Nova Empresa
          &lt;/button&gt;
        &lt;/div&gt;
      &lt;/header&gt;
      {showFilters &amp;&amp; (
        &lt;div className=&quot;filters-panel&quot;&gt;
          &lt;div className=&quot;filter-group&quot;&gt;
            &lt;select
              value={ordering}
              onChange={(e) =&gt; setOrdering(e.target.value)}
              aria-label=&quot;Ordenação&quot;
            &gt;
              &lt;option value=&quot;-criado_em&quot;&gt;Mais recentes&lt;/option&gt;
              &lt;option value=&quot;criado_em&quot;&gt;Mais antigas&lt;/option&gt;
              &lt;option value=&quot;nome&quot;&gt;Nome (A-Z)&lt;/option&gt;
              &lt;option value=&quot;-nome&quot;&gt;Nome (Z-A)&lt;/option&gt;
            &lt;/select&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      )}
      &lt;div className=&quot;user-list&quot;&gt;
        &lt;table className=&quot;user-table&quot;&gt;
          &lt;thead&gt;
            &lt;tr&gt;
              &lt;th&gt;ID&lt;/th&gt;
              &lt;th&gt;Nome da Empresa&lt;/th&gt;
              &lt;th&gt;Schema (URL)&lt;/th&gt;
              &lt;th&gt;Domínio&lt;/th&gt;
              &lt;th&gt;Data de Criação&lt;/th&gt;
              &lt;th&gt;Ações&lt;/th&gt;
            &lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody&gt;
            {filteredTenants.length === 0 ? (
              &lt;tr&gt;
                &lt;td colSpan={6} className=&quot;no-results-cell&quot;&gt;
                  Nenhuma empresa encontrada.
                &lt;/td&gt;
              &lt;/tr&gt;
            ) : (
              filteredTenants.map((tenant) =&gt; (
                &lt;tr key={tenant.id}&gt;
                  &lt;td data-label=&quot;ID&quot;&gt;{tenant.id}&lt;/td&gt;
                  &lt;td data-label=&quot;Nome&quot;&gt;{tenant.nome}&lt;/td&gt;
                  &lt;td data-label=&quot;Schema&quot;&gt;{tenant.schema_name}&lt;/td&gt;
                  &lt;td data-label=&quot;Domínio&quot;&gt;{tenant.domain || &quot;-&quot;}&lt;/td&gt;
                  &lt;td data-label=&quot;Data&quot;&gt;
                    {tenant.criado_em
                      ? new Date(tenant.criado_em).toLocaleDateString(&quot;pt-BR&quot;)
                      : &quot;-&quot;}
                  &lt;/td&gt;
                  &lt;td data-label=&quot;Ações&quot;&gt;
                    &lt;div className=&quot;user-actions&quot;&gt;
                      &lt;button
                        className=&quot;btn btn-icon btn-secondary&quot;
                        title=&quot;Editar Empresa&quot;
                        onClick={() =&gt; handleEditTenant(tenant)}
                      &gt;
                        &lt;Edit size={16} /&gt;
                      &lt;/button&gt;
                      &lt;button
                        className=&quot;btn btn-icon btn-danger&quot;
                        title=&quot;Excluir Empresa&quot;
                        onClick={() =&gt; openDeleteModal(tenant)}
                      &gt;
                        &lt;Trash2 size={16} /&gt;
                      &lt;/button&gt;
                    &lt;/div&gt;
                  &lt;/td&gt;
                &lt;/tr&gt;
              ))
            )}
          &lt;/tbody&gt;
        &lt;/table&gt;
      &lt;/div&gt;
      &lt;Modal
        title={editingTenant ? &quot;Editar Empresa&quot; : &quot;Criar Nova Empresa&quot;}
        isOpen={isModalOpen}
        onClose={() =&gt; setIsModalOpen(false)}
        showFooter={false}
      &gt;
        &lt;form onSubmit={handleSaveTenant} className=&quot;tenant-form&quot;&gt;
          &lt;div className=&quot;form-group&quot;&gt;
            &lt;label&gt;Nome da Empresa&lt;/label&gt;
            &lt;input
              type=&quot;text&quot;
              value={newTenantName}
              onChange={(e) =&gt; setNewTenantName(e.target.value)}
              placeholder=&quot;Ex: Minha Empresa Ltda&quot;
              required
            /&gt;
          &lt;/div&gt;
          &lt;div className=&quot;form-group&quot;&gt;
            &lt;label&gt;Domínio (URL)&lt;/label&gt;
             &lt;div className=&quot;input-with-icon input-with-icon-wrapper&quot;&gt;
                &lt;Globe size={18} color=&quot;var(--color-text-secondary)&quot; /&gt;
                &lt;input
                    type=&quot;text&quot;
                    value={newTenantDomain}
                    onChange={(e) =&gt; setNewTenantDomain(e.target.value.toLowerCase())}
                    placeholder=&quot;Ex: empresa.localhost ou empresa.com.br&quot;
                    required
                    className=&quot;input-flex&quot;
                /&gt;
                {newTenantDomain &amp;&amp; !newTenantDomain.match(/^https?:\/\//) &amp;&amp; /^(localhost|[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)+)$/.test(newTenantDomain) &amp;&amp; (
                    &lt;Check size={18} color=&quot;#10B981&quot; /&gt;
                )}
            &lt;/div&gt;
            &lt;small className=&quot;help-text&quot;&gt;
              O domínio que será usado para acessar esta empresa.
            &lt;/small&gt;
          &lt;/div&gt;
          &lt;div className=&quot;form-group&quot;&gt;
            &lt;label&gt;Schema Name (URL/Identificador)&lt;/label&gt;
            &lt;input
              type=&quot;text&quot;
              value={newTenantSchema}
              onChange={(e) =&gt; setNewTenantSchema(e.target.value.toLowerCase())}
              placeholder=&quot;Ex: minha_empresa&quot;
              required
              disabled={!!editingTenant}
            /&gt;
             &lt;small className=&quot;help-text&quot;&gt;
              Apenas letras minúsculas, números e sublinhados (_). Sem espaços.
            &lt;/small&gt;
          &lt;/div&gt;
          &lt;div className=&quot;form-footer&quot;&gt;
            &lt;button
              type=&quot;button&quot;
              className=&quot;btn btn-secondary&quot;
              onClick={() =&gt; setIsModalOpen(false)}
              disabled={isSavingTenant}
            &gt;
              Cancelar
            &lt;/button&gt;
            &lt;button type=&quot;submit&quot; className=&quot;btn btn-primary&quot; disabled={isSavingTenant}&gt;
              {isSavingTenant ? &quot;Salvando...&quot; : &quot;Salvar&quot;}
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/form&gt;
      &lt;/Modal&gt;
      &lt;Modal
        title=&quot;Confirmar Exclusão de Empresa&quot;
        isOpen={isDeleteModalOpen}
        onClose={() =&gt; setIsDeleteModalOpen(false)}
        showFooter={false}
      &gt;
        &lt;div className=&quot;delete-modal-content&quot;&gt;
          &lt;p&gt;Deseja excluir a empresa &lt;strong&gt;{tenantToDelete?.nome}&lt;/strong&gt;?&lt;/p&gt;
          &lt;p className=&quot;warning-text&quot;&gt;
            Atenção: Isso pode remover todos os dados associados a esta empresa.
          &lt;/p&gt;
          &lt;div className=&quot;form-footer&quot;&gt;
            &lt;button className=&quot;btn btn-secondary&quot; onClick={() =&gt; setIsDeleteModalOpen(false)}&gt;
              Cancelar
            &lt;/button&gt;
            &lt;button className=&quot;btn btn-danger&quot; onClick={confirmDeleteTenant}&gt;
              Excluir
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/Modal&gt;
    &lt;/div&gt;
  );
};
export default GerenciarEmpresas;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\pages\Login.tsx <span style="float:right">(152 linhas)</span></div>
                                <pre class="code-block">import React, { useState, FormEvent } from &quot;react&quot;;
import { useNavigate, useLocation } from &quot;react-router-dom&quot;;
import api from &quot;../services/api&quot;;
import &quot;../styles/login.css&quot;;
import logo from &quot;../assets/logo1.png&quot;;
import Modal from &quot;../components/Modal&quot;;
interface TenantOption {
  schema_name: string;
  nome: string;
}
const Login: React.FC = () =&gt; {
  const [username, setUsername] = useState(&quot;&quot;);
  const [password, setPassword] = useState(&quot;&quot;);
  const [error, setError] = useState(&quot;&quot;);
  const [isLoading, setIsLoading] = useState(false);
  const [isTenantModalOpen, setIsTenantModalOpen] = useState(false);
  const [availableTenants, setAvailableTenants] = useState&lt;TenantOption[]&gt;([]);
  const navigate = useNavigate();
  const location = useLocation();
  const finalizeLogin = async (data: any) =&gt; {
    if (data.tenant) {
      localStorage.setItem(&quot;tenant_info&quot;, JSON.stringify(data.tenant));
      document.cookie = &quot;session_active=true; path=/&quot;;
      const from = location.state?.from?.pathname || &quot;/dashboard&quot;;
      navigate(from, { replace: true });
    } else {
        setError(&quot;Erro: Informações da empresa não retornadas pelo servidor.&quot;);
    }
  };
  const handleSubmit = async (e: FormEvent) =&gt; {
    e.preventDefault();
    setError(&quot;&quot;);
    setIsLoading(true);
    try {
      const response = await api.post(&quot;/auth/login/&quot;, {
        username,
        password,
      });
      const data = response.data;
      if (data.action === &quot;select_tenant&quot;) {
        setAvailableTenants(data.tenants);
        setIsTenantModalOpen(true);
      } else if (data.access) {
        finalizeLogin(data);
      }
    } catch (err: any) {
      console.error(err);
      if (err.response?.status === 401) {
        setError(&quot;Usuário ou senha incorretos.&quot;);
      } else {
        setError(
          err.response?.data?.detail || &quot;Erro ao conectar com o servidor.&quot;
        );
      }
    } finally {
      setIsLoading(false);
    }
  };
  const handleTenantSelection = async (schema_name: string) =&gt; {
    setIsLoading(true);
    try {
      const response = await api.post(&quot;/auth/login/&quot;, {
        username,
        password,
        tenant_schema_name: schema_name,
      });
      finalizeLogin(response.data);
      setIsTenantModalOpen(false);
    } catch (err: any) {
      setError(&quot;Não foi possível acessar essa empresa.&quot;);
    } finally {
      setIsLoading(false);
    }
  };
  return (
    &lt;div className=&quot;login-container&quot;&gt;
      {/* Card Principal */}
      &lt;div className=&quot;glass-card&quot;&gt;
        &lt;div className=&quot;form-header&quot;&gt;
          &lt;img src={logo} alt=&quot;Logo&quot; className=&quot;logo-img&quot; /&gt;
          &lt;h2&gt;Bem-vindo&lt;/h2&gt;
          &lt;p&gt;Faça login para continuar&lt;/p&gt;
        &lt;/div&gt;
        &lt;form onSubmit={handleSubmit} className=&quot;modern-form&quot;&gt;
          {error &amp;&amp; &lt;div className=&quot;error-message&quot;&gt;{error}&lt;/div&gt;}
          &lt;div className=&quot;input-group&quot;&gt;
            &lt;input
              id=&quot;username&quot;
              type=&quot;text&quot;
              value={username}
              onChange={(e) =&gt; setUsername(e.target.value)}
              required
              disabled={isLoading}
            /&gt;
            &lt;label htmlFor=&quot;username&quot;&gt;Usuário&lt;/label&gt;
          &lt;/div&gt;
          &lt;div className=&quot;input-group&quot;&gt;
            &lt;input
              id=&quot;password&quot;
              type=&quot;password&quot;
              value={password}
              onChange={(e) =&gt; setPassword(e.target.value)}
              required
              disabled={isLoading}
            /&gt;
            &lt;label htmlFor=&quot;password&quot;&gt;Senha&lt;/label&gt;
          &lt;/div&gt;
          &lt;button type=&quot;submit&quot; className=&quot;btn-modern&quot; disabled={isLoading}&gt;
            {isLoading ? &lt;div className=&quot;spinner&quot;&gt;&lt;/div&gt; : &quot;Entrar&quot;}
          &lt;/button&gt;
        &lt;/form&gt;
        &lt;div className=&quot;login-footer&quot;&gt;
          &amp;copy; {new Date().getFullYear()} Compras &amp; Gestão. Todos os direitos
          reservados.
        &lt;/div&gt;
      &lt;/div&gt;
      {/* Modal de Seleção de Empresa */}
      &lt;Modal
        title={`Olá ${username}, escolha a empresa:`}
        isOpen={isTenantModalOpen}
        onClose={() =&gt; setIsTenantModalOpen(false)}
        showFooter={false}
      &gt;
        &lt;div className=&quot;tenant-list-container&quot;&gt;
          &lt;p className=&quot;tenant-list-info&quot;&gt;
            Seu usuário possui acesso a múltiplas empresas.
          &lt;/p&gt;
          &lt;div className=&quot;tenant-list&quot;&gt;
            {availableTenants.map((tenant) =&gt; (
              &lt;button
                key={tenant.schema_name}
                className=&quot;tenant-option-btn&quot;
                onClick={() =&gt; handleTenantSelection(tenant.schema_name)}
                disabled={isLoading}
              &gt;
                &lt;span className=&quot;tenant-name&quot;&gt;{tenant.nome}&lt;/span&gt;
                &lt;span className=&quot;tenant-arrow&quot;&gt;&amp;rarr;&lt;/span&gt;
              &lt;/button&gt;
            ))}
          &lt;/div&gt;
          &lt;button
            className=&quot;btn-cancel-modal&quot;
            onClick={() =&gt; setIsTenantModalOpen(false)}
          &gt;
            Cancelar
          &lt;/button&gt;
        &lt;/div&gt;
      &lt;/Modal&gt;
    &lt;/div&gt;
  );
};
export default Login;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\pages\ManageCRDII.tsx <span style="float:right">(284 linhas)</span></div>
                                <pre class="code-block">import React, { useState, useEffect, useCallback } from &quot;react&quot;;
import api from &quot;../services/api&quot;;
import toast from &quot;react-hot-toast&quot;;
import { Folder, PlusCircle, Pencil as Edit, Trash2, Search, Filter, X } from &quot;lucide-react&quot;;
import &quot;../styles/userManagement.css&quot;; // Reutilizando estilos existentes
import &quot;../styles/processos.css&quot;; // Reutilizar estilos de filtro
import Modal from &quot;../components/Modal&quot;;
import { useAuth } from &quot;../hooks/useAuth&quot;;
import UserManagementSkeleton from &quot;../components/UserManagementSkeleton&quot;;
interface CRDII {
  id: number;
  nome: string;
}
const ManageCRDII: React.FC = () =&gt; {
  const [crdiis, setCrdiis] = useState&lt;CRDII[]&gt;([]);
  const [loading, setLoading] = useState(true);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingCRDII, setEditingCRDII] = useState&lt;CRDII | null&gt;(null);
  const [crdiiToDelete, setCrdiiToDelete] = useState&lt;CRDII | null&gt;(null);
  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);
  const [searchTerm, setSearchTerm] = useState(&quot;&quot;);
  const [ordering, setOrdering] = useState(&quot;nome&quot;); // &#x27;nome&#x27; or &#x27;-nome&#x27;
  const [showFilters, setShowFilters] = useState(false);
  const [nome, setNome] = useState(&quot;&quot;);
  const [isSaving, setIsSaving] = useState(false);
  const { user } = useAuth();
  const fetchCRDIIs = useCallback(async () =&gt; {
    setLoading(true);
    try {
      const response = await api.get&lt;CRDII[]&gt;(&quot;/crdiis/&quot;);
      setCrdiis(response.data);
    } catch (error) {
      console.error(&quot;Erro ao buscar CRDIIs&quot;, error);
      toast.error(&quot;Não foi possível carregar os CRDIIs.&quot;);
    } finally {
      setLoading(false);
    }
  }, []);
  useEffect(() =&gt; {
    fetchCRDIIs();
  }, [fetchCRDIIs]);
  const handleCreate = () =&gt; {
    setEditingCRDII(null);
    setNome(&quot;&quot;);
    setIsModalOpen(true);
  };
  const handleEdit = (crdii: CRDII) =&gt; {
    setEditingCRDII(crdii);
    setNome(crdii.nome);
    setIsModalOpen(true);
  };
  const openDeleteModal = (crdii: CRDII) =&gt; {
    setCrdiiToDelete(crdii);
    setIsDeleteModalOpen(true);
  };
  const confirmDelete = async () =&gt; {
    if (!crdiiToDelete) return;
    try {
      await api.delete(`/crdiis/${crdiiToDelete.id}/`);
      toast.success(&quot;CRDII excluído com sucesso!&quot;);
      fetchCRDIIs();
    } catch (error: any) {
      const msg =
        error.response?.data?.detail ||
        &quot;Erro ao excluir CRDII. Verifique se existem processos vinculados.&quot;;
      toast.error(msg);
    } finally {
      setCrdiiToDelete(null);
      setIsDeleteModalOpen(false);
    }
  };
  const handleSave = async (e: React.FormEvent) =&gt; {
    e.preventDefault();
    if (!nome.trim()) {
      toast.error(&quot;O nome é obrigatório.&quot;);
      return;
    }
    setIsSaving(true);
    try {
      if (editingCRDII) {
        await api.patch(`/crdiis/${editingCRDII.id}/`, { nome });
        toast.success(&quot;CRDII atualizado com sucesso!&quot;);
      } else {
        await api.post(&quot;/crdiis/&quot;, { nome });
        toast.success(&quot;CRDII criado com sucesso!&quot;);
      }
      setIsModalOpen(false);
      fetchCRDIIs();
    } catch (error: any) {
      const msg =
        error.response?.data?.nome?.[0] ||
        error.response?.data?.detail ||
        &quot;Erro ao salvar CRDII.&quot;;
      toast.error(msg);
    } finally {
      setIsSaving(false);
    }
  };
  const filteredCRDIIs = crdiis
    .filter((c) =&gt;
      c.nome.toLowerCase().includes(searchTerm.toLowerCase())
    )
    .sort((a, b) =&gt; {
      if (ordering === &quot;nome&quot;) {
        return a.nome.localeCompare(b.nome);
      } else {
        return b.nome.localeCompare(a.nome);
      }
    });
  const canManage =
    user?.is_superuser ||
    user?.permissions?.gerenciar?.crdiis ||
    (user?.role &amp;&amp;
      [&quot;administrador&quot;, &quot;gestor&quot;, &quot;diretoria&quot;, &quot;dev&quot;].includes(user.role));
  if (!canManage) {
    return (
      &lt;div className=&quot;user-management-container page-container&quot;&gt;
        &lt;h1&gt;Acesso Negado&lt;/h1&gt;
        &lt;p&gt;Você não tem permissão para acessar esta página.&lt;/p&gt;
      &lt;/div&gt;
    );
  }
  if (loading) return &lt;UserManagementSkeleton /&gt;;
  return (
    &lt;div className=&quot;user-management-container page-container&quot;&gt;
      &lt;header className=&quot;user-management-header&quot;&gt;
        &lt;div className=&quot;header-title&quot;&gt;
          &lt;Folder size={28} /&gt;
          &lt;h1&gt;Gerenciar CRDIIs&lt;/h1&gt;
        &lt;/div&gt;
        &lt;div className=&quot;header-actions&quot;&gt;
          &lt;div className=&quot;search-bar&quot;&gt;
            &lt;Search size={18} /&gt;
            &lt;input
              type=&quot;text&quot;
              placeholder=&quot;Buscar CRDII...&quot;
              value={searchTerm}
              onChange={(e) =&gt; setSearchTerm(e.target.value)}
            /&gt;
          &lt;/div&gt;
          &lt;button
            className=&quot;btn-filter&quot;
            onClick={() =&gt; setShowFilters(!showFilters)}
          &gt;
            &lt;Filter size={18} /&gt;
            &lt;span&gt;Filtros&lt;/span&gt;
          &lt;/button&gt;
          &lt;button className=&quot;btn btn-primary&quot; onClick={handleCreate}&gt;
            &lt;PlusCircle size={20} /&gt;
            Novo CRDII
          &lt;/button&gt;
        &lt;/div&gt;
      &lt;/header&gt;
      {showFilters &amp;&amp; (
        &lt;div className=&quot;filters-panel&quot;&gt;
          &lt;div className=&quot;filter-group&quot;&gt;
            &lt;select
              value={ordering}
              onChange={(e) =&gt; setOrdering(e.target.value)}
              aria-label=&quot;Ordenação&quot;
            &gt;
              &lt;option value=&quot;nome&quot;&gt;Nome (A-Z)&lt;/option&gt;
              &lt;option value=&quot;-nome&quot;&gt;Nome (Z-A)&lt;/option&gt;
            &lt;/select&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      )}
      &lt;div className=&quot;user-list&quot;&gt;
        &lt;table className=&quot;user-table&quot;&gt;
          &lt;thead&gt;
            &lt;tr&gt;
              &lt;th className=&quot;col-id&quot;&gt;ID&lt;/th&gt;
              &lt;th&gt;Nome&lt;/th&gt;
              &lt;th className=&quot;col-actions&quot;&gt;Ações&lt;/th&gt;
            &lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody&gt;
            {filteredCRDIIs.length === 0 ? (
              &lt;tr&gt;
                &lt;td colSpan={3} className=&quot;no-results-cell&quot;&gt;
                  Nenhum CRDII encontrado.
                &lt;/td&gt;
              &lt;/tr&gt;
            ) : (
              filteredCRDIIs.map((crdii) =&gt; (
                &lt;tr key={crdii.id}&gt;
                  &lt;td data-label=&quot;ID&quot;&gt;{crdii.id}&lt;/td&gt;
                  &lt;td data-label=&quot;Nome&quot;&gt;{crdii.nome}&lt;/td&gt;
                  &lt;td data-label=&quot;Ações&quot;&gt;
                    &lt;div className=&quot;user-actions&quot;&gt;
                      &lt;button
                        className=&quot;btn btn-icon btn-secondary&quot;
                        title=&quot;Editar&quot;
                        onClick={() =&gt; handleEdit(crdii)}
                      &gt;
                        &lt;Edit size={16} /&gt;
                      &lt;/button&gt;
                      &lt;button
                        className=&quot;btn btn-icon btn-danger&quot;
                        title=&quot;Excluir&quot;
                        onClick={() =&gt; openDeleteModal(crdii)}
                      &gt;
                        &lt;Trash2 size={16} /&gt;
                      &lt;/button&gt;
                    &lt;/div&gt;
                  &lt;/td&gt;
                &lt;/tr&gt;
              ))
            )}
          &lt;/tbody&gt;
        &lt;/table&gt;
      &lt;/div&gt;
      {/* Modal Criar/Editar */}
      &lt;Modal
        title={editingCRDII ? &quot;Editar CRDII&quot; : &quot;Novo CRDII&quot;}
        isOpen={isModalOpen}
        onClose={() =&gt; setIsModalOpen(false)}
        showFooter={false}
      &gt;
        &lt;form onSubmit={handleSave} className=&quot;tenant-form&quot;&gt;
          &lt;div className=&quot;form-group&quot;&gt;
            &lt;label&gt;Nome do CRDII&lt;/label&gt;
            &lt;input
              type=&quot;text&quot;
              value={nome}
              onChange={(e) =&gt; setNome(e.target.value.toUpperCase())}
              placeholder=&quot;Ex: PROJETOS ESPECIAIS&quot;
              required
              autoFocus
            /&gt;
          &lt;/div&gt;
          &lt;div className=&quot;form-footer&quot;&gt;
            &lt;button
              type=&quot;button&quot;
              className=&quot;btn btn-secondary&quot;
              onClick={() =&gt; setIsModalOpen(false)}
              disabled={isSaving}
            &gt;
              Cancelar
            &lt;/button&gt;
            &lt;button
              type=&quot;submit&quot;
              className=&quot;btn btn-primary&quot;
              disabled={isSaving}
            &gt;
              {isSaving ? &quot;Salvando...&quot; : &quot;Salvar&quot;}
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/form&gt;
      &lt;/Modal&gt;
      {/* Modal Excluir */}
      &lt;Modal
        title=&quot;Confirmar Exclusão&quot;
        isOpen={isDeleteModalOpen}
        onClose={() =&gt; setIsDeleteModalOpen(false)}
        showFooter={false}
      &gt;
        &lt;div className=&quot;delete-modal-content&quot;&gt;
          &lt;p&gt;
            Deseja excluir o CRDII &lt;strong&gt;{crdiiToDelete?.nome}&lt;/strong&gt;?
          &lt;/p&gt;
          &lt;p
            className=&quot;warning-text&quot;
          &gt;
            Atenção: Não será possível excluir se houver processos vinculados a
            este CRDII.
          &lt;/p&gt;
          &lt;div className=&quot;form-footer&quot;&gt;
            &lt;button
              className=&quot;btn btn-secondary&quot;
              onClick={() =&gt; setIsDeleteModalOpen(false)}
            &gt;
              Cancelar
            &lt;/button&gt;
            &lt;button className=&quot;btn btn-danger&quot; onClick={confirmDelete}&gt;
              Excluir
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/Modal&gt;
    &lt;/div&gt;
  );
};
export default ManageCRDII;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\pages\ProcessoCreate.tsx <span style="float:right">(180 linhas)</span></div>
                                <pre class="code-block">import React, { useState, useEffect } from &quot;react&quot;;
import api from &quot;../services/api&quot;;
import { Link, useNavigate } from &quot;react-router-dom&quot;;
import toast from &quot;react-hot-toast&quot;;
import { useAuth } from &quot;../hooks/useAuth&quot;;
import { ArrowLeft, FilePlus, Save, CheckCircle } from &quot;lucide-react&quot;;
import &quot;../styles/processoCreate.css&quot;;
import &quot;../styles/searchableSelect.css&quot;;
import SearchableSelect from &quot;../components/SearchableSelect&quot;;
interface CRDII {
  id: number;
  nome: string;
}
interface User {
  is_staff?: boolean;
  is_superuser?: boolean;
  role?: string;
  permissions?: {
    status_limits?: {
      nao_concluido?: boolean;
      parcial?: boolean;
      concluido?: boolean;
      arquivado?: boolean;
    };
  };
}
const ProcessoCreate: React.FC = () =&gt; {
  const [nome, setNome] = useState(&quot;&quot;);
  const [status, setStatus] = useState(&quot;nao_concluido&quot;);
  const [crdiiId, setCrdiiId] = useState&lt;number | string&gt;(&quot;&quot;);
  const [crdiis, setCrdiis] = useState&lt;CRDII[]&gt;([]);
  const [loading, setLoading] = useState(false);
  const { user }: { user: User | null } = useAuth();
  const navigate = useNavigate();
  useEffect(() =&gt; {
    const fetchCRDIIs = async () =&gt; {
      try {
        const res = await api.get&lt;CRDII[]&gt;(&quot;crdiis/&quot;);
        const sorted = res.data.sort((a, b) =&gt; a.nome.localeCompare(b.nome));
        setCrdiis(sorted);
      } catch (err) {
        toast.error(&quot;Falha ao carregar CRDIIs.&quot;);
        console.error(err);
      }
    };
    fetchCRDIIs();
  }, []);
  const handleSubmit = async (e: React.FormEvent) =&gt; {
    e.preventDefault();
    if (!nome.trim()) {
      toast.error(&quot;O nome do processo é obrigatório.&quot;);
      return;
    }
    if (!crdiiId) {
      toast.error(&quot;Por favor, selecione um CRDII.&quot;);
      return;
    }
    const load = toast.loading(&quot;Criando processo...&quot;);
    setLoading(true);
    try {
      await api.post(&quot;processos/&quot;, {
        nome,
        crdii: crdiiId,
        status,
      });
      toast.dismiss(load);
      navigate(&quot;/processos&quot;);
      toast.success(&quot;Processo criado com sucesso!&quot;, { duration: 2000 });
    } catch (err: any) {
      toast.dismiss(load);
      const apiError =
        err.response?.data?.nome?.[0] ||
        err.response?.data?.detail ||
        &quot;Erro ao criar processo. Verifique os dados.&quot;;
      toast.error(apiError, { duration: 3000 });
      console.error(err);
    } finally {
      setLoading(false);
    }
  };
  const statusOptions = [
    { value: &quot;nao_concluido&quot;, label: &quot;Em Andamento&quot; },
    { value: &quot;parcial&quot;, label: &quot;Parcial&quot; },
    { value: &quot;concluido&quot;, label: &quot;Concluído&quot; },
    { value: &quot;arquivado&quot;, label: &quot;Arquivado&quot; },
  ];
  const allowedStatusOptions = user?.is_superuser
    ? statusOptions
    : statusOptions.filter(
        (option) =&gt;
          user?.permissions?.status_limits?.[
            option.value as keyof typeof user.permissions.status_limits
          ] ?? false
      );
  return (
    &lt;div className=&quot;processo-create-page page-container&quot;&gt;
      &lt;header className=&quot;create-header&quot;&gt;
        &lt;div className=&quot;header-title&quot;&gt;
          &lt;FilePlus size={28} /&gt;
          &lt;h1&gt;Criar Novo Processo&lt;/h1&gt;
        &lt;/div&gt;
        &lt;Link to=&quot;/processos&quot; className=&quot;back-link&quot;&gt;
          &lt;ArrowLeft size={18} /&gt;
          Voltar para a lista
        &lt;/Link&gt;
      &lt;/header&gt;
      &lt;div className=&quot;form-card&quot;&gt;
        &lt;form onSubmit={handleSubmit} className=&quot;processo-form&quot;&gt;
          {/* Seção Principal */}
          &lt;div className=&quot;form-section&quot;&gt;
            &lt;h3&gt;Informações Básicas&lt;/h3&gt;
            &lt;div className=&quot;form-group&quot;&gt;
              &lt;label htmlFor=&quot;nome&quot;&gt;Nome do Processo&lt;/label&gt;
              &lt;input
                id=&quot;nome&quot;
                className=&quot;form-input&quot;
                type=&quot;text&quot;
                value={nome}
                onChange={(e) =&gt; setNome(e.target.value.toUpperCase())}
                placeholder=&quot;Ex: 2024.00123 - Aquisição de Materiais&quot;
                disabled={loading}
                autoFocus
              /&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          {/* Seção Secundária (Grid) */}
          &lt;div className=&quot;form-section&quot;&gt;
            &lt;h3&gt;Classificação&lt;/h3&gt;
            &lt;div className=&quot;form-row&quot;&gt;
              &lt;div className=&quot;form-group&quot;&gt;
                &lt;label htmlFor=&quot;status&quot;&gt;Status Inicial&lt;/label&gt;
                &lt;select
                  id=&quot;status&quot;
                  className=&quot;form-select&quot;
                  value={status}
                  onChange={(e) =&gt; setStatus(e.target.value)}
                  disabled={loading}
                &gt;
                  {allowedStatusOptions.map((option) =&gt; (
                    &lt;option key={option.value} value={option.value}&gt;
                      {option.label}
                    &lt;/option&gt;
                  ))}
                &lt;/select&gt;
              &lt;/div&gt;
              &lt;div className=&quot;form-group&quot;&gt;
                &lt;label htmlFor=&quot;crdii&quot;&gt;Vincular CRDII&lt;/label&gt;
                &lt;div className=&quot;crdii-select-container&quot;&gt;
                  &lt;SearchableSelect
                    options={crdiis}
                    value={String(crdiiId)}
                    onChange={(id) =&gt; setCrdiiId(id)}
                    placeholder=&quot;Busque pelo nome do CRDII...&quot;
                  /&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          {/* Ações */}
          &lt;div className=&quot;form-actions&quot;&gt;
            &lt;button type=&quot;submit&quot; className=&quot;submit-button&quot; disabled={loading}&gt;
              {loading ? (
                &lt;&gt;
                  &lt;div className=&quot;btn-spinner&quot;&gt;&lt;/div&gt;
                  Salvando...
                &lt;/&gt;
              ) : (
                &lt;&gt;
                  &lt;CheckCircle size={20} /&gt;
                  Criar Processo
                &lt;/&gt;
              )}
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};
export default ProcessoCreate;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\pages\ProcessoDetail.tsx <span style="float:right">(546 linhas)</span></div>
                                <pre class="code-block">import React, { useEffect, useState } from &quot;react&quot;;
import api from &quot;../services/api&quot;;
import { Link, useParams, useNavigate } from &quot;react-router-dom&quot;; // &lt;--- Adicionado useNavigate
import toast from &quot;react-hot-toast&quot;;
import {
  ArrowLeft,
  File,
  Upload,
  Trash2,
  Calendar,
  RefreshCw,
  Clock,
  PieChart,
  CheckCircle,
  Archive,
  Folder,
  User,
  XCircle,
  Search,
  FileText,
  BookOpen,
} from &quot;lucide-react&quot;;
import Modal from &quot;../components/Modal&quot;;
import &quot;../styles/ProcessoDetail.css&quot;;
import { useAuth } from &quot;../hooks/useAuth&quot;;
import ProcessoDetailSkeleton from &quot;../components/ProcessoDetailSkeleton&quot;;
import StatusHistoryModal from &quot;../components/StatusHistoryModal&quot;;
interface Arquivo {
  id: number;
  nome_atual: string;
  criado_por: string;
  criado_por_role: string; // Adicionado para checagem de hierarquia
  arquivo_url: string;
  data_upload: string;
}
interface Processo {
  id: number;
  nome: string;
  status: string;
  criado_por: string;
  criado_por_role: string;
  data_criacao: string;
  data_em_andamento: string | null;
  data_parcial: string | null;
  data_concluido: string | null;
  data_arquivado: string | null;
  data_cancelado: string | null;
  data_status: string;
  arquivos: Arquivo[];
  crdii_nome: string;
}
const StatusIcon: React.FC&lt;{ status: string }&gt; = ({ status }) =&gt; {
  const iconProps = { size: 16, className: &quot;status-icon&quot; };
  switch (status) {
    case &quot;nao_concluido&quot;:
      return &lt;Clock {...iconProps} /&gt;;
    case &quot;parcial&quot;:
      return &lt;PieChart {...iconProps} /&gt;;
    case &quot;concluido&quot;:
      return &lt;CheckCircle {...iconProps} /&gt;;
    case &quot;arquivado&quot;:
      return &lt;Archive {...iconProps} /&gt;;
    case &quot;cancelado&quot;:
      return &lt;XCircle {...iconProps} /&gt;;
    default:
      return null;
  }
};
const STATUS_OPTIONS = [
  { value: &quot;nao_concluido&quot;, label: &quot;Em Andamento&quot; },
  { value: &quot;parcial&quot;, label: &quot;Parcial&quot; },
  { value: &quot;concluido&quot;, label: &quot;Concluído&quot; },
  { value: &quot;arquivado&quot;, label: &quot;Arquivado&quot; },
  { value: &quot;cancelado&quot;, label: &quot;Cancelado&quot; },
];
const ROLE_HIERARCHY: Record&lt;string, number&gt; = {
  dev: 6,
  diretoria: 5,
  gestor: 5,
  administrador: 4,
  financeiro: 3,
  compras: 2,
  obra: 1,
};
interface StatusSelectorProps {
  status: string;
  updating: boolean;
  allowedStatuses: typeof STATUS_OPTIONS;
  onChange: (e: React.ChangeEvent&lt;HTMLSelectElement&gt;) =&gt; void;
}
const StatusSelector: React.FC&lt;StatusSelectorProps&gt; = ({
  status,
  updating,
  allowedStatuses,
  onChange,
}) =&gt; (
  &lt;div className={`status-selector status-${status}`}&gt;
    &lt;StatusIcon status={status} /&gt;
    &lt;select
      className=&quot;status-selector__select&quot;
      value={status}
      onChange={onChange}
      disabled={updating}
      title=&quot;status&quot;
    &gt;
      {allowedStatuses.map((option) =&gt; (
        &lt;option key={option.value} value={option.value}&gt;
          {option.label}
        &lt;/option&gt;
      ))}
    &lt;/select&gt;
    {updating &amp;&amp; (
      &lt;RefreshCw size={16} className=&quot;status-selector__loading-icon&quot; /&gt;
    )}
  &lt;/div&gt;
);
const ProcessoDetail: React.FC = () =&gt; {
  const { id } = useParams&lt;{ id: string }&gt;();
  const navigate = useNavigate(); // &lt;--- Hook para redirecionar
  const [processo, setProcesso] = useState&lt;Processo | null&gt;(null);
  const [loading, setLoading] = useState(true);
  const [selectedFile, setSelectedFile] = useState&lt;File | null&gt;(null);
  const [uploading, setUploading] = useState(false);
  const [updatingStatus, setUpdatingStatus] = useState(false);
  const [fileToDelete, setFileToDelete] = useState&lt;Arquivo | null&gt;(null);
  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);
  const [isHistoryModalOpen, setIsHistoryModalOpen] = useState(false);
  const [isDeleteProcessModalOpen, setIsDeleteProcessModalOpen] =
    useState(false);
  const [, setIsDeletingProcess] = useState(false);
  const [fileSearchTerm, setFileSearchTerm] = useState(&quot;&quot;);
  const { user } = useAuth();
  const notifyUpdate = () =&gt; {
    new BroadcastChannel(&quot;processo-update&quot;).postMessage(&quot;update&quot;);
  };
  useEffect(() =&gt; {
    const fetchProcesso = async () =&gt; {
      try {
        const res = await api.get&lt;Processo&gt;(`processos/${id}/`);
        setProcesso(res.data);
      } catch (err) {
        toast.error(
          &quot;Falha ao carregar o processo. Verifique se ele existe e se você tem permissão.&quot;
        );
        console.error(err);
      } finally {
        setLoading(false);
      }
    };
    fetchProcesso();
  }, [id]);
  const handleFileChange = (e: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; {
    if (e.target.files &amp;&amp; e.target.files[0]) {
      const file = e.target.files[0];
      const MAX_FILE_SIZE = 10 * 1024 * 1024;
      if (file.size &gt; MAX_FILE_SIZE) {
        toast.error(
          &quot;O arquivo excede o limite de 10MB e não pode ser enviado.&quot;
        );
        setSelectedFile(null);
        e.target.value = &quot;&quot;;
        return;
      }
      setSelectedFile(file);
    }
  };
  const handleUpload = async (e: React.FormEvent) =&gt; {
    e.preventDefault();
    if (!selectedFile) {
      toast.error(&quot;Por favor, selecione um arquivo.&quot;);
      return;
    }
    setUploading(true);
    const formData = new FormData();
    formData.append(&quot;file&quot;, selectedFile);
    try {
      const res = await api.post&lt;Arquivo&gt;(`/processos/${id}/upload/`, formData);
      setProcesso((prev) =&gt;
        prev ? { ...prev, arquivos: [...prev.arquivos, res.data] } : null
      );
      toast.success(&quot;Arquivo enviado com sucesso!&quot;);
      setSelectedFile(null);
      notifyUpdate();
    } catch (err) {
      toast.error(&quot;Falha no upload. Tente novamente.&quot;);
      console.error(err);
    } finally {
      setUploading(false);
    }
  };
  const handleStatusChange = async (
    e: React.ChangeEvent&lt;HTMLSelectElement&gt;
  ) =&gt; {
    const newStatus = e.target.value;
    if (!processo) return;
    const oldStatus = processo.status;
    setProcesso((prev) =&gt; (prev ? { ...prev, status: newStatus } : null));
    setUpdatingStatus(true);
    try {
      await api.patch(`processos/${id}/`, { status: newStatus });
      setProcesso((prev) =&gt; (prev ? { ...prev, status: newStatus } : null));
      toast.success(&quot;Status atualizado com sucesso!&quot;);
      notifyUpdate();
    } catch (err) {
      toast.error(&quot;Falha ao atualizar o status.&quot;);
      console.error(err);
      setProcesso((prev) =&gt; (prev ? { ...prev, status: oldStatus } : null));
    } finally {
      setUpdatingStatus(false);
    }
  };
  const openDeleteModal = (arquivo: Arquivo) =&gt; {
    setFileToDelete(arquivo);
    setIsDeleteModalOpen(true);
  };
  const closeDeleteModal = () =&gt; {
    setFileToDelete(null);
    setIsDeleteModalOpen(false);
  };
  const handleDeleteFile = async () =&gt; {
    if (!fileToDelete) return;
    try {
      await api.delete(`arquivos/${fileToDelete.id}/`);
      setProcesso((prev) =&gt;
        prev
          ? {
              ...prev,
              arquivos: prev.arquivos.filter((a) =&gt; a.id !== fileToDelete.id),
            }
          : null
      );
      toast.success(&quot;Arquivo excluído com sucesso!&quot;);
      notifyUpdate();
    } catch (err) {
      toast.error(&quot;Falha ao excluir o arquivo. Tente novamente.&quot;);
      console.error(err);
    } finally {
      closeDeleteModal();
    }
  };
  const handleDeleteProcess = async () =&gt; {
    if (!processo) return;
    setIsDeletingProcess(true);
    try {
      await api.delete(`/processos/${processo.id}/`);
      toast.success(&quot;Processo excluído com sucesso!&quot;);
      navigate(&quot;/processos&quot;); // Redireciona para a listagem
    } catch (err: any) {
      toast.error(err.response?.data?.detail || &quot;Erro ao excluir processo.&quot;);
      setIsDeletingProcess(false);
      setIsDeleteProcessModalOpen(false);
    }
  };
  if (loading) return &lt;ProcessoDetailSkeleton /&gt;;
  if (!processo)
    return &lt;p className=&quot;not-found-message&quot;&gt;Processo não encontrado.&lt;/p&gt;;
  const currentUserLevel = ROLE_HIERARCHY[user?.role || &quot;&quot;] || 0;
  const processoCreatorLevel = ROLE_HIERARCHY[processo.criado_por_role] || 0;
  const canUpload =
    user?.is_superuser || (user?.permissions?.can_upload_file ?? false);
  const canDeleteFile = (file: Arquivo): boolean =&gt; {
    if (!user) return false;
    if (user.role === &quot;dev&quot;) return true; // Dev pode tudo
    if (!user.permissions?.can_delete_file) return false; // Precisa da permissão base
    const fileCreatorLevel = ROLE_HIERARCHY[file.criado_por_role] || 0;
    return currentUserLevel &gt;= fileCreatorLevel; // Só pode deletar se o nível for igual ou superior
  };
  const canDeleteProcess = (() =&gt; {
    if (!user) return false;
    if (user.role === &quot;dev&quot;) return true;
    if (!user.permissions?.can_delete_processo) return false;
    return currentUserLevel &gt;= processoCreatorLevel;
  })();
  const canChangeStatus = (() =&gt; {
    if (!user) return false;
    if (user.role === &quot;dev&quot;) return true;
    if (!user.permissions?.can_change_status) return false;
    return currentUserLevel &gt;= processoCreatorLevel;
  })();
  const canViewHistory =
    user?.is_superuser ||
    user?.role === &quot;dev&quot; ||
    (user?.permissions?.view_status_history ?? false);
  const allowedStatuses = (() =&gt; {
    if (!user || !processo) return [];
    let statuses = user.is_superuser
      ? STATUS_OPTIONS
      : STATUS_OPTIONS.filter(
          (option) =&gt;
            user.permissions?.status_limits?.[
              option.value as keyof typeof user.permissions.status_limits
            ] ?? false
        );
    const currentStatusInList = statuses.some(
      (s) =&gt; s.value === processo.status
    );
    if (!currentStatusInList) {
      const currentStatusOption = STATUS_OPTIONS.find(
        (s) =&gt; s.value === processo.status
      );
      if (currentStatusOption) {
        statuses = [...statuses, currentStatusOption];
      }
    }
    return statuses;
  })();
  const filteredArquivos = processo
    ? processo.arquivos.filter((arquivo) =&gt; {
        const lowerCaseSearchTerm = fileSearchTerm.toLowerCase();
        const formattedDate = new Date(arquivo.data_upload).toLocaleString(
          &quot;pt-BR&quot;,
          {
            day: &quot;2-digit&quot;,
            month: &quot;2-digit&quot;,
            year: &quot;numeric&quot;,
            hour: &quot;2-digit&quot;,
            minute: &quot;2-digit&quot;,
          }
        );
        return (
          arquivo.nome_atual.toLowerCase().includes(lowerCaseSearchTerm) ||
          arquivo.criado_por.toLowerCase().includes(lowerCaseSearchTerm) ||
          formattedDate.includes(lowerCaseSearchTerm)
        );
      })
    : [];
  return (
    &lt;div className=&quot;processo-detail-page page-container&quot;&gt;
      &lt;header className=&quot;processo-detail-header&quot;&gt;
        &lt;div className=&quot;header-title&quot;&gt;
          &lt;FileText size={28} /&gt;
          &lt;h1&gt;{processo.nome}&lt;/h1&gt;
        &lt;/div&gt;
        &lt;div className=&quot;header-actions&quot;&gt;
          &lt;Link to=&quot;/processos&quot; className=&quot;back-link&quot;&gt;
            &lt;ArrowLeft size={18} /&gt;
            Voltar para a lista
          &lt;/Link&gt;
        &lt;/div&gt;
      &lt;/header&gt;
      &lt;div className=&quot;processo-detail-grid&quot;&gt;
        &lt;div className=&quot;processo-detail-col-left&quot;&gt;
          &lt;div className=&quot;detail-card&quot;&gt;
            &lt;div className=&quot;detail-card__grid&quot;&gt;
              &lt;div className=&quot;detail-card__item&quot;&gt;
                &lt;span className=&quot;detail-card__label&quot;&gt;CRDII&lt;/span&gt;
                &lt;span className=&quot;detail-card__value&quot;&gt;
                  &lt;Folder size={16} /&gt;
                  {processo.crdii_nome || &quot;N/A&quot;}
                &lt;/span&gt;
              &lt;/div&gt;
              &lt;div className=&quot;detail-card__item&quot;&gt;
                &lt;span className=&quot;detail-card__label&quot;&gt;Status&lt;/span&gt;
                &lt;StatusSelector
                  status={processo.status}
                  updating={updatingStatus}
                  allowedStatuses={allowedStatuses}
                  onChange={
                    canChangeStatus
                      ? handleStatusChange
                      : () =&gt;
                          toast.error(
                            &quot;Você não tem permissão para alterar o status.&quot;
                          )
                  }
                /&gt;
              &lt;/div&gt;
              &lt;div className=&quot;detail-card__item&quot;&gt;
                &lt;span className=&quot;detail-card__label&quot;&gt;Criado por&lt;/span&gt;
                &lt;span className=&quot;detail-card__value&quot;&gt;
                  {processo.criado_por}
                &lt;/span&gt;
              &lt;/div&gt;
              &lt;div className=&quot;detail-card__item&quot;&gt;
                &lt;span className=&quot;detail-card__label&quot;&gt;Data criação&lt;/span&gt;
                &lt;span className=&quot;detail-card__value&quot;&gt;
                  {new Date(processo.data_criacao).toLocaleString(&quot;pt-BR&quot;, {
                    day: &quot;2-digit&quot;,
                    month: &quot;2-digit&quot;,
                    year: &quot;numeric&quot;,
                    hour: &quot;2-digit&quot;,
                    minute: &quot;2-digit&quot;,
                  })}
                &lt;/span&gt;
              &lt;/div&gt;
              &lt;div className=&quot;detail-card__item detail-card__item--full-width&quot;&gt;
                {canViewHistory &amp;&amp; (
                  &lt;button
                    className=&quot;btn-history&quot;
                    onClick={() =&gt; setIsHistoryModalOpen(true)}
                  &gt;
                    &lt;BookOpen size={16} /&gt;
                    Ver Histórico de Status
                  &lt;/button&gt;
                )}
              &lt;/div&gt;
              {canDeleteProcess &amp;&amp; (
                &lt;div className=&quot;btn_excluirprocesso&quot;&gt;
                  &lt;button
                    className=&quot;btn btn-danger &quot;
                    onClick={() =&gt; setIsDeleteProcessModalOpen(true)}
                    title=&quot;Excluir Processo Inteiro&quot;
                  &gt;
                    &lt;Trash2 size={18} /&gt;
                    Excluir Processo
                  &lt;/button&gt;
                &lt;/div&gt;
              )}
            &lt;/div&gt;
          &lt;/div&gt;
          {canUpload &amp;&amp; (
            &lt;div className=&quot;upload-section&quot;&gt;
              &lt;div className=&quot;upload-section-content&quot;&gt;
                &lt;h4 className=&quot;upload-section__title&quot;&gt;
                  Fazer Upload de Novo Arquivo
                &lt;/h4&gt;
                &lt;form onSubmit={handleUpload} className=&quot;upload-form&quot;&gt;
                  &lt;label htmlFor=&quot;file-upload&quot; className=&quot;upload-form__label&quot;&gt;
                    &lt;Upload size={18} /&gt;
                    &lt;span&gt;
                      {selectedFile ? selectedFile.name : &quot;Escolher arquivo&quot;}
                    &lt;/span&gt;
                  &lt;/label&gt;
                  &lt;input
                    id=&quot;file-upload&quot;
                    type=&quot;file&quot;
                    onChange={handleFileChange}
                    disabled={uploading}
                  /&gt;
                  &lt;button
                    type=&quot;submit&quot;
                    className=&quot;upload-form__submit&quot;
                    disabled={!selectedFile || uploading}
                  &gt;
                    {uploading ? &quot;Enviando...&quot; : &quot;Enviar&quot;}
                  &lt;/button&gt;
                &lt;/form&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          )}
        &lt;/div&gt;
        &lt;div className=&quot;processo-detail-col-right&quot;&gt;
          &lt;div className=&quot;files__header&quot;&gt;
            &lt;h4 className=&quot;files__title&quot;&gt;Arquivos do Processo&lt;/h4&gt;
            &lt;div className=&quot;files__search-bar&quot;&gt;
              &lt;Search size={16} /&gt;
              &lt;input
                type=&quot;text&quot;
                placeholder=&quot;Buscar por nome do arquivo, usuário ou data...&quot;
                value={fileSearchTerm}
                onChange={(e) =&gt; setFileSearchTerm(e.target.value)}
              /&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          {filteredArquivos.length &gt; 0 ? (
            &lt;ul className=&quot;files__list&quot;&gt;
              {filteredArquivos.map((arquivo) =&gt; (
                &lt;li key={arquivo.id} className=&quot;files__item&quot;&gt;
                  &lt;File size={20} className=&quot;files__icon&quot; /&gt;
                  &lt;div className=&quot;files__info&quot;&gt;
                    &lt;a
                      href={arquivo.arquivo_url}
                      target=&quot;_blank&quot;
                      rel=&quot;noopener noreferrer&quot;
                      className=&quot;files__link&quot;
                    &gt;
                      {arquivo.nome_atual}
                    &lt;/a&gt;
                    &lt;div className=&quot;files__metadata&quot;&gt;
                      &lt;span className=&quot;files__meta-item&quot;&gt;
                        &lt;User size={12} /&gt;
                        {arquivo.criado_por}
                      &lt;/span&gt;
                      &lt;span className=&quot;files__meta-item&quot;&gt;
                        &lt;Calendar size={12} /&gt;
                        {new Date(arquivo.data_upload).toLocaleString(&quot;pt-BR&quot;, {
                          day: &quot;2-digit&quot;,
                          month: &quot;2-digit&quot;,
                          year: &quot;numeric&quot;,
                          hour: &quot;2-digit&quot;,
                          minute: &quot;2-digit&quot;,
                        })}
                      &lt;/span&gt;
                    &lt;/div&gt;
                  &lt;/div&gt;
                  {canDeleteFile(arquivo) &amp;&amp; (
                    &lt;button
                      onClick={() =&gt; openDeleteModal(arquivo)}
                      className=&quot;files__delete-btn&quot;
                      title=&quot;Excluir arquivo&quot;
                    &gt;
                      &lt;Trash2 size={16} /&gt;
                    &lt;/button&gt;
                  )}
                &lt;/li&gt;
              ))}
            &lt;/ul&gt;
          ) : (
            &lt;p className=&quot;files__empty-message&quot;&gt;
              {processo.arquivos.length &gt; 0
                ? &quot;Nenhum arquivo encontrado com este nome.&quot;
                : &quot;Nenhum arquivo neste processo.&quot;}
            &lt;/p&gt;
          )}
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;Modal
        isOpen={isDeleteModalOpen}
        onClose={closeDeleteModal}
        onConfirm={handleDeleteFile}
        title=&quot;Confirmar Exclusão&quot;
      &gt;
        &lt;p&gt;Você tem certeza que deseja excluir o arquivo&lt;/p&gt;
        &lt;strong&gt;{fileToDelete?.nome_atual}&lt;/strong&gt;?
        &lt;p&gt;Esta ação não pode ser desfeita.&lt;/p&gt;
      &lt;/Modal&gt;
      &lt;Modal
        isOpen={isDeleteProcessModalOpen}
        onClose={() =&gt; setIsDeleteProcessModalOpen(false)}
        onConfirm={handleDeleteProcess}
        title=&quot;Excluir Processo&quot;
      &gt;
        &lt;div className=&quot;delete-process-modal__header&quot;&gt;
          &lt;Trash2 size={48} className=&quot;delete-process-modal__icon&quot; /&gt;
          &lt;h3&gt;Tem certeza absoluta?&lt;/h3&gt;
        &lt;/div&gt;
        &lt;p className=&quot;delete-process-modal__text&quot;&gt;
          Você está prestes a excluir o processo{&quot; &quot;}
          &lt;strong&gt;{processo.nome}&lt;/strong&gt;.
        &lt;/p&gt;
        &lt;p className=&quot;delete-process-modal__warning&quot;&gt;
          Isso apagará todos os {processo.arquivos.length} arquivos vinculados
          do sistema e do disco.
        &lt;/p&gt;
      &lt;/Modal&gt;
      {processo &amp;&amp; (
        &lt;StatusHistoryModal
          isOpen={isHistoryModalOpen}
          onClose={() =&gt; setIsHistoryModalOpen(false)}
          processoId={processo.id}
        /&gt;
      )}
    &lt;/div&gt;
  );
};
export default ProcessoDetail;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\pages\Processos.tsx <span style="float:right">(371 linhas)</span></div>
                                <pre class="code-block">import React, { useState, useEffect } from &quot;react&quot;;
import { Link, useNavigate } from &quot;react-router-dom&quot;;
import {
  FileText,
  Search,
  Calendar,
  User,
  Inbox,
  File,
  Clock,
  PieChart,
  CheckCircle,
  Archive,
  Layers,
  Filter,
  X,
  Download,
  Eye,
  FolderOpen
} from &quot;lucide-react&quot;;
import api from &quot;../services/api&quot;;
import toast from &quot;react-hot-toast&quot;;
import &quot;../styles/processos.css&quot;;
import &quot;../styles/userManagement.css&quot;; // Importando estilo padrão das tabelas
import &quot;../styles/searchableSelect.css&quot;;
import { useAuth } from &quot;../hooks/useAuth&quot;;
import ProcessoSkeletonCard from &quot;../components/ProcessoSkeletonCard&quot;; // Pode manter ou criar um Skeleton de Tabela
import SearchableSelect from &quot;../components/SearchableSelect&quot;;
import Pagination from &quot;../components/Pagination&quot;;
import {
  generateProcessosPDF,
  generateProcessosExcel,
} from &quot;../hooks/reportGenerator&quot;;
import logoEmpresa from &quot;../assets/logo1.png&quot;;
import { useQuery, keepPreviousData } from &quot;@tanstack/react-query&quot;;
export interface Processo {
  id: number;
  nome: string;
  status: string;
  data_criacao: string;
  criado_por: string;
  crdii_nome: string;
  arquivos_count: number;
  data_em_andamento: string | null;
  data_parcial: string | null;
  data_concluido: string | null;
  data_arquivado: string | null;
  data_cancelado: string | null;
  data_status: string;
}
interface PaginatedResponse&lt;T&gt; {
  count: number;
  next: string | null;
  previous: string | null;
  results: T[];
}
interface CRDII {
  id: number;
  nome: string;
}
interface UserOption {
  id: number;
  username: string;
}
const ProcessoStatusIcon: React.FC&lt;{ status: string }&gt; = ({ status }) =&gt; {
  const iconProps = { size: 20, className: `status-icon-${status}` };
  switch (status) {
    case &quot;nao_concluido&quot;:
      return &lt;Clock {...iconProps} /&gt;;
    case &quot;parcial&quot;:
      return &lt;PieChart {...iconProps} /&gt;;
    case &quot;concluido&quot;:
      return &lt;CheckCircle {...iconProps} /&gt;;
    case &quot;arquivado&quot;:
      return &lt;Archive {...iconProps} /&gt;;
    default:
      return &lt;FileText {...iconProps} /&gt;;
  }
};
export const formatStatus = (status: string): string =&gt; {
  const statusMap: { [key: string]: string } = {
    nao_concluido: &quot;Em Andamento&quot;,
    parcial: &quot;Parcial&quot;,
    concluido: &quot;Concluído&quot;,
    arquivado: &quot;Arquivado&quot;,
    cancelado: &quot;Cancelado&quot;,
  };
  return statusMap[status] || status;
};
function useDebounce&lt;T&gt;(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState(value);
  useEffect(() =&gt; {
    const handler = setTimeout(() =&gt; {
      setDebouncedValue(value);
    }, delay);
    return () =&gt; clearTimeout(handler);
  }, [value, delay]);
  return debouncedValue;
}
const Processos: React.FC = () =&gt; {
  const { user } = useAuth();
  const navigate = useNavigate();
  const [searchTerm, setSearchTerm] = useState(&quot;&quot;);
  const [statusFilter, setStatusFilter] = useState(&quot;&quot;);
  const [crdiiFilter, setCrdiiFilter] = useState(&quot;&quot;);
  const [userFilter, setUserFilter] = useState(&quot;&quot;);
  const [ordering, setOrdering] = useState(&quot;-data_criacao&quot;);
  const [page, setPage] = useState(1);
  const [showFilters, setShowFilters] = useState(false);
  const [showReportOptions, setShowReportOptions] = useState(false);
  const debouncedSearchTerm = useDebounce(searchTerm, 500);
  const { data, isLoading, isError, error } = useQuery({
    queryKey: [&#x27;processos&#x27;, page, debouncedSearchTerm, statusFilter, crdiiFilter, userFilter, ordering],
    queryFn: async () =&gt; {
      const params = new URLSearchParams();
      params.append(&#x27;page&#x27;, String(page));
      if (debouncedSearchTerm) params.append(&#x27;search&#x27;, debouncedSearchTerm);
      if (statusFilter) params.append(&#x27;status&#x27;, statusFilter);
      if (crdiiFilter) params.append(&#x27;crdii&#x27;, crdiiFilter);
      if (userFilter) {
          params.append(&#x27;criado_por&#x27;, userFilter); 
      }
      if (ordering) params.append(&#x27;ordering&#x27;, ordering);
      const response = await api.get&lt;PaginatedResponse&lt;Processo&gt;&gt;(`processos/?${params.toString()}`);
      return response.data;
    },
    placeholderData: keepPreviousData,
  });
  const processos = data?.results || [];
  const totalCount = data?.count || 0;
  const totalPages = Math.ceil(totalCount / 20);
  const { data: crdiiOptions = [] } = useQuery({
    queryKey: [&#x27;crdiis&#x27;],
    queryFn: async () =&gt; {
      const res = await api.get&lt;CRDII[]&gt;(&quot;crdiis/&quot;);
      return res.data;
    },
    staleTime: 1000 * 60 * 5,
  });
  const { data: userOptions = [] } = useQuery({
    queryKey: [&#x27;users_options&#x27;],
    queryFn: async () =&gt; {
       if (!user?.is_superuser) return [];
       const res = await api.get&lt;UserOption[]&gt;(&quot;/auth/users/&quot;);
       return res.data;
    },
    enabled: !!user?.is_superuser,
    staleTime: 1000 * 60 * 10,
  });
  const clearFilters = () =&gt; {
    setSearchTerm(&quot;&quot;);
    setStatusFilter(&quot;&quot;);
    setCrdiiFilter(&quot;&quot;);
    setUserFilter(&quot;&quot;);
    setPage(1);
  };
  useEffect(() =&gt; {
    setPage(1);
  }, [debouncedSearchTerm, statusFilter, crdiiFilter, userFilter]);
  const handleGenerateReport = (format: &quot;pdf&quot; | &quot;excel&quot;) =&gt; {
    const reportTitle = &quot;Relatório de Processos (Página Atual)&quot;;
    if (format === &quot;pdf&quot;) {
      generateProcessosPDF(processos, reportTitle, logoEmpresa);
    } else {
      generateProcessosExcel(processos, reportTitle);
    }
    setShowReportOptions(false);
  };
  if (isError) {
      console.error(error);
      toast.error(&quot;Erro ao carregar processos.&quot;);
  }
  const getSortIcon = (field: string) =&gt; {
    if (ordering === field) return &#x27; ↑&#x27;;
    if (ordering === `-${field}`) return &#x27; ↓&#x27;;
    return &#x27;&#x27;;
  };
  const handleSort = (field: string) =&gt; {
    setOrdering(prev =&gt; prev === field ? `-${field}` : field);
  };
  return (
    &lt;div className=&quot;user-management-container page-container&quot;&gt;
      &lt;header className=&quot;user-management-header&quot;&gt;
        &lt;div className=&quot;header-title&quot;&gt;
          &lt;Layers size={28} /&gt;
          &lt;h1&gt;Meus Processos&lt;/h1&gt;
        &lt;/div&gt;
        &lt;div className=&quot;header-actions&quot;&gt;
          &lt;div className=&quot;search-bar&quot;&gt;
            &lt;Search size={18} /&gt;
            &lt;input
              type=&quot;text&quot;
              placeholder=&quot;Buscar processos...&quot;
              value={searchTerm}
              onChange={(e) =&gt; setSearchTerm(e.target.value)}
              aria-label=&quot;Buscar processos&quot;
            /&gt;
          &lt;/div&gt;
          &lt;button
            className=&quot;btn-filter&quot;
            onClick={() =&gt; setShowFilters(!showFilters)}
          &gt;
            &lt;Filter size={18} /&gt;
            &lt;span&gt;Filtros&lt;/span&gt;
          &lt;/button&gt;
          &lt;div className=&quot;report-dropdown&quot;&gt;
            &lt;button
              className=&quot;btn-relatorio&quot;
              onClick={() =&gt; setShowReportOptions(!showReportOptions)}
            &gt;
              &lt;Download size={16} /&gt;
              Relatório
            &lt;/button&gt;
            {showReportOptions &amp;&amp; (
              &lt;div className=&quot;report-options&quot;&gt;
                &lt;button onClick={() =&gt; handleGenerateReport(&quot;pdf&quot;)}&gt;
                  Gerar PDF
                &lt;/button&gt;
                &lt;button onClick={() =&gt; handleGenerateReport(&quot;excel&quot;)}&gt;
                  Gerar Excel
                &lt;/button&gt;
              &lt;/div&gt;
            )}
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/header&gt;
      {showFilters &amp;&amp; (
        &lt;div className=&quot;filters-panel&quot;&gt;
          &lt;div className=&quot;filter-group&quot;&gt;
            &lt;select
              value={statusFilter}
              onChange={(e) =&gt; setStatusFilter(e.target.value)}
              aria-label=&quot;Filtrar por Status&quot;
            &gt;
              &lt;option value=&quot;&quot;&gt;Todos os Status&lt;/option&gt;
              &lt;option value=&quot;nao_concluido&quot;&gt;Em Andamento&lt;/option&gt;
              &lt;option value=&quot;parcial&quot;&gt;Parcial&lt;/option&gt;
              &lt;option value=&quot;concluido&quot;&gt;Concluído&lt;/option&gt;
              &lt;option value=&quot;arquivado&quot;&gt;Arquivado&lt;/option&gt;
              &lt;option value=&quot;cancelado&quot;&gt;Cancelado&lt;/option&gt;
            &lt;/select&gt;
            &lt;SearchableSelect
              options={crdiiOptions}
              value={crdiiFilter}
              onChange={setCrdiiFilter}
              placeholder=&quot;Filtrar por CRDII&quot;
            /&gt;
            {userOptions.length &gt; 0 &amp;&amp; (
              &lt;SearchableSelect
                options={userOptions}
                value={userFilter}
                onChange={setUserFilter}
                placeholder=&quot;Filtrar por Usuário&quot;
              /&gt;
            )}
          &lt;/div&gt;
          &lt;button className=&quot;btn-clear-filters&quot; onClick={clearFilters}&gt;
            &lt;X size={16} /&gt; Limpar Filtros
          &lt;/button&gt;
        &lt;/div&gt;
      )}
      {(statusFilter || crdiiFilter || userFilter) &amp;&amp; (
        &lt;div className=&quot;active-filters-badges&quot; style={{ display: &#x27;flex&#x27;, gap: &#x27;8px&#x27;, marginBottom: &#x27;16px&#x27;, flexWrap: &#x27;wrap&#x27; }}&gt;
            {statusFilter &amp;&amp; &lt;span className=&quot;badge&quot;&gt;Status: {formatStatus(statusFilter)}&lt;/span&gt;}
            {crdiiFilter &amp;&amp; &lt;span className=&quot;badge&quot;&gt;CRDII: {crdiiOptions.find(c =&gt; String(c.id) === crdiiFilter)?.nome || crdiiFilter}&lt;/span&gt;}
            {userFilter &amp;&amp; &lt;span className=&quot;badge&quot;&gt;User: {userOptions.find(u =&gt; String(u.id) === userFilter)?.username || userFilter}&lt;/span&gt;}
        &lt;/div&gt;
      )}
      &lt;div className=&quot;user-list&quot;&gt;
        {isLoading ? (
             &lt;div style={{padding: &#x27;2rem&#x27;}}&gt;
                &lt;ProcessoSkeletonCard /&gt;
                &lt;ProcessoSkeletonCard /&gt;
                &lt;ProcessoSkeletonCard /&gt;
             &lt;/div&gt;
        ) : (
            &lt;table className=&quot;user-table&quot;&gt;
            &lt;thead&gt;
                &lt;tr&gt;
                &lt;th onClick={() =&gt; handleSort(&#x27;nome&#x27;)} style={{cursor: &#x27;pointer&#x27;}}&gt;
                    Processo {getSortIcon(&#x27;nome&#x27;)}
                &lt;/th&gt;
                &lt;th onClick={() =&gt; handleSort(&#x27;crdii__nome&#x27;)} style={{cursor: &#x27;pointer&#x27;}}&gt;
                    CRDII {getSortIcon(&#x27;crdii__nome&#x27;)}
                &lt;/th&gt;
                &lt;th&gt;Solicitante&lt;/th&gt;
                &lt;th onClick={() =&gt; handleSort(&#x27;data_criacao&#x27;)} style={{cursor: &#x27;pointer&#x27;}}&gt;
                    Data Criação {getSortIcon(&#x27;data_criacao&#x27;)}
                &lt;/th&gt;
                &lt;th&gt;Data Status&lt;/th&gt;
                &lt;th&gt;Arquivos&lt;/th&gt;
                &lt;th&gt;Status&lt;/th&gt;
                &lt;th&gt;Ações&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                {processos.length === 0 ? (
                &lt;tr&gt;
                    &lt;td colSpan={8} className=&quot;no-results-cell&quot;&gt;
                        &lt;div className=&quot;no-results-container&quot; style={{border: &#x27;none&#x27;, padding: &#x27;2rem&#x27;}}&gt;
                            &lt;Inbox size={32} className=&quot;no-results-icon&quot; /&gt;
                            &lt;p&gt;{searchTerm || statusFilter ? &quot;Nenhum processo encontrado.&quot; : &quot;Nenhum processo criado.&quot;}&lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                ) : (
                processos.map((processo) =&gt; (
                    &lt;tr key={processo.id} className={`row-status-${processo.status}`}&gt;
                    &lt;td data-label=&quot;Processo&quot; style={{fontWeight: 600}}&gt;
                        {processo.nome}
                    &lt;/td&gt;
                    &lt;td data-label=&quot;CRDII&quot;&gt;
                        {processo.crdii_nome || &quot;-&quot;}
                    &lt;/td&gt;
                    &lt;td data-label=&quot;Solicitante&quot;&gt;
                        &lt;div style={{display: &#x27;flex&#x27;, alignItems: &#x27;center&#x27;, gap: &#x27;6px&#x27;}}&gt;
                            &lt;User size={14} /&gt; {processo.criado_por}
                        &lt;/div&gt;
                    &lt;/td&gt;
                    &lt;td data-label=&quot;Data Criação&quot;&gt;
                        {new Date(processo.data_criacao).toLocaleString(&quot;pt-BR&quot;, {
                            day: &quot;2-digit&quot;, month: &quot;2-digit&quot;, year: &quot;numeric&quot;, hour: &#x27;2-digit&#x27;, minute: &#x27;2-digit&#x27;
                        })}
                    &lt;/td&gt;
                    &lt;td data-label=&quot;Data Status&quot;&gt;
                        {new Date(processo.data_status).toLocaleString(&quot;pt-BR&quot;, {
                            day: &quot;2-digit&quot;, month: &quot;2-digit&quot;, year: &quot;numeric&quot;, hour: &#x27;2-digit&#x27;, minute: &#x27;2-digit&#x27;
                        })}
                    &lt;/td&gt;
                    &lt;td data-label=&quot;Arquivos&quot;&gt;
                         &lt;div style={{display: &#x27;flex&#x27;, alignItems: &#x27;center&#x27;, gap: &#x27;6px&#x27;}}&gt;
                            &lt;File size={14} /&gt; {processo.arquivos_count}
                        &lt;/div&gt;
                    &lt;/td&gt;
                    &lt;td data-label=&quot;Status&quot;&gt;
                         &lt;div style={{display: &#x27;flex&#x27;, alignItems: &#x27;center&#x27;, gap: &#x27;6px&#x27;}}&gt;
                             &lt;ProcessoStatusIcon status={processo.status} /&gt;
                             &lt;span className={`status-text status-${processo.status === &#x27;nao_concluido&#x27; ? &#x27;pending&#x27; : processo.status}`}&gt;
                                {formatStatus(processo.status)}
                             &lt;/span&gt;
                         &lt;/div&gt;
                    &lt;/td&gt;
                    &lt;td data-label=&quot;Ações&quot;&gt;
                        &lt;div className=&quot;user-actions&quot;&gt;
                            &lt;button 
                                className=&quot;btn btn-icon btn-view&quot; 
                                title=&quot;Abrir Processo&quot;
                                onClick={() =&gt; navigate(`/processos/${processo.id}`)}
                            &gt;
                                &lt;FolderOpen size={18} /&gt;
                            &lt;/button&gt;
                        &lt;/div&gt;
                    &lt;/td&gt;
                    &lt;/tr&gt;
                ))
                )}
            &lt;/tbody&gt;
            &lt;/table&gt;
        )}
      &lt;/div&gt;
      {!isLoading &amp;&amp; processos.length &gt; 0 &amp;&amp; (
          &lt;Pagination 
            currentPage={page} 
            totalPages={totalPages} 
            onPageChange={setPage} 
          /&gt;
      )}
    &lt;/div&gt;
  );
};
export default Processos;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\pages\UserManagement.tsx <span style="float:right">(1045 linhas)</span></div>
                                <pre class="code-block">import React, { useState, useEffect, useCallback, useMemo } from &quot;react&quot;;
import api from &quot;../services/api&quot;;
import toast from &quot;react-hot-toast&quot;;
import { Users, PlusCircle, Pencil as Edit, Trash2, Search, Lock, Filter, X } from &quot;lucide-react&quot;;
import &quot;../styles/userManagement.css&quot;;
import &quot;../styles/userForm.css&quot;;
import &quot;../styles/processos.css&quot;; // Reutilizar estilos de filtro
import UserForm from &quot;../components/UserForm&quot;;
import { useAuth } from &quot;../hooks/useAuth&quot;;
import Modal from &quot;../components/Modal&quot;;
import UserManagementSkeleton from &quot;../components/UserManagementSkeleton&quot;;
interface CRDII {
  id: number;
  nome: string;
}
interface Tenant {
  id: number;
  nome: string;
  domain?: string;
}
export interface ManagedUser {
  id: number;
  username: string;
  email: string;
  first_name?: string;
  last_name?: string;
  role:
    | &quot;administrador&quot;
    | &quot;compras&quot;
    | &quot;obra&quot;
    | &quot;financeiro&quot;
    | &quot;dev&quot;
    | &quot;gestor&quot;
    | &quot;diretoria&quot;;
  is_active: boolean;
}
export interface StatusLimits {
  nao_concluido: boolean;
  parcial: boolean;
  concluido: boolean;
  arquivado: boolean;
  cancelado: boolean;
}
export interface RelatoriosPermissions {
  geral: boolean;
  financeiro: boolean;
}
export interface GerenciarPermissions {
  usuarios: boolean;
  empresas: boolean;
  crdiis: boolean;
}
export type PermissionSet = {
  page_dashboard: boolean;
  page_compras: boolean;
  gerenciar: GerenciarPermissions;
  relatorios: RelatoriosPermissions;
  can_create_processo: boolean;
  can_edit_processo: boolean;
  can_delete_processo: boolean;
  can_change_status: boolean;
  can_upload_file: boolean;
  can_delete_file: boolean;
  can_edit_user: boolean;
  can_delete_user: boolean;
  can_create_tenant: boolean;
  status_limits: StatusLimits;
  allowed_crdii: number[];
  allowed_tenants: number[];
  view_status_history: boolean;
};
const ROLE_HIERARCHY = {
  dev: 100,
  diretoria: 90,
  gestor: 90,
  administrador: 70,
  financeiro: 60,
  compras: 50,
  obra: 10,
};
const ROLE_DISPLAY_NAMES: Record&lt;string, string&gt; = {
  administrador: &quot;Admin&quot;,
  compras: &quot;Compras&quot;,
  obra: &quot;Obra&quot;,
  financeiro: &quot;Financeiro&quot;,
  gestor: &quot;Gestor&quot;,
  diretoria: &quot;Diretoria&quot;,
  dev: &quot;Dev&quot;,
};
const UserManagement: React.FC = () =&gt; {
  const [users, setUsers] = useState&lt;ManagedUser[]&gt;([]);
  const [loading, setLoading] = useState(true);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingUser, setEditingUser] = useState&lt;ManagedUser | null&gt;(null);
  const [userToDelete, setUserToDelete] = useState&lt;ManagedUser | null&gt;(null);
  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);
  const [searchTerm, setSearchTerm] = useState(&quot;&quot;);
  const [roleFilter, setRoleFilter] = useState(&quot;&quot;);
  const [statusFilter, setStatusFilter] = useState(&quot;&quot;);
  const [showFilters, setShowFilters] = useState(false);
  const [isPermissionsModalOpen, setIsPermissionsModalOpen] = useState(false);
  const [userForPermissions, setUserForPermissions] =
    useState&lt;ManagedUser | null&gt;(null);
  const [permissions, setPermissions] = useState&lt;Partial&lt;PermissionSet&gt;&gt;({});
  const [isPermissionsLoading, setIsPermissionsLoading] = useState(false);
  const [isSavingPermissions, setIsSavingPermissions] = useState(false);
  const [allCrdiis, setAllCrdiis] = useState&lt;CRDII[]&gt;([]);
  const [allTenants, setAllTenants] = useState&lt;Tenant[]&gt;([]);
  const { user: currentUser } = useAuth();
  const clearFilters = () =&gt; {
    setSearchTerm(&quot;&quot;);
    setRoleFilter(&quot;&quot;);
    setStatusFilter(&quot;&quot;);
  };
  if (!currentUser?.permissions?.gerenciar?.usuarios) {
    return (
      &lt;div className=&quot;user-management-container page-container&quot;&gt;
        &lt;h1&gt;Acesso Negado&lt;/h1&gt;
        &lt;p&gt;Você não tem permissão para acessar esta página.&lt;/p&gt;
      &lt;/div&gt;
    );
  }
  const [isSaving, setIsSaving] = useState(false);
  const defaultPermissions: PermissionSet = {
    page_dashboard: false,
    page_compras: false,
    gerenciar: {
      usuarios: false,
      empresas: false,
      crdiis: false,
    },
    relatorios: {
      geral: false,
      financeiro: false,
    },
    can_create_processo: false,
    can_edit_processo: false,
    can_delete_processo: false,
    can_change_status: false,
    can_upload_file: false,
    can_delete_file: false,
    can_edit_user: false,
    can_delete_user: false,
    can_create_tenant: false,
    status_limits: {
      nao_concluido: false,
      parcial: false,
      concluido: false,
      arquivado: false,
      cancelado: false,
    },
    allowed_crdii: [],
    allowed_tenants: [],
    view_status_history: false,
  };
  const fetchUsers = useCallback(async () =&gt; {
    setLoading(true);
    try {
      const response = await api.get&lt;ManagedUser[]&gt;(&quot;/auth/users/&quot;);
      setUsers(response.data);
    } catch (error) {
    } finally {
      setLoading(false);
    }
  }, []);
  useEffect(() =&gt; {
    fetchUsers();
    const fetchCrdiis = async () =&gt; {
      try {
        const response = await api.get&lt;CRDII[]&gt;(&quot;/crdiis/&quot;);
        setAllCrdiis(response.data);
      } catch (error) {
        toast.error(&quot;Falha ao carregar a lista de CRDIIs.&quot;);
      }
    };
    const fetchTenants = async () =&gt; {
      try {
        const response = await api.get&lt;Tenant[]&gt;(&quot;/tenants/&quot;);
        setAllTenants(response.data);
      } catch (error) {
        toast.error(&quot;Falha ao carregar a lista de Empresas.&quot;);
      }
    };
    fetchCrdiis();
    fetchTenants();
  }, [fetchUsers, currentUser]);
  const handleRoleChange = async (
    userId: number,
    newRole: ManagedUser[&quot;role&quot;]
  ) =&gt; {
    const previousUsers = [...users];
    setUsers(users.map((u) =&gt; (u.id === userId ? { ...u, role: newRole } : u)));
    try {
      await api.patch(`/auth/users/${userId}/`, { role: newRole });
      toast.success(&quot;Tipo do usuário atualizado!&quot;);
    } catch (error) {
      toast.error(&quot;Falha ao atualizar o tipo.&quot;);
      setUsers(previousUsers); // Reverte em caso de erro
    }
  };
  const handleStatusChange = async (userId: number, newStatus: boolean) =&gt; {
    const previousUsers = [...users];
    setUsers(
      users.map((u) =&gt; (u.id === userId ? { ...u, is_active: newStatus } : u))
    );
    try {
      await api.patch(`/auth/users/${userId}/`, { is_active: newStatus });
      toast.success(&quot;Status do usuário atualizado!&quot;);
    } catch (error) {
      toast.error(&quot;Falha ao atualizar o status.&quot;);
      setUsers(previousUsers); // Reverte em caso de erro
    }
  };
  const handleCreateUser = () =&gt; {
    setEditingUser(null);
    setIsModalOpen(true);
  };
  const handleEditUser = (user: ManagedUser) =&gt; {
    setEditingUser(user);
    setIsModalOpen(true);
  };
  const openDeleteModal = (user: ManagedUser) =&gt; {
    setUserToDelete(user);
    setIsDeleteModalOpen(true);
  };
  const closeDeleteModal = () =&gt; {
    setUserToDelete(null);
    setIsDeleteModalOpen(false);
  };
  const confirmDeleteUser = async () =&gt; {
    if (!userToDelete) return;
    try {
      await api.delete(`/auth/users/${userToDelete.id}/`);
      toast.success(`Usuário ${userToDelete.username} excluído com sucesso!`);
      await fetchUsers();
    } catch (error: any) {
      if (error.response &amp;&amp; error.response.status === 403) {
        toast.error(error.response.data.detail || &quot;Sem permissão.&quot;);
      } else {
        toast.error(&quot;Falha ao excluir o usuário.&quot;);
      }
    } finally {
      closeDeleteModal();
    }
  };
  const openPermissionsModal = async (user: ManagedUser) =&gt; {
    setUserForPermissions(user);
    setIsPermissionsModalOpen(true);
    setIsPermissionsLoading(true);
    try {
      const response = await api.get(`/auth/users/${user.id}/permissions/`);
      const loadedPermissions = response.data || {};
      const newPermissions: PermissionSet = JSON.parse(
        JSON.stringify(defaultPermissions)
      );
      for (const key in loadedPermissions) {
        const permKey = key as keyof PermissionSet;
        if (
          permKey === &quot;status_limits&quot; &amp;&amp;
          typeof loadedPermissions.status_limits === &quot;object&quot;
        ) {
          Object.assign(
            newPermissions.status_limits,
            loadedPermissions.status_limits
          );
        } else if (
          permKey === &quot;relatorios&quot; &amp;&amp;
          typeof loadedPermissions.relatorios === &quot;object&quot;
        ) {
          Object.assign(
            newPermissions.relatorios,
            loadedPermissions.relatorios
          );
        } else if (
          permKey === &quot;gerenciar&quot; &amp;&amp;
          typeof loadedPermissions.gerenciar === &quot;object&quot;
        ) {
          Object.assign(newPermissions.gerenciar, loadedPermissions.gerenciar);
        } else if (permKey in newPermissions) {
          (newPermissions[permKey] as any) = loadedPermissions[permKey];
        }
      }
      newPermissions.allowed_crdii = Array.isArray(
        loadedPermissions.allowed_crdii
      )
        ? loadedPermissions.allowed_crdii
        : [];
      newPermissions.allowed_tenants = Array.isArray(
        loadedPermissions.allowed_tenants
      )
        ? loadedPermissions.allowed_tenants
        : [];
      setPermissions(newPermissions);
    } catch (error) {
      toast.error(&quot;Falha ao carregar as permissões.&quot;);
      setPermissions(defaultPermissions);
    } finally {
      setIsPermissionsLoading(false);
    }
  };
  const closePermissionsModal = () =&gt; {
    setUserForPermissions(null);
    setIsPermissionsModalOpen(false);
    setPermissions({});
  };
  const handlePermissionChange = (
    key: keyof Omit&lt;
      PermissionSet,
      | &quot;status_limits&quot;
      | &quot;allowed_crdii&quot;
      | &quot;allowed_tenants&quot;
      | &quot;relatorios&quot;
      | &quot;gerenciar&quot;
    &gt;,
    value: boolean
  ) =&gt; {
    setPermissions((prev) =&gt; ({ ...prev, [key]: value }));
  };
  const handleGerenciarPermissionChange = (
    key: keyof GerenciarPermissions,
    value: boolean
  ) =&gt; {
    setPermissions((prev) =&gt; ({
      ...prev,
      gerenciar: {
        ...(prev.gerenciar || defaultPermissions.gerenciar),
        [key]: value,
      },
    }));
  };
  const handleRelatorioPermissionChange = (
    key: keyof RelatoriosPermissions,
    value: boolean
  ) =&gt; {
    setPermissions((prev) =&gt; ({
      ...prev,
      relatorios: {
        ...(prev.relatorios || defaultPermissions.relatorios),
        [key]: value,
      },
    }));
  };
  const handleStatusLimitChange = (key: keyof StatusLimits, value: boolean) =&gt; {
    setPermissions((prev) =&gt; ({
      ...prev,
      status_limits: {
        ...(prev.status_limits || defaultPermissions.status_limits),
        [key]: value,
      },
    }));
  };
  const handleCrdiiPermissionChange = (crdiiId: number, isChecked: boolean) =&gt; {
    setPermissions((prev) =&gt; {
      const currentCrdii = prev.allowed_crdii || [];
      const newAllowedCrdii = isChecked
        ? [...currentCrdii, crdiiId]
        : currentCrdii.filter((id) =&gt; id !== crdiiId);
      return { ...prev, allowed_crdii: newAllowedCrdii };
    });
  };
  const handleTenantPermissionChange = (
    tenantId: number,
    isChecked: boolean
  ) =&gt; {
    setPermissions((prev) =&gt; {
      const currentTenants = prev.allowed_tenants || [];
      const newAllowedTenants = isChecked
        ? [...currentTenants, tenantId]
        : currentTenants.filter((id) =&gt; id !== tenantId);
      return { ...prev, allowed_tenants: newAllowedTenants };
    });
  };
  const handleSelectAllPermissions = (
    e: React.ChangeEvent&lt;HTMLInputElement&gt;
  ) =&gt; {
    const isChecked = e.target.checked;
    const newPermissions: PermissionSet = {
      page_dashboard: isChecked,
      page_compras: isChecked,
      gerenciar: {
        usuarios: isChecked,
        empresas: isChecked,
        crdiis: isChecked,
      },
      relatorios: {
        geral: isChecked,
        financeiro: isChecked,
      },
      can_create_processo: isChecked,
      can_edit_processo: isChecked,
      can_delete_processo: isChecked,
      can_change_status: isChecked,
      can_upload_file: isChecked,
      can_delete_file: isChecked,
      can_edit_user: isChecked,
      can_delete_user: isChecked,
      can_create_tenant: isChecked,
      status_limits: {
        nao_concluido: isChecked,
        parcial: isChecked,
        concluido: isChecked,
        arquivado: isChecked,
        cancelado: isChecked,
      },
      allowed_crdii: isChecked ? allCrdiis.map((c) =&gt; c.id) : [],
      allowed_tenants: isChecked ? allTenants.map((t) =&gt; t.id) : [],
      view_status_history: isChecked,
    };
    setPermissions(newPermissions);
  };
  const handleSavePermissions = async () =&gt; {
    if (!userForPermissions) return;
    setIsSavingPermissions(true); // Ativa o loading
    try {
      await api.put(`/auth/users/${userForPermissions.id}/permissions/`, {
        permissions: permissions,
      });
      toast.success(&quot;Permissões salvas com sucesso!&quot;);
      closePermissionsModal();
    } catch (error) {
      toast.error(&quot;Falha ao salvar as permissões.&quot;);
    } finally {
      setIsSavingPermissions(false); // Desativa o loading
    }
  };
  const handleModalClose = () =&gt; {
    setIsModalOpen(false);
    setEditingUser(null);
  };
  const handleSave = async (userData: Partial&lt;ManagedUser&gt;) =&gt; {
    setIsSaving(true);
    try {
      const payload = {
        ...userData,
        first_name: userData.first_name || &quot;&quot;,
        last_name: userData.last_name || &quot;&quot;,
      };
      if (editingUser) {
        await api.patch&lt;ManagedUser&gt;(`/auth/users/${editingUser.id}/`, payload);
        toast.success(&quot;Usuário atualizado!&quot;);
      } else {
        await api.post&lt;ManagedUser&gt;(&quot;/auth/users/&quot;, payload);
        toast.success(&quot;Usuário criado!&quot;);
      }
      handleModalClose();
      await fetchUsers();
    } catch (error: any) {
      toast.error(&quot;Erro ao salvar usuário.&quot;);
    } finally {
      setIsSaving(false);
    }
  };
  const visibleUsers = useMemo(() =&gt; {
    if (!currentUser) return [];
    const currentUserLevel =
      ROLE_HIERARCHY[currentUser.role as keyof typeof ROLE_HIERARCHY] || 0;
    if (currentUser.role === &quot;dev&quot;) return users;
    return users.filter((user) =&gt; {
      if (user.role === &quot;dev&quot;) return false;
      const targetUserLevel =
        ROLE_HIERARCHY[user.role as keyof typeof ROLE_HIERARCHY] || 0;
      return targetUserLevel &lt;= currentUserLevel;
    });
  }, [users, currentUser]);
  const filteredUsers = visibleUsers.filter(
    (user) =&gt; {
      const matchesSearch = user.username.toLowerCase().includes(searchTerm.toLowerCase()) ||
        user.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
        user.role.toLowerCase().includes(searchTerm.toLowerCase());
      const matchesRole = roleFilter ? user.role === roleFilter : true;
      const matchesStatus = statusFilter ? (statusFilter === &#x27;active&#x27; ? user.is_active : !user.is_active) : true;
      return matchesSearch &amp;&amp; matchesRole &amp;&amp; matchesStatus;
    }
  );
  const availableRoles = useMemo(() =&gt; {
    if (!currentUser) return [];
    const currentUserLevel =
      ROLE_HIERARCHY[currentUser.role as keyof typeof ROLE_HIERARCHY] || 0;
    return Object.entries(ROLE_HIERARCHY)
      .filter(([role, level]) =&gt; {
        if (currentUser.role !== &quot;dev&quot; &amp;&amp; role === &quot;dev&quot;) return false;
        if (
          currentUser.role === &quot;administrador&quot; &amp;&amp;
          (role === &quot;gestor&quot; || role === &quot;diretoria&quot;)
        )
          return false;
        return level &lt;= currentUserLevel;
      })
      .sort(([, levelA], [, levelB]) =&gt; levelB - levelA)
      .map(([role]) =&gt; role);
  }, [currentUser]);
  const canManageUser = (
    currentUser: any,
    targetUser: ManagedUser
  ): boolean =&gt; {
    if (!currentUser) return false;
    if (currentUser.id === targetUser.id) return false;
    if (currentUser.is_superuser || currentUser.role === &quot;dev&quot;) return true;
    if (targetUser.role === &quot;dev&quot;) return false;
    const currentUserLevel =
      ROLE_HIERARCHY[currentUser.role as keyof typeof ROLE_HIERARCHY] || 0;
    const targetUserLevel =
      ROLE_HIERARCHY[targetUser.role as keyof typeof ROLE_HIERARCHY] || 0;
    if (targetUserLevel &gt; currentUserLevel) return false;
    return currentUser.permissions?.can_edit_user || false;
  };
  if (loading) return &lt;UserManagementSkeleton /&gt;;
  return (
    &lt;div className=&quot;user-management-container page-container&quot;&gt;
      &lt;header className=&quot;user-management-header&quot;&gt;
        &lt;div className=&quot;header-title&quot;&gt;
          &lt;Users size={28} /&gt;
          &lt;h1&gt;Gerenciamento de Usuários&lt;/h1&gt;
        &lt;/div&gt;
        &lt;div className=&quot;header-actions&quot;&gt;
          &lt;div className=&quot;search-bar&quot;&gt;
            &lt;Search size={18} /&gt;
            &lt;input
              type=&quot;text&quot;
              placeholder=&quot;Buscar usuarios...&quot;
              value={searchTerm}
              onChange={(e) =&gt; setSearchTerm(e.target.value)}
            /&gt;
          &lt;/div&gt;
          &lt;button
            className=&quot;btn-filter&quot;
            onClick={() =&gt; setShowFilters(!showFilters)}
          &gt;
            &lt;Filter size={18} /&gt;
            &lt;span&gt;Filtros&lt;/span&gt;
          &lt;/button&gt;
          &lt;button className=&quot;btn btn-primary&quot; onClick={handleCreateUser}&gt;
            &lt;PlusCircle size={20} /&gt;
            Novo Usuário
          &lt;/button&gt;
        &lt;/div&gt;
      &lt;/header&gt;
      {showFilters &amp;&amp; (
        &lt;div className=&quot;filters-panel&quot;&gt;
          &lt;div className=&quot;filter-group&quot;&gt;
            &lt;select
              value={roleFilter}
              onChange={(e) =&gt; setRoleFilter(e.target.value)}
              aria-label=&quot;Filtrar por Cargo&quot;
            &gt;
              &lt;option value=&quot;&quot;&gt;Todos os Cargos&lt;/option&gt;
              {availableRoles.map((role) =&gt; (
                 &lt;option key={role} value={role}&gt;{ROLE_DISPLAY_NAMES[role]}&lt;/option&gt;
              ))}
            &lt;/select&gt;
            &lt;select
              value={statusFilter}
              onChange={(e) =&gt; setStatusFilter(e.target.value)}
              aria-label=&quot;Filtrar por Status&quot;
            &gt;
              &lt;option value=&quot;&quot;&gt;Todos os Status&lt;/option&gt;
              &lt;option value=&quot;active&quot;&gt;Ativo&lt;/option&gt;
              &lt;option value=&quot;inactive&quot;&gt;Inativo&lt;/option&gt;
            &lt;/select&gt;
          &lt;/div&gt;
          &lt;button className=&quot;btn-clear-filters&quot; onClick={clearFilters}&gt;
            &lt;X size={16} /&gt; Limpar Filtros
          &lt;/button&gt;
        &lt;/div&gt;
      )}
      {(roleFilter || statusFilter) &amp;&amp; (
        &lt;div className=&quot;active-filters-badges&quot; style={{ display: &#x27;flex&#x27;, gap: &#x27;8px&#x27;, marginBottom: &#x27;16px&#x27;, flexWrap: &#x27;wrap&#x27; }}&gt;
            {roleFilter &amp;&amp; &lt;span className=&quot;badge&quot;&gt;Cargo: {ROLE_DISPLAY_NAMES[roleFilter] || roleFilter}&lt;/span&gt;}
            {statusFilter &amp;&amp; &lt;span className=&quot;badge&quot;&gt;Status: {statusFilter === &#x27;active&#x27; ? &#x27;Ativo&#x27; : &#x27;Inativo&#x27;}&lt;/span&gt;}
        &lt;/div&gt;
      )}
      &lt;div className=&quot;user-list&quot;&gt;
        &lt;table className=&quot;user-table&quot;&gt;
          &lt;thead&gt;
            &lt;tr&gt;
              &lt;th&gt;Usuário&lt;/th&gt;
              &lt;th&gt;E-mail&lt;/th&gt;
              &lt;th&gt;Nome Completo&lt;/th&gt;
              &lt;th&gt;Tipo&lt;/th&gt;
              &lt;th&gt;Status&lt;/th&gt;
              &lt;th&gt;Permissão&lt;/th&gt;
              &lt;th&gt;Editar&lt;/th&gt;
            &lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody&gt;
            {filteredUsers.length === 0 ? (
              &lt;tr&gt;
                &lt;td colSpan={7} className=&quot;no-results-cell&quot;&gt;
                  Nenhum usuário encontrado.
                &lt;/td&gt;
              &lt;/tr&gt;
            ) : (
              filteredUsers.map((user) =&gt; {
                const isAllowed = canManageUser(currentUser, user);
                const disabledTitle = &quot;Sem permissão&quot;;
                return (
                  &lt;tr key={user.id}&gt;
                    &lt;td data-label=&quot;Usuário&quot;&gt;{user.username}&lt;/td&gt;
                    &lt;td data-label=&quot;E-mail&quot;&gt;{user.email}&lt;/td&gt;
                    &lt;td data-label=&quot;Nome&quot;&gt;
                      {user.first_name} {user.last_name}
                    &lt;/td&gt;
                    &lt;td data-label=&quot;Tipo&quot;&gt;
                      &lt;div className=&quot;role-selector-wrapper&quot;&gt;
                        &lt;select
                          title=&quot;Alterar Tipo de Usuário&quot;
                          value={user.role}
                          onChange={(e) =&gt;
                            handleRoleChange(
                              user.id,
                              e.target.value as ManagedUser[&quot;role&quot;]
                            )
                          }
                          disabled={!isAllowed || isSaving}
                          className={`role-select role-${user.role}`}
                        &gt;
                          {!availableRoles.includes(user.role) &amp;&amp; (
                            &lt;option value={user.role}&gt;{user.role}&lt;/option&gt;
                          )}
                          {availableRoles.map((role) =&gt; (
                            &lt;option key={role} value={role}&gt;
                              {ROLE_DISPLAY_NAMES[role]}
                            &lt;/option&gt;
                          ))}
                        &lt;/select&gt;
                      &lt;/div&gt;
                    &lt;/td&gt;
                    &lt;td data-label=&quot;Status&quot;&gt;
                      &lt;div className=&quot;status-toggle-wrapper&quot;&gt;
                        &lt;label className=&quot;switch&quot; title=&quot;Alterar Status&quot;&gt;
                          &lt;input
                            title=&quot;Alterar Status do Usuário&quot;
                            type=&quot;checkbox&quot;
                            checked={user.is_active}
                            onChange={(e) =&gt;
                              handleStatusChange(user.id, e.target.checked)
                            }
                            disabled={!isAllowed || isSaving}
                          /&gt;
                          &lt;span className=&quot;slider round&quot;&gt;&lt;/span&gt;
                        &lt;/label&gt;
                        &lt;span
                          className={`status-text status-${user.is_active ? &quot;active&quot; : &quot;inactive&quot;}`}
                        &gt;
                          {user.is_active ? &quot;Ativo&quot; : &quot;Inativo&quot;}
                        &lt;/span&gt;
                      &lt;/div&gt;
                    &lt;/td&gt;
                    &lt;td data-label=&quot;Permissão&quot;&gt;
                      &lt;button
                        className=&quot;btn btn-icon btn-tertiary&quot;
                        title={!isAllowed ? disabledTitle : &quot;Permissões&quot;}
                        onClick={() =&gt; openPermissionsModal(user)}
                        disabled={!isAllowed || isSaving}
                      &gt;
                        &lt;Lock size={16} /&gt;
                      &lt;/button&gt;
                    &lt;/td&gt;
                    &lt;td data-label=&quot;Ações&quot;&gt;
                      &lt;div className=&quot;user-actions&quot;&gt;
                        &lt;button
                          className=&quot;btn btn-icon btn-secondary&quot;
                          title=&quot;Editar&quot;
                          onClick={() =&gt; handleEditUser(user)}
                          disabled={!isAllowed || isSaving}
                        &gt;
                          &lt;Edit size={16} /&gt;
                        &lt;/button&gt;
                        {(currentUser?.is_superuser ||
                          currentUser?.permissions?.can_delete_user) &amp;&amp; (
                          &lt;button
                            className=&quot;btn btn-icon btn-danger&quot;
                            title=&quot;Excluir&quot;
                            onClick={() =&gt; openDeleteModal(user)}
                            disabled={!isAllowed || isSaving}
                          &gt;
                            &lt;Trash2 size={16} /&gt;
                          &lt;/button&gt;
                        )}
                      &lt;/div&gt;
                    &lt;/td&gt;
                  &lt;/tr&gt;
                );
              })
            )}
          &lt;/tbody&gt;
        &lt;/table&gt;
      &lt;/div&gt;
      &lt;Modal
        title={editingUser ? &quot;Editar&quot; : &quot;Criar Usuário&quot;}
        isOpen={isModalOpen}
        onClose={handleModalClose}
        showFooter={false}
      &gt;
        &lt;UserForm
          initialData={editingUser}
          onSave={handleSave}
          onCancel={handleModalClose}
          loading={isSaving}
          availableRoles={availableRoles}
          roleDisplayNames={ROLE_DISPLAY_NAMES}
        /&gt;
      &lt;/Modal&gt;
      &lt;Modal
        title=&quot;Confirmar Exclusão&quot;
        isOpen={isDeleteModalOpen}
        onClose={closeDeleteModal}
        showFooter={false}
      &gt;
        &lt;div className=&quot;delete-modal-content&quot;&gt;
          &lt;p&gt;
            Deseja excluir &lt;strong&gt;{userToDelete?.username}&lt;/strong&gt;?
          &lt;/p&gt;
          &lt;div className=&quot;form-footer&quot;&gt;
            &lt;button className=&quot;btn btn-secondary&quot; onClick={closeDeleteModal}&gt;
              Cancelar
            &lt;/button&gt;
            &lt;button className=&quot;btn btn-danger&quot; onClick={confirmDeleteUser}&gt;
              Excluir
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/Modal&gt;
      &lt;Modal
        title={`Permissões: ${userForPermissions?.username}`}
        isOpen={isPermissionsModalOpen}
        onClose={closePermissionsModal}
        showFooter={false}
      &gt;
        {isPermissionsLoading ? (
          &lt;p&gt;Carregando...&lt;/p&gt;
        ) : (
          &lt;div className=&quot;permissions-modal-content&quot;&gt;
            &lt;div className=&quot;permissions-select-all&quot;&gt;
              &lt;label&gt;
                &lt;input type=&quot;checkbox&quot; onChange={handleSelectAllPermissions} /&gt;
                &lt;strong&gt;Selecionar Todos&lt;/strong&gt;
              &lt;/label&gt;
            &lt;/div&gt;
            &lt;div className=&quot;permissions-grid&quot;&gt;
              &lt;div className=&quot;permissions-category&quot;&gt;
                &lt;h4&gt;Páginas&lt;/h4&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.page_dashboard || false}
                    onChange={(e) =&gt;
                      handlePermissionChange(&quot;page_dashboard&quot;, e.target.checked)
                    }
                  /&gt;{&quot; &quot;}
                  Dashboard
                &lt;/label&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.page_compras || false}
                    onChange={(e) =&gt;
                      handlePermissionChange(&quot;page_compras&quot;, e.target.checked)
                    }
                  /&gt;{&quot; &quot;}
                  Processos
                &lt;/label&gt;
              &lt;/div&gt;
              &lt;div className=&quot;permissions-category&quot;&gt;
                &lt;h4&gt;Gerenciar&lt;/h4&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.gerenciar?.usuarios || false}
                    onChange={(e) =&gt;
                      handleGerenciarPermissionChange(
                        &quot;usuarios&quot;,
                        e.target.checked
                      )
                    }
                  /&gt;{&quot; &quot;}
                  Gerenciar Usuários
                &lt;/label&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.gerenciar?.empresas || false}
                    onChange={(e) =&gt;
                      handleGerenciarPermissionChange(
                        &quot;empresas&quot;,
                        e.target.checked
                      )
                    }
                  /&gt;{&quot; &quot;}
                  Gerenciar Empresas
                &lt;/label&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.gerenciar?.crdiis || false}
                    onChange={(e) =&gt;
                      handleGerenciarPermissionChange(
                        &quot;crdiis&quot;,
                        e.target.checked
                      )
                    }
                  /&gt;{&quot; &quot;}
                  Gerenciar CRDIIs
                &lt;/label&gt;
              &lt;/div&gt;
              &lt;div className=&quot;permissions-category&quot;&gt;
                &lt;h4&gt;Relatórios&lt;/h4&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.relatorios?.geral || false}
                    onChange={(e) =&gt;
                      handleRelatorioPermissionChange(&quot;geral&quot;, e.target.checked)
                    }
                  /&gt;{&quot; &quot;}
                  Geral
                &lt;/label&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.relatorios?.financeiro || false}
                    onChange={(e) =&gt;
                      handleRelatorioPermissionChange(
                        &quot;financeiro&quot;,
                        e.target.checked
                      )
                    }
                  /&gt;{&quot; &quot;}
                  Financeiro
                &lt;/label&gt;
              &lt;/div&gt;
              &lt;div className=&quot;permissions-category&quot;&gt;
                &lt;h4&gt;Recursos&lt;/h4&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.can_create_processo || false}
                    onChange={(e) =&gt;
                      handlePermissionChange(
                        &quot;can_create_processo&quot;,
                        e.target.checked
                      )
                    }
                  /&gt;{&quot; &quot;}
                  Criar Processo
                &lt;/label&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.can_edit_processo || false}
                    onChange={(e) =&gt;
                      handlePermissionChange(
                        &quot;can_edit_processo&quot;,
                        e.target.checked
                      )
                    }
                  /&gt;{&quot; &quot;}
                  Editar Processo
                &lt;/label&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.can_delete_processo || false}
                    onChange={(e) =&gt;
                      handlePermissionChange(
                        &quot;can_delete_processo&quot;,
                        e.target.checked
                      )
                    }
                  /&gt;{&quot; &quot;}
                  Excluir Processo
                &lt;/label&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.can_upload_file || false}
                    onChange={(e) =&gt;
                      handlePermissionChange(
                        &quot;can_upload_file&quot;,
                        e.target.checked
                      )
                    }
                  /&gt;{&quot; &quot;}
                  Upload
                &lt;/label&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.can_delete_file || false}
                    onChange={(e) =&gt;
                      handlePermissionChange(
                        &quot;can_delete_file&quot;,
                        e.target.checked
                      )
                    }
                  /&gt;{&quot; &quot;}
                  Excluir Arquivo
                &lt;/label&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.can_change_status || false}
                    onChange={(e) =&gt;
                      handlePermissionChange(
                        &quot;can_change_status&quot;,
                        e.target.checked
                      )
                    }
                  /&gt;{&quot; &quot;}
                  Alterar Status
                &lt;/label&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.can_edit_user || false}
                    onChange={(e) =&gt;
                      handlePermissionChange(&quot;can_edit_user&quot;, e.target.checked)
                    }
                  /&gt;{&quot; &quot;}
                  Editar Usuários
                &lt;/label&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.can_delete_user || false}
                    onChange={(e) =&gt;
                      handlePermissionChange(
                        &quot;can_delete_user&quot;,
                        e.target.checked
                      )
                    }
                  /&gt;{&quot; &quot;}
                  Excluir Usuário
                &lt;/label&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.can_create_tenant || false}
                    onChange={(e) =&gt;
                      handlePermissionChange(
                        &quot;can_create_tenant&quot;,
                        e.target.checked
                      )
                    }
                  /&gt;{&quot; &quot;}
                  Criar Empresa
                &lt;/label&gt;
              &lt;/div&gt;
              &lt;div className=&quot;permissions-category&quot;&gt;
                &lt;h4&gt;Limites de Status&lt;/h4&gt;
                {Object.keys(defaultPermissions.status_limits).map((key) =&gt; (
                  &lt;label key={key}&gt;
                    &lt;input
                      type=&quot;checkbox&quot;
                      checked={
                        permissions.status_limits?.[
                          key as keyof StatusLimits
                        ] || false
                      }
                      onChange={(e) =&gt;
                        handleStatusLimitChange(
                          key as keyof StatusLimits,
                          e.target.checked
                        )
                      }
                    /&gt;
                    {key.replace(&quot;_&quot;, &quot; &quot;)}
                  &lt;/label&gt;
                ))}
              &lt;/div&gt;
              &lt;div className=&quot;permissions-category&quot;&gt;
                &lt;h4&gt;CRDIIs Permitidos&lt;/h4&gt;
                {allCrdiis.map((c) =&gt; (
                  &lt;label key={c.id}&gt;
                    &lt;input
                      type=&quot;checkbox&quot;
                      checked={
                        permissions.allowed_crdii?.includes(c.id) || false
                      }
                      onChange={(e) =&gt;
                        handleCrdiiPermissionChange(c.id, e.target.checked)
                      }
                    /&gt;
                    {c.nome}
                  &lt;/label&gt;
                ))}
              &lt;/div&gt;
              &lt;div className=&quot;permissions-category&quot;&gt;
                &lt;h4&gt;Empresas Permitidas&lt;/h4&gt;
                {allTenants.map((t) =&gt; (
                  &lt;label key={t.id}&gt;
                    &lt;input
                      type=&quot;checkbox&quot;
                      checked={
                        permissions.allowed_tenants?.includes(t.id) || false
                      }
                      onChange={(e) =&gt;
                        handleTenantPermissionChange(t.id, e.target.checked)
                      }
                    /&gt;
                    {t.nome}{&quot; &quot;}
                  &lt;/label&gt;
                ))}
              &lt;/div&gt;
              &lt;div className=&quot;permissions-category&quot;&gt;
                &lt;h4&gt;Histórico&lt;/h4&gt;
                &lt;label&gt;
                  &lt;input
                    type=&quot;checkbox&quot;
                    checked={permissions.view_status_history || false}
                    onChange={(e) =&gt;
                      handlePermissionChange(
                        &quot;view_status_history&quot;,
                        e.target.checked
                      )
                    }
                  /&gt;{&quot; &quot;}
                  Ver Histórico
                &lt;/label&gt;
              &lt;/div&gt;
            &lt;/div&gt;
            {/* RESTAURADO: Footer com botão &#x27;Salvando...&#x27; */}
            &lt;div className=&quot;form-footer&quot;&gt;
              &lt;button
                className=&quot;btn btn-secondary&quot;
                onClick={closePermissionsModal}
                disabled={isSavingPermissions}
              &gt;
                Cancelar
              &lt;/button&gt;
              &lt;button
                className=&quot;btn btn-primary&quot;
                onClick={handleSavePermissions}
                disabled={isSavingPermissions}
              &gt;
                {isSavingPermissions ? &quot;Salvando...&quot; : &quot;Salvar Limites&quot;}
              &lt;/button&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        )}
      &lt;/Modal&gt;
    &lt;/div&gt;
  );
};
export default UserManagement;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\services\api.ts <span style="float:right">(20 linhas)</span></div>
                                <pre class="code-block">import axios, { InternalAxiosRequestConfig } from &quot;axios&quot;;
const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL || &quot;/api&quot;,
  withCredentials: true, // Enable cookies for cross-site requests (if applicable) and same-site
});
api.interceptors.request.use((config: InternalAxiosRequestConfig) =&gt; {
  const tenantInfoRaw = localStorage.getItem(&quot;tenant_info&quot;);
  if (tenantInfoRaw) {
    try {
      const tenantInfo = JSON.parse(tenantInfoRaw);
      if (tenantInfo &amp;&amp; tenantInfo.schema_name) {
        config.headers[&quot;X-Tenant-ID&quot;] = tenantInfo.schema_name;
      }
    } catch (e) {
      console.error(&quot;Erro ao processar informações do tenant:&quot;, e);
    }
  }
  return config;
});
export default api;</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\dashboard.css <span style="float:right">(279 linhas)</span></div>
                                <pre class="code-block">.dashboard-page {
  padding: 2rem;
  max-width: 1600px;
  margin: 0 auto;
}
.dashboard-header {
  margin-bottom: 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.header-title-container {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.5rem;
  color: var(--color-primary);
}
.dashboard-header h1 {
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0;
}
.header-subtitle {
  color: var(--color-text-secondary);
  font-size: 1rem;
}
.dashboard-filters {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 2rem;
  background-color: var(--color-surface);
  padding: 1rem;
  border-radius: 12px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  align-items: center;
}
.filter-group {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.filter-label {
  font-weight: 500;
  color: var(--color-text-secondary);
}
.filter-select {
  padding: 0.5rem 2rem 0.5rem 0.75rem;
  border: 1px solid var(--color-border);
  border-radius: 6px;
  background-color: var(--color-surface);
  font-size: 0.875rem;
  color: var(--color-text-primary);
  cursor: pointer;
  min-width: 120px;
}
.btn-clear-filters {
  margin-left: auto;
  color: var(--color-text-secondary);
  font-size: 0.875rem;
  background: none;
  border: solid 0.5px var(--color-danger);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.25rem;
}
.btn-clear-filters:hover {
  color: var(--color-surface);
}
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}
.stat-card.blue { --stat-card-color: #3B82F6; }
.stat-card.green { --stat-card-color: #10B981; }
.stat-card.amber { --stat-card-color: #F59E0B; }
.stat-card.purple { --stat-card-color: #8B5CF6; }
.stat-card.gray { --stat-card-color: #6B7280; }
.stat-card.red { --stat-card-color: #EF4444; }
.stat-card {
  background: var(--color-surface);
  border-radius: 12px;
  padding: 1.5rem;
  display: flex;
  align-items: center;
  gap: 1.25rem;
  box-shadow:
    0 4px 6px -1px rgba(0, 0, 0, 0.1),
    0 2px 4px -1px rgba(0, 0, 0, 0.06);
  transition:
    transform 0.2s ease,
    box-shadow 0.2s ease;
  border-left: 4px solid var(--stat-card-color);
  cursor: pointer;
  position: relative;
  overflow: hidden;
}
.stat-card:hover {
  transform: translateY(-2px);
  box-shadow:
    0 10px 15px -3px rgba(0, 0, 0, 0.1),
    0 4px 6px -2px rgba(0, 0, 0, 0.05);
}
.stat-card-icon {
  width: 50px;
  height: 50px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  flex-shrink: 0;
  background-color: var(--stat-card-color);
}
.stat-card-info {
  display: flex;
  flex-direction: column;
}
.stat-card-value {
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--color-text-primary);
  line-height: 1.2;
}
.stat-card-title {
  color: var(--color-text-secondary);
  font-size: 0.875rem;
  font-weight: 500;
}
.charts-grid {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 1.5rem;
  margin-bottom: 2rem;
}
@media (max-width: 768px) {
  .charts-grid {
    grid-template-columns: 1fr;
  }
}
.chart-container {
  background: var(--color-surface);
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  display: flex;
  flex-direction: column;
}
.chart-container-full-width {
  grid-column: 1 / -1;
}
.chart-container h3 {
  color: var(--color-text-primary);
  font-size: 1.1rem;
  margin-bottom: 1.5rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.dashboard-lists-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.5rem;
  margin-top: 1.5rem;
}
@media (min-width: 1024px) {
  .dashboard-lists-grid {
    grid-template-columns: 1fr 1fr;
  }
}
.list-header {
  display: flex;
  align-items: center;
  margin-bottom: 1rem;
}
.list-header-icon {
  margin-right: 10px;
  color: var(--color-text-secondary);
}
.list-content {
  list-style: none;
  padding: 0;
  margin: 0;
  max-height: 400px;
  overflow-y: auto;
  padding-right: 8px;
}
.list-content::-webkit-scrollbar {
  width: 6px;
}
.list-content::-webkit-scrollbar-track {
  background: var(--color-background);
  border-radius: 4px;
}
.list-content::-webkit-scrollbar-thumb {
  background-color: var(--color-border);
  border-radius: 4px;
}
.list-item {
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--color-background);
}
.list-item:last-child {
  border-bottom: none;
}
.list-item-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.list-item-value {
  font-weight: 700;
  color: var(--color-primary);
  background: var(--color-status-parcial-bg);
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 0.9rem;
}
.list-item-details {
  font-size: 0.85rem;
  color: var(--color-text-secondary);
  margin-top: 4px;
}
.empty-message {
  color: var(--color-text-secondary);
  font-style: italic;
  padding: 1rem 0;
  text-align: center;
}
.status-badge {
  padding: 2px 8px;
  border-radius: 99px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.025em;
}
.status-concluido {
  background-color: var(--color-status-concluido-bg);
  color: #065f46;
}
.status-nao_concluido {
  background-color: var(--color-status-nao_concluido-bg);
  color: #92400e;
}
.status-parcial {
  background-color: var(--color-status-parcial-bg);
  color: #0369a1;
}
.status-arquivado {
  background-color: var(--color-status-arquivado-bg);
  color: #374151;
}
.status-cancelado {
  background-color: var(--color-status-cancelado-bg);
  color: #991b1b;
}
.loading-message {
  text-align: center;
  padding: 4rem;
  color: var(--color-text-secondary);
  font-size: 1.1rem;
}
.error-message {
  background-color: var(--color-status-cancelado-bg);
  color: var(--color-danger);
  padding: 1rem;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 1rem;
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\global-animations.css <span style="float:right">(15 linhas)</span></div>
                                <pre class="code-block">@keyframes pageFadeIn {
  from {
    opacity: 0;
    transform: translateY(15px);
    filter: blur(2px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
    filter: blur(0);
  }
}
.page-container {
  animation: pageFadeIn 0.6s ease-out forwards;
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\global.css <span style="float:right">(9 linhas)</span></div>
                                <pre class="code-block">@import &quot;./variables.css&quot;;
body {
  margin: 0;
  font-family: var(--font-family-sans-serif);
  background-color: var(--color-background);
  color: var(--color-text-primary);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\header.css <span style="float:right">(36 linhas)</span></div>
                                <pre class="code-block">.app-header {
  display: none;
  align-items: center;
  padding: 0 1rem;
  height: 60px;
  background-color: var(--color-surface); /* Fundo branco */
  border-bottom: 1px solid var(--color-border); /* Borda padrão */
  position: sticky;
  top: 0;
  z-index: 900;
}
.mobile-menu-btn {
  background: none;
  border: none;
  color: var(--color-text-primary); /* Cor de texto principal */
  cursor: pointer;
  padding: 0.5rem;
  margin-right: 1rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}
.mobile-menu-btn:hover {
  background-color: rgba(0, 0, 0, 0.05);
}
.header-title {
  font-weight: 600;
  font-size: 1.2rem;
  text-transform: uppercase;
}
@media (max-width: 768px) {
  .app-header {
    display: flex; /* Mostra o header em telas pequenas */
  }
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\login.css <span style="float:right">(210 linhas)</span></div>
                                <pre class="code-block">@import url(&quot;https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&amp;display=swap&quot;);
@import &quot;./variables.css&quot;;
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: var(--font-family-sans-serif);
}
.login-container {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
  width: 100%;
  background-color: var(--color-background);
  background-image: url(&quot;data:image/svg+xml,%3Csvg width=&#x27;60&#x27; height=&#x27;60&#x27; viewBox=&#x27;0 0 60 60&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%3E%3Cg fill=&#x27;none&#x27; fill-rule=&#x27;evenodd&#x27;%3E%3Cg fill=&#x27;%23dce1e7&#x27; fill-opacity=&#x27;0.4&#x27;%3E%3Cpath d=&#x27;M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z&#x27;/%3E%3C/g%3E%3C/g%3E%3C/svg%3E&quot;);
}
.glass-card {
  width: 100%;
  max-width: 400px;
  padding: 2.5rem;
  border-radius: var(--border-radius-lg);
  background: var(--color-surface);
  box-shadow: var(--box-shadow-md);
  border: 1px solid var(--color-border);
  display: flex;
  flex-direction: column;
  align-items: center;
}
.form-header {
  text-align: center;
  margin-bottom: 2rem;
  width: 100%;
}
.logo-img {
  height: 80px; /* Altura da Logo */
  margin-bottom: 1rem;
  object-fit: contain;
}
.form-header h2 {
  color: var(--color-text-primary);
  font-size: 1.5rem;
  font-weight: 600;
}
.form-header p {
  color: var(--color-text-secondary);
  margin-top: 0.5rem;
  font-size: 0.95rem;
}
.modern-form {
  width: 100%;
}
.input-group {
  position: relative;
  margin-bottom: 1.5rem;
  width: 100%;
}
.input-group input {
  width: 100%;
  padding: 14px 16px;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  outline: none;
  font-size: 1rem;
  background: var(--color-background);
  transition: all 0.2s ease;
  color: var(--color-text-primary);
}
.input-group input:focus {
  border-color: var(--color-primary);
  background: var(--color-surface);
  box-shadow: 0 0 0 3px var(--color-primary-shadow);
}
.input-group label {
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--color-text-secondary);
  pointer-events: none;
  transition: 0.2s ease all;
  background: transparent;
  padding: 0 4px;
}
.input-group input:focus ~ label,
.input-group input:valid ~ label {
  top: 0;
  transform: translateY(-50%) scale(0.85);
  background: var(--color-surface);
  color: var(--color-primary);
  font-weight: 600;
}
.btn-modern {
  width: 100%;
  padding: 12px;
  background: var(--color-primary);
  color: white;
  border: none;
  border-radius: var(--border-radius-md);
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s;
  display: flex;
  justify-content: center;
  align-items: center;
}
.btn-modern:hover:not(:disabled) {
  background: var(--color-primary-dark);
}
.btn-modern:disabled {
  background: var(--color-primary-light);
  cursor: not-allowed;
  opacity: 0.7;
}
.error-message {
  color: var(--color-danger);
  text-align: center;
  margin-bottom: 1rem;
  font-size: 0.9rem;
  background: var(--color-status-cancelado-bg);
  padding: 8px;
  border-radius: var(--border-radius-sm);
}
.login-footer {
  text-align: center;
  margin-top: 2rem;
  padding-top: 1rem;
  border-top: 1px solid var(--color-border);
  color: var(--color-text-secondary);
  font-size: 0.6rem;
  width: 100%;
}
.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 0.8s linear infinite;
}
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}
.tenant-list-container {
  display: flex;
  flex-direction: column;
  gap: 15px;
  padding: 10px 0;
}
.tenant-list-info {
  text-align: center;
  color: var(--color-text-secondary);
  font-size: 0.95rem;
  margin-bottom: 10px;
}
.tenant-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
  max-height: 300px;
  overflow-y: auto;
}
.tenant-option-btn {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  background-color: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  cursor: pointer;
  transition: all 0.2s ease;
  color: var(--color-text-primary);
  width: 100%;
  text-align: left;
}
.tenant-option-btn:hover {
  background-color: var(--color-border);
  border-color: var(--color-text-secondary);
  transform: translateY(-1px);
}
.tenant-name {
  font-weight: 600;
  font-size: 1rem;
}
.tenant-arrow {
  color: var(--color-text-secondary);
  font-size: 1.2rem;
}
.btn-cancel-modal {
  margin-top: 10px;
  background: transparent;
  border: none;
  color: var(--color-danger);
  cursor: pointer;
  font-size: 0.9rem;
  padding: 10px;
  transition: all 0.2s ease;
}
.btn-cancel-modal:hover {
  color: var(--color-text-primary);
  font-weight: 800;
  transform: translateY(-2px);
  bottom: 2px;
  background-color: var(--color-status-cancelado-bg);
  border-style: 5px;
  border-radius: 10px;
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\mainLayout.css <span style="float:right">(26 linhas)</span></div>
                                <pre class="code-block">.main-layout {
  display: flex;
  min-height: 100vh;
}
.main-content {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  transition: margin-left 0.3s ease-in-out; /* Animação suave */
  margin-left: 10px; /* Margem para a sidebar no desktop */
}
.content-area {
  flex-grow: 1;
  padding: 24px; /* Adiciona um padding padrão para as páginas */
}
.modal-footer-buttons {
  display: flex;
  justify-content: flex-end; /* Alinha os botões à direita */
  gap: 1rem; /* Adiciona um espaço entre os botões */
}
@media (max-width: 768px) {
  .main-content {
    margin-left: 0; /* Nenhuma margem em mobile */
    transition: none; /* Remove a transição de margem em mobile */
  }
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\modal.css <span style="float:right">(156 linhas)</span></div>
                                <pre class="code-block">.modal-overlay {
  position: fixed;
  inset: 0;
  background-color: rgba(0, 0, 0, 0.55);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  -webkit-backdrop-filter: blur(3px);
  backdrop-filter: blur(3px);
  padding: 1rem;
  animation: fadeIn 0.25s ease-out forwards;
}
.modal-overlay.closing {
  animation: fadeOut 0.23s ease-out forwards;
}
@keyframes fadeIn {
  from {
    opacity: 0;
  }
}
@keyframes fadeOut {
  to {
    opacity: 0;
  }
}
.modal-content {
  background: var(--color-surface);
  padding: 24px;
  border-radius: 14px;
  width: 100%;
  max-width: 650px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 8px 28px rgba(0, 0, 0, 0.25);
  display: flex;
  flex-direction: column;
  gap: 1.2rem;
}
.modal-animate {
  animation: slideUp 0.25s ease-out forwards;
}
.closing-content {
  animation: slideDown 0.23s ease-out forwards;
}
@keyframes slideUp {
  from {
    transform: translateY(15px) scale(0.98);
    opacity: 0;
  }
}
@keyframes slideDown {
  to {
    transform: translateY(15px) scale(0.97);
    opacity: 0;
  }
}
.modal-content::-webkit-scrollbar {
  width: 8px;
}
.modal-content::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: 4px;
}
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid var(--color-border);
  padding-bottom: 12px;
}
.modal-header h3 {
  margin: 0;
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--color-text-primary);
  text-transform: uppercase;
}
.modal-close-btn {
  background: none;
  border: none;
  font-size: 1.75rem;
  cursor: pointer;
  color: var(--color-text-secondary);
  transition: 0.2s;
}
.modal-close-btn:hover {
  color: var(--color-primary);
}
.modal-body {
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
  color: var(--color-text-secondary);
}
.modal-footer {
  padding-top: 1rem;
  border-top: 1px solid var(--color-border);
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
}
.btn-cancel,
.btn-confirm {
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  border: none;
  transition: 0.2s;
}
.btn-cancel {
  background-color: var(--color-border);
  color: var(--color-text-primary);
}
.btn-cancel:hover {
  background-color: var(--color-border-hover);
}
.btn-confirm {
  background-color: var(--color-primary);
  color: var(--color-surface);
}
.btn-confirm:hover {
  background-color: var(--color-primary-hover);
}
.delete-modal-content {
  display: flex;
  flex-direction: column;
  gap: 1.4rem;
  padding-top: 0.5rem;
  color: var(--color-text-secondary);
  line-height: 1.4;
}
.delete-modal-content p {
  font-size: 1rem;
  color: var(--color-text-primary);
}
.form-footer {
  display: flex;
  justify-content: flex-end;
  gap: 0.8rem;
  margin-top: 1rem;
}
.form-footer .btn-secondary,
.form-footer .btn-danger {
  padding: 10px 18px;
  border-radius: 8px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 6px;
}
.modal-content {
  max-height: 95vh;
  overflow-y: auto;
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\pagination.css <span style="float:right">(39 linhas)</span></div>
                                <pre class="code-block">.pagination-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  margin-top: 2rem;
  padding: 1rem;
  background-color: var(--color-surface);
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}
.pagination-button {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.5rem 1rem;
  border: 1px solid var(--color-border);
  background-color: var(--color-surface);
  color: var(--color-primary);
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  transition:
    background-color 0.2s,
    color 0.2s;
}
.pagination-button:hover:not(:disabled) {
  background-color: var(--color-primary);
  color: var(--color-surface);
}
.pagination-button:disabled {
  color: var(--color-text-secondary);
  cursor: not-allowed;
  opacity: 0.6;
}
.pagination-info {
  font-weight: 500;
  color: var(--color-text-primary);
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\processoCreate.css <span style="float:right">(180 linhas)</span></div>
                                <pre class="code-block">.processo-create-page {
  max-width: 1600px;
  margin: 0 auto;
  padding: 2rem 1rem;
  animation: fadeIn 0.4s ease-out;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.create-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}
.header-title {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}
.header-title svg {
  color: var(--color-primary); /* Verde padrão */
}
.header-title h1 {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0;
}
.back-link {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--color-text-secondary);
  text-decoration: none;
  font-weight: 500;
  padding: 0.5rem 1rem;
  border-radius: var(--border-radius-md);
  transition: all 0.2s;
  background: transparent;
}
.back-link:hover {
  background-color: var(--color-background);
  color: var(--color-primary);
}
.form-card {
  background-color: var(--color-surface); /* Branco */
  border-radius: var(--border-radius-lg);
  box-shadow: var(--box-shadow-md);
  padding: 2rem;
  border: 1px solid var(--color-border);
}
.processo-form {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}
.form-section {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
.form-section h3 {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--color-text-primary);
  margin-bottom: 0.5rem;
  border-bottom: 1px solid var(--color-border);
  padding-bottom: 0.5rem;
}
.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}
@media (max-width: 600px) {
  .form-row {
    grid-template-columns: 1fr;
  }
}
.form-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}
.form-group label {
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--color-text-primary);
}
.form-input,
.form-select {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  font-size: 1rem;
  color: var(--color-text-primary);
  background-color: var(--color-background); /* Fundo levemente cinza */
  transition: all 0.2s;
}
.form-input:focus,
.form-select:focus {
  outline: none;
  border-color: var(--color-primary);
  background-color: var(--color-surface);
  box-shadow: 0 0 0 4px var(--color-primary-shadow);
}
.form-input::placeholder {
  color: var(--color-text-secondary);
  opacity: 0.6;
}
.form-select {
  appearance: none;
  background-image: url(&quot;data:image/svg+xml,%3csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; fill=&#x27;none&#x27; viewBox=&#x27;0 0 20 20&#x27;%3e%3cpath stroke=&#x27;%236c757d&#x27; stroke-linecap=&#x27;round&#x27; stroke-linejoin=&#x27;round&#x27; stroke-width=&#x27;1.5&#x27; d=&#x27;M6 8l4 4 4-4&#x27;/%3e%3c/svg%3e&quot;);
  background-position: right 0.75rem center;
  background-repeat: no-repeat;
  background-size: 1.5em 1.5em;
  padding-right: 2.5rem;
}
.form-actions {
  margin-top: 1rem;
  display: flex;
  justify-content: flex-end;
}
.submit-button {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  background-color: var(--color-primary);
  color: white;
  border: none;
  padding: 0.875rem 2rem;
  font-size: 1rem;
  font-weight: 600;
  border-radius: var(--border-radius-md);
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
  min-width: 160px;
}
.submit-button:hover:not(:disabled) {
  background-color: var(--color-primary-dark);
  transform: translateY(-1px);
}
.submit-button:active:not(:disabled) {
  transform: translateY(0);
}
.submit-button:disabled {
  background-color: var(--color-text-secondary);
  cursor: not-allowed;
  opacity: 0.7;
}
.btn-spinner {
  width: 18px;
  height: 18px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: white;
  animation: spin 1s linear infinite;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
.crdii-select-container .searchable-select-control {
  background-color: var(--color-background);
  border-color: var(--color-border);
  padding: 0.75rem 1rem;
  border-radius: var(--border-radius-md);
  font-size: 1rem; /* Garante tamanho da fonte igual aos inputs */
}
.crdii-select-container .searchable-select-control:hover {
  border-color: var(--color-text-secondary);
}
.crdii-select-container .searchable-select-control--is-focused {
  border-color: var(--color-primary);
  box-shadow: 0 0 0 4px var(--color-primary-shadow);
  background-color: var(--color-surface);
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\processoCreateSkeleton.css <span style="float:right">(76 linhas)</span></div>
                                <pre class="code-block">@keyframes shimmer {
  0% {
    background-position: -1000px 0;
  }
  100% {
    background-position: 1000px 0;
  }
}
.skeleton-line {
  background-color: #f0f0f0;
  background-image: linear-gradient(
    to right,
    #f0f0f0 0%,
    #e0e0e0 20%,
    #f0f0f0 40%,
    #f0f0f0 100%
  );
  background-repeat: no-repeat;
  background-size: 2000px 104px;
  animation: shimmer 2s linear infinite;
  border-radius: 6px;
}
.skeleton-h1 {
  height: 32px;
  width: 40%;
}
.skeleton-back-link {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--color-text-secondary);
}
.skeleton-back-link-text {
  height: 20px;
  width: 120px;
}
.skeleton-form-group {
  margin-bottom: 1.5rem;
}
.skeleton-label {
  height: 20px;
  width: 30%;
  margin-bottom: 0.5rem;
}
.skeleton-input {
  height: 45px;
  width: 100%;
}
.skeleton-button {
  height: 48px;
  width: 100%;
  margin-top: 1rem;
}
  Layout duplicado de processoCreate.css para garantir consistência
.processo-create-page {
  padding: 2rem 1rem;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.create-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  width: 100%;
  max-width: 1600px;
}
.form-container {
  background-color: var(--color-surface);
  border-radius: 16px;
  padding: 2.5rem;
  width: 100%;
  max-width: 1600px;
  border: 1px solid var(--color-border);
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\ProcessoDetail.css <span style="float:right">(375 linhas)</span></div>
                                <pre class="code-block">.processo-detail-page {
  padding: 1.5rem;
  background-color: var(--color-background);
  min-height: 100vh;
  max-width: 1600px;
  margin: 0 auto;
}
.processo-detail-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  flex-wrap: wrap;
  gap: 1rem;
}
.processo-detail-header .header-title {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}
.processo-detail-header h1 {
  font-size: 2rem;
  color: var(--color-text-primary);
  text-transform: uppercase;
  margin: 0;
}
.header-actions {
  display: flex;
  gap: 10px;
}
.back-link {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--color-text-secondary);
  text-decoration: none;
  font-weight: 500;
  transition: color 0.2s;
}
.back-link:hover {
  color: var(--color-text-primary);
}
.processo-detail-grid {
  display: grid;
  grid-template-columns: 1fr; /* Layout de uma coluna por padrão (mobile-first) */
  gap: 2rem;
}
@media (min-width: 1024px) {
  .processo-detail-grid {
    grid-template-columns: 2fr 1fr;
    align-items: start;
  }
}
.processo-detail-col-left {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}
.detail-card {
  padding: 2rem;
  border: 1px solid var(--color-border);
  border-radius: 8px;
  background-color: var(--color-surface);
}
.detail-card__grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}
.detail-card__item {
  display: flex;
  flex-direction: column;
}
.detail-card__item--full-width {
  grid-column: 1 / -1;
  margin-top: 1rem;
}
.btn_excluirprocesso {
  grid-column: 1 / -1;
  display: flex;
  justify-content: flex-end;
  justify-self: end;
  gap: 0.5rem;
  padding: 0.1rem 1rem;
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--color-surface);
  background-color: var(--color-danger);
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.2s;
}
.btn-history {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.6rem 1rem;
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--color-primary);
  background-color: transparent;
  border: 1px solid var(--color-primary);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
}
.btn-history:hover {
  background-color: var(--color-primary-bg);
  color: var(--color-primary-hover);
}
.btn-history:focus {
  outline: 2px solid var(--color-primary-focus);
  outline-offset: 2px;
}
.detail-card__label {
  font-size: 0.85rem;
  color: var(--color-text-secondary);
  margin-bottom: 0.25rem;
}
.detail-card__value {
  font-size: 1rem;
  font-weight: 500;
  color: var(--color-text-primary);
  text-transform: uppercase;
  display: flex;
  align-items: center;
  margin-right: 0.5rem;
}
.status-selector {
  position: relative;
  display: flex;
  align-items: center;
  gap: 8px;
  border-radius: 16px;
  padding: 0.35rem 0.75rem;
  transition: background-color 0.3s ease;
}
.status-selector::after {
  content: &quot;&quot;;
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-top: 6px solid currentColor;
  pointer-events: none;
}
.status-selector__select {
  -moz-appearance: none;
  -webkit-appearance: none;
  appearance: none;
  background-color: transparent;
  border: none;
  padding: 0 24px 0 0;
  width: 100%;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 500;
  color: inherit;
}
.status-selector__select:focus {
  outline: none;
}
.status-selector__select:disabled {
  opacity: 0.7;
}
.status-selector.status-nao_concluido {
  background-color: var(--color-status-nao_concluido-bg);
  color: var(--color-text-primary);
}
.status-selector.status-parcial {
  background-color: var(--color-status-parcial-bg);
  color: var(--color-text-primary);
}
.status-selector.status-concluido {
  background-color: var(--color-status-concluido-bg);
  color: var(--color-text-primary);
}
.status-selector.status-arquivado {
  background-color: var(--color-status-arquivado-bg);
  color: var(--color-text-primary);
}
.status-selector.status-cancelado {
  background-color: var(--color-status-cancelado-bg);
  color: var(--color-text-primary);
}
.status-selector__loading-icon {
  position: absolute;
  right: 30px;
  top: 50%;
  transform: translateY(-50%);
  animation: spin 1s linear infinite;
}
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}
.upload-section {
  margin-top: 2rem;
  padding-top: 2rem;
  border-top: 1px solid var(--color-border);
}
.upload-section__title {
  font-size: 1.25rem;
  color: var(--color-text-primary);
  text-transform: uppercase;
  margin: 0 0 1rem 0;
}
.upload-form {
  display: flex;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}
.upload-form input[type=&quot;file&quot;] {
  display: none;
}
.upload-form__label {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.6rem 1rem;
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 6px;
  cursor: pointer;
  transition: border-color 0.2s;
  flex-grow: 1;
}
.upload-form__label:hover {
  border-color: var(--color-primary);
}
.upload-form__submit {
  padding: 0.6rem 1.2rem;
  background-color: var(--color-primary);
  color: var(--color-surface);
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.2s;
}
.upload-form__submit:hover:not(:disabled) {
  background-color: var(--color-primary-hover);
}
.upload-form__submit:disabled {
  background-color: var(--color-text-secondary);
  cursor: not-allowed;
}
.files__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 1rem;
}
.files__title {
  font-size: 1.25rem;
  color: var(--color-text-primary);
  text-transform: uppercase;
  margin: 0;
}
.files__search-bar {
  display: flex;
  align-items: center;
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 6px;
  padding: 0.4rem 0.6rem;
}
.files__search-bar svg {
  color: var(--color-text-secondary);
  margin-right: 0.5rem;
}
.files__search-bar input {
  border: none;
  outline: none;
  background: transparent;
  font-size: 0.9rem;
}
.files__list {
  list-style-type: none;
  padding-left: 0;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}
.files__item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.75rem;
  border-radius: 6px;
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  transition: background-color 0.2s;
}
.files__item:hover {
  background-color: var(--color-background);
}
.files__icon {
  color: var(--color-primary);
  flex-grow: 1;
}
.files__info {
  flex-grow: 8;
}
.files__link {
  color: var(--color-text-primary);
  text-decoration: none;
  font-weight: 500;
  display: block; /* Garante que o link ocupe a largura */
  margin-bottom: 0.25rem;
}
.files__link:hover {
  text-decoration: underline;
  color: var(--color-primary);
}
.files__metadata {
  display: flex;
  align-items: center;
  gap: 1rem;
}
.files__meta-item {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  font-size: 0.75rem;
  color: var(--color-text-secondary);
}
.files__delete-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--color-text-secondary);
  padding: 0.5rem;
  border-radius: 50%;
  transition:
    background-color 0.2s,
    color 0.2s;
}
.files__delete-btn:hover {
  background-color: var(--color-danger);
  color: var(--color-surface);
}
.files__empty-message {
  color: var(--color-text-secondary);
  padding: 1rem;
  background-color: var(--color-background);
  border-radius: 6px;
  text-align: center;
}
.delete-process-modal__header {
  color: #ef4444;
  text-align: center;
}
.delete-process-modal__icon {
  margin-bottom: 10px;
}
.delete-process-modal__text {
  text-align: center;
  margin-top: 10px;
}
.delete-process-modal__warning {
  text-align: center;
  font-weight: bold;
  margin-top: 10px;
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\processoDetailSkeleton.css <span style="float:right">(89 linhas)</span></div>
                                <pre class="code-block">@keyframes shimmer {
  0% {
    background-position: -1000px 0;
  }
  100% {
    background-position: 1000px 0;
  }
}
.skeleton-line,
.skeleton-h1,
.skeleton-back-link-text,
.skeleton-detail-item,
.skeleton-h4,
.skeleton-file-item,
.skeleton-upload-form {
  background-color: #f0f0f0;
  background-image: linear-gradient(
    to right,
    #f0f0f0 0%,
    #e0e0e0 20%,
    #f0f0f0 40%,
    #f0f0f0 100%
  );
  background-repeat: no-repeat;
  background-size: 2000px 104px;
  animation: shimmer 2s linear infinite;
  border-radius: 6px;
}
.skeleton-h1 {
  height: 32px;
  width: 60%;
}
.skeleton-back-link {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--color-text-secondary);
}
.skeleton-back-link-text {
  height: 20px;
  width: 120px;
}
.skeleton-detail-item {
  height: 50px;
  width: 100%;
}
.skeleton-h4 {
  height: 24px;
  width: 40%;
  margin-bottom: 1rem;
  margin-top: 2rem;
}
.skeleton-file-item {
  height: 40px;
  width: 100%;
  margin-bottom: 0.75rem;
}
.skeleton-upload-section {
  margin-top: 2rem;
  border-top: 1px solid var(--color-border);
  padding-top: 2rem;
}
.skeleton-upload-form {
  height: 42px;
  width: 100%;
}
  The following styles are duplicated from processoDetail.css to ensure
  the skeleton component has the same layout structure.
.processo-detail-page {
  padding: 1.5rem;
}
.detail-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}
.processo-detail-content {
  padding: 2rem;
  border: 1px solid var(--color-border);
  border-radius: 8px;
  background-color: var(--color-surface);
}
.detail-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\processos.css <span style="float:right">(250 linhas)</span></div>
                                <pre class="code-block">.processos-container {
  padding: 1.5rem;
  background-color: var(--color-background); /* Cor de fundo da página */
  min-height: 100vh;
  max-width: 1600px;
  margin: 0 auto;
}
.processos-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  flex-wrap: wrap;
  gap: 1rem;
}
.processos-header h1 {
  font-size: 1.3rem;
  color: var(--color-text-primary); /* Cor de texto principal */
  text-transform: uppercase;
}
.processos-actions {
  display: flex;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}
.search-bar {
  display: flex;
  align-items: center;
  background-color: var(--color-surface); /* Fundo branco */
  border: 1px solid var(--color-border); /* Borda padrão */
  border-radius: 8px;
  padding: 0.5rem 0.75rem;
}
.search-bar svg {
  color: var(--color-text-secondary); /* Cinza para ícones */
  margin-right: 0.5rem;
}
.search-bar input {
  border: none;
  outline: none;
  background: transparent;
  font-size: 1rem;
}
.spacer {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  gap: 0.5rem;
}
.btn-relatorio {
  display: flex;
  align-items: center;
  height: 35px;
  gap: 0.5rem;
  background-color: var(--color-primary); 
  color: var(--color-surface);
  padding: 0.6rem 1rem;
  border-radius: 8px;
  border: none;
  font-size: 0.9rem;
  font-weight: 500;
  transition: background-color 0.2s ease;
  cursor: pointer;
}
.btn-relatorio:hover {
  background-color: var(--color-primary-dark);
}
.btn-filter {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background-color: var(--color-surface);
  color: var(--color-text-primary);
  border: 1px solid var(--color-border);
  padding: 0.6rem 1rem;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
}
.btn-filter:hover {
  background-color: var(--color-background-alt);
  border-color: var(--color-primary);
}
.filters-panel {
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 2rem;
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
  justify-content: space-between;
  align-items: flex-end;
}
.filter-group {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}
.filters-panel select,
.filters-panel input[type=&quot;date&quot;] {
  background-color: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: 6px;
  padding: 0.6rem 0.8rem;
  font-size: 0.9rem;
  color: var(--color-text-primary);
  min-width: 180px;
}
.btn-clear-filters {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background-color: transparent;
  color: var(--color-danger);
  border: 1px solid var(--color-danger);
  padding: 0.6rem 1rem;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
}
.btn-clear-filters:hover {
  background-color: var(--color-danger);
  color: white;
}
.status-text {
  font-weight: 600;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  white-space: nowrap;
  padding: 0.35rem 0.75rem;
  border-radius: 50px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
.status-pending { 
  color: #92400e; 
  background-color: var(--color-status-nao_concluido-bg);
} 
.status-parcial { 
  color: #0369a1; /* Azul escuro para contraste */
  background-color: var(--color-status-parcial-bg);
}
.status-concluido { 
  color: #166534; 
  background-color: var(--color-status-concluido-bg);
}
.status-arquivado { 
  color: #374151; 
  background-color: var(--color-status-arquivado-bg);
}
.status-cancelado { 
  color: #991b1b; 
  background-color: var(--color-status-cancelado-bg);
}
.status-icon-nao_concluido { color: #f59e0b; }
.status-icon-parcial { color: var(--color-info); }
.status-icon-concluido { color: var(--color-success); }
.status-icon-arquivado { color: var(--color-text-secondary); }
.status-icon-cancelado { color: var(--color-danger); }
.badge {
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 12px;
    padding: 4px 12px;
    font-size: 0.85rem;
    color: var(--color-text-secondary);
    display: inline-flex;
    align-items: center;
}
.no-results-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  text-align: center;
}
.no-results-icon {
  color: var(--color-text-secondary);
  opacity: 0.5;
  margin-bottom: 0.5rem;
}
.report-dropdown {
  position: relative;
  display: inline-block;
}
.report-options {
  display: flex;
  flex-direction: column;
  position: absolute;
  background-color: var(--color-surface);
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 15;
  border-radius: 8px;
  overflow: hidden;
  border: 1px solid var(--color-border);
  right: 0;
  margin-top: 0.5rem;
}
.report-options button {
  color: var(--color-text-primary);
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  background: none;
  border: none;
  text-align: left;
  cursor: pointer;
  width: 100%;
}
.report-options button:hover {
  background-color: var(--color-background-alt);
}
.user-table tbody tr.row-status-nao_concluido {
  border-left: 4px solid var(--color-status-andamento);
}
.user-table tbody tr.row-status-parcial {
  border-left: 4px solid var(--color-status-parcial);
}
.user-table tbody tr.row-status-concluido {
  border-left: 4px solid var(--color-status-concluido);
}
.user-table tbody tr.row-status-arquivado {
  border-left: 4px solid var(--color-status-arquivado);
}
.user-table tbody tr.row-status-cancelado {
  border-left: 4px solid var(--color-status-cancelado);
}
.user-table tbody tr.row-status-nao_concluido td:first-child,
.user-table tbody tr.row-status-parcial td:first-child,
.user-table tbody tr.row-status-concluido td:first-child,
.user-table tbody tr.row-status-arquivado td:first-child,
.user-table tbody tr.row-status-cancelado td:first-child {
    padding-left: 1rem; /* Garante espaçamento visual */
}
.btn-view {
  color: var(--color-text-secondary);
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}
.btn-view:hover {
  background-color: rgba(76, 175, 80, 0.1); /* Verde suave */
  color: var(--color-primary); /* Verde principal */
  transform: scale(1.15); /* Leve aumento para feedback tátil */
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\processoSkeletonCard.css <span style="float:right">(74 linhas)</span></div>
                                <pre class="code-block">.skeleton-card {
  background-color: var(--color-skeleton-background);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  border: 1px solid var(--color-border);
}
@keyframes shimmer {
  0% {
    background-position: -1000px 0;
  }
  100% {
    background-position: 1000px 0;
  }
}
.skeleton-card &gt; div,
.skeleton-card &gt; div &gt; div {
  background-color: var(--color-skeleton-base);
  background-image: linear-gradient(
    to right,
    var(--color-skeleton-base) 0%,
    var(--color-skeleton-shimmer) 20%,
    var(--color-skeleton-base) 40%,
    var(--color-skeleton-base) 100%
  );
  background-repeat: no-repeat;
  background-size: 2000px 104px;
  animation: shimmer 2s linear infinite;
  border-radius: 4px;
}
.skeleton-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1rem;
  background: transparent !important; /* O contêiner não deve ter fundo */
}
.skeleton-icon {
  width: 24px;
  height: 24px;
  border-radius: 50%;
}
.skeleton-status {
  width: 80px;
  height: 24px;
  border-radius: 12px;
}
.skeleton-line {
  height: 0.5rem;
  margin-bottom: 0.75rem;
}
.skeleton-title {
  height: 1.2rem;
  width: 80%;
}
.skeleton-subtitle {
  width: 50%;
  margin-bottom: 1.5rem;
}
.skeleton-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-top: 1px solid var(--color-border);
  padding-top: 1rem;
  margin-top: auto;
  background: transparent !important; /* O contêiner não deve ter fundo */
}
.skeleton-footer-text {
  width: 40%;
  height: 0.85rem;
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\ProcessosModal.css <span style="float:right">(58 linhas)</span></div>
                                <pre class="code-block">.modal-large {
  max-width: 900px;
}
.processos-modal-content {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  padding: 0.5rem;
}
.processos-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}
.processos-modal-header .search-bar {
  flex-grow: 1;
  max-width: 400px;
}
.processos-modal-list {
  max-height: 60vh;
  overflow-y: auto;
}
.processos-modal-list td a {
  color: var(--color-primary);
  text-decoration: none;
  font-weight: 500;
}
.status-badge {
  padding: 0.25rem 0.6rem;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: 500;
  text-align: center;
  display: inline-block;
}
.status-badge.status-nao_concluido {
  background-color: var(--color-status-nao_concluido-bg);
}
.status-badge.status-parcial {
  background-color: var(--color-status-parcial-bg);
  color: var(--color-status-parcial);
}
.status-badge.status-concluido {
  background-color: var(--color-status-concluido-bg);
}
.status-badge.status-arquivado {
  background-color: var(--color-status-arquivado-bg);
}
.status-badge.status-cancelado {
  background-color: var(--color-status-cancelado-bg);
}
.no-results-modal {
  text-align: center;
  padding: 3rem;
  color: var(--color-text-secondary);
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\searchableSelect.css <span style="float:right">(63 linhas)</span></div>
                                <pre class="code-block">.searchable-select-wrapper {
  position: relative;
  min-width: 180px;
}
.searchable-select-input-container {
  position: relative;
  display: flex;
  align-items: center;
}
.searchable-select-input {
  background-color: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: 6px;
  padding: 0.6rem 2rem 0.6rem 0.8rem;
  font-size: 0.9rem;
  color: var(--color-text-primary);
  width: 100%;
}
.searchable-select-icon {
  position: absolute;
  right: 0.8rem;
  color: var(--color-text-secondary);
  transition: transform 0.2s ease;
}
.searchable-select-icon.open {
  transform: rotate(180deg);
}
.searchable-select-icon.clear-icon {
  cursor: pointer;
}
.searchable-select-dropdown {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 6px;
  margin-top: 0.25rem;
  list-style: none;
  padding: 0.5rem 0;
  max-height: 200px;
  overflow-y: auto;
  z-index: 20;
  box-shadow: var(--box-shadow-md);
}
.searchable-select-dropdown li {
  padding: 0.6rem 1rem;
  cursor: pointer;
  transition: background-color 0.2s ease;
}
.searchable-select-dropdown li:hover {
  background-color: var(--color-background-alt);
}
.searchable-select-dropdown li.selected {
  background-color: var(--color-primary-light);
  color: var(--color-primary-dark);
  font-weight: 500;
}
.searchable-select-dropdown li.no-options {
  color: var(--color-text-secondary);
  cursor: default;
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\sidebar.css <span style="float:right">(290 linhas)</span></div>
                                <pre class="code-block">.sidebar {
  width: 280px;
  background-color: var(--color-sidebar-background);
  border-right: 1px solid var(--color-sidebar-border);
  height: 100vh;
  position: sticky; /* Fixo na tela para desktop */
  top: 0;
  left: 0;
  display: flex;
  flex-direction: column;
  box-shadow: 2px 0 15px rgba(0, 0, 0, 0.05);
  z-index: 1000;
  transform: translateX(0);
  transition:
    width 0.3s ease,
    transform 0.3s ease;
}
.sidebar-header {
  padding: 28px 20px;
  border-bottom: 1px solid var(--color-sidebar-border);
}
.logo-container {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 24px 20px; /* Adiciona um espaçamento vertical e horizontal */
  border-bottom: 1px solid var(--color-sidebar-border);
  position: relative; /* Necessário para posicionar o botão */
  transition: all 0.3s ease;
}
.sidebar-logo {
  height: 40px; /* Altura desejada para o logo */
  width: auto; /* Largura se ajusta para manter a proporção */
}
.user-info-top {
  display: flex;
  justify-content: center; /* Centraliza o nome horizontalmente */
  align-items: center; /* Centraliza verticalmente */
  padding: 16px;
  gap: 10px; /* Adiciona um espaço entre o ícone e o nome */
  background-color: var(--color-sidebar-footer-background);
  border-radius: 8px;
  font-weight: 600;
  color: var(--color-surface); /* Alterado para variável */
  text-transform: uppercase;
  margin: 10px 10px 0 10px; /* Adicionando margem para não colar na borda */
}
.user-info-top span {
  font-size: 15px; /* Garante que o nome do usuário tenha o tamanho correto */
}
.sidebar-nav {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  padding: 16px 12px;
}
.nav-item,
.logout-btn {
  width: 100%;
  background: none;
  border: none;
  text-align: left;
  font-family: var(--font-family-sans-serif);
  color: var(--color-sidebar-text-muted);
  text-decoration: none;
  padding: 12px 14px;
  border-radius: 8px;
  transition: all 0.2s ease-in-out;
  display: flex;
  align-items: center;
  cursor: pointer;
  gap: 14px;
  font-weight: 500;
  font-size: 15px;
  box-sizing: border-box;
}
.nav-item:hover,
.logout-btn:hover {
  background-color: var(--color-sidebar-item-hover);
  color: var(--color-surface);
}
.nav-item.active {
  background-color: var(--color-primary);
  color: var(--color-surface);
  font-weight: 600;
}
.nav-item.active svg {
  stroke: var(--color-surface);
}
.logout-btn {
  display: flex;
  justify-content: center;
  color: var(--color-background);
}
.logout-btn:hover {
  background-color: var(--color-sidebar-item-hover);
  color: var(--color-danger);
}
.sidebar-footer {
  border-top: 1px solid var(--color-sidebar-border);
  padding: 16px;
}
.sidebar-footer-info {
  border-top: 1px solid var(--color-sidebar-border);
  padding: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  color: var(--color-sidebar-text-muted);
  font-size: 10px;
}
.company-info {
  display: flex;
  align-items: center;
  gap: 8px;
}
.sidebar-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 999;
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
}
.sidebar-overlay.open {
  display: block;
  opacity: 1;
}
.sidebar.collapsed {
  width: 80px;
}
.sidebar-toggle-btn-absolute {
    position: absolute;
    right: -12px; /* Posiciona metade para fora da sidebar */
    top: 60px; /* Logo abaixo do logo/user info */
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background-color: var(--color-primary); /* Destaque */
    border: 2px solid var(--color-sidebar-background); /* Borda da cor do fundo para separar */
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    z-index: 1001; /* Acima da sidebar */
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.sidebar-toggle-btn-absolute:hover {
    background-color: var(--color-primary-dark);
    transform: scale(1.1);
}
.sidebar.collapsed .nav-item span,
.sidebar.collapsed .user-info-top span,
.sidebar.collapsed .company-name,
.sidebar.collapsed .logout-btn span {
  display: none;
}
.sidebar.collapsed .nav-item,
.sidebar.collapsed .logout-btn,
.sidebar.collapsed .user-info-top {
  justify-content: center;
  padding-left: 0;
  padding-right: 0;
}
.sidebar.collapsed .user-info-top {
  padding: 16px 0;
  gap: 0;
  margin: 10px 0 0 0;
}
.sidebar.collapsed .logo-container {
  padding: 15px 0;
  justify-content: center;
  flex-direction: column;
  gap: 10px;
}
.sidebar.collapsed .sidebar-logo {
  height: 32px; /* Ajuste conforme o tamanho da sua logo redonda */
  width: auto;
  max-width: 100%;
}
.sidebar.collapsed .sidebar-footer-info {
  justify-content: center;
}
.sidebar.collapsed .nav-item,
.sidebar.collapsed .logout-btn,
.sidebar.collapsed .user-info-top {
  position: relative; /* Necessário para posicionar o tooltip */
}
.sidebar.collapsed [data-tooltip]:hover::after {
  content: attr(data-tooltip);
  position: absolute;
  left: 100%;
  top: 50%;
  transform: translateY(-50%);
  background-color: #333;
  color: #fff;
  padding: 6px 12px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
  white-space: nowrap;
  z-index: 1100;
  margin-left: 12px;
  pointer-events: none;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  opacity: 0;
  animation: fadeInTooltip 0.2s forwards;
}
@keyframes fadeInTooltip {
  from {
    opacity: 0;
    transform: translate(-5px, -50%);
  }
  to {
    opacity: 1;
    transform: translate(0, -50%);
  }
}
.submenu-toggle {
  justify-content: flex-start; /* Mantém alinhado à esquerda */
  position: relative;
}
.submenu-arrow {
  margin-left: auto; /* Empurra a seta para a direita */
  transition: transform 0.3s ease;
  color: var(--color-sidebar-text-muted);
}
.submenu-arrow.rotated {
  transform: rotate(180deg);
}
.submenu-list {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease-in-out;
  background-color: rgba(0, 0, 0, 0.02); /* Fundo levemente diferente */
  border-radius: 8px;
}
.submenu-list.expanded {
  max-height: 200px; /* Altura suficiente para os itens */
  margin-bottom: 5px;
}
.nav-item.sub-item {
  padding-left: 24px; /* Recuo para subitens */
  font-size: 14px;
  height: 40px;
  color: var(--color-sidebar-text-light);
}
.sub-item-dot {
  margin-right: 8px;
  font-size: 18px;
  line-height: 0;
  color: var(--color-sidebar-text-light);
}
.nav-item.sub-item:hover .sub-item-dot {
  color: var(--color-primary);
}
@media (max-width: 768px) {
  .sidebar {
    position: fixed;
    transform: translateX(-100%);
    width: 280px; /* Garante largura total no mobile */
  }
  .sidebar.open {
    transform: translateX(0);
  }
  .sidebar-toggle-btn, .sidebar-toggle-btn-absolute {
    display: none;
  }
  .sidebar.collapsed {
    width: 280px;
  }
  .sidebar.collapsed .nav-item span,
  .sidebar.collapsed .user-info-top span,
  .sidebar.collapsed .company-name,
  .sidebar.collapsed .logout-btn span {
    display: inline;
  }
  .sidebar.collapsed .nav-item,
  .sidebar.collapsed .logout-btn {
    justify-content: flex-start;
    padding: 12px 14px;
  }
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\statusHistoryModal.css <span style="float:right">(6 linhas)</span></div>
                                <pre class="code-block">.status-history-modal-content {
    min-height: 300px;
    max-height: 60vh;
    overflow-y: auto;
    padding: 0.5rem;
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\systemStatus.css <span style="float:right">(19 linhas)</span></div>
                                <pre class="code-block">.system-status {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: var(--text-light);
  margin-top: 16px;
}
.status-indicator {
  width: 10px;
  height: 10px;
  border-radius: 50%;
}
.status-indicator.online {
  background-color: var(--color-status-online);
}
.status-indicator.offline {
  background-color: var(--color-status-offline);
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\userForm.css <span style="float:right">(79 linhas)</span></div>
                                <pre class="code-block">.user-form {
  display: flex;
  flex-direction: column;
  padding-right: 20px;
  width: auto;
  gap: 1.5rem;
}
.form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.6rem; /* Aumentado o gap vertical (primeiro valor) */
}
@media (min-width: 600px) {
  .form-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 1.4rem 2rem;
  }
}
.form-group.full-width {
  grid-column: 1 / -1;
}
.form-group {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
}
.form-group.full-width {
  grid-column: 1 / -1;
}
.form-group label {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--color-text-secondary);
}
.form-group input,
.form-group select {
  padding: 0.7rem 0.75rem;
  border: 1px solid var(--color-border);
  border-radius: 6px;
  font-size: 0.9rem;
  background-color: var(--color-surface);
  transition:
    border-color 0.2s,
    box-shadow 0.2s,
    background 0.2s;
}
.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px var(--color-primary-shadow);
}
.form-group input:disabled,
.form-group select:disabled {
  background-color: var(--color-background);
  opacity: 0.6;
  cursor: not-allowed;
}
.btn-link {
  background: none;
  border: none;
  color: var(--color-primary);
  cursor: pointer;
  font-weight: 600;
  padding: 0.5rem 0;
  text-align: left;
  font-size: 0.9rem;
}
.btn-link:hover {
  text-decoration: underline;
}
.form-footer {
  display: flex;
  justify-content: flex-end;
  gap: 0.8rem;
}
.form-footer .btn {
  min-width: 110px;
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\userManagement.css <span style="float:right">(438 linhas)</span></div>
                                <pre class="code-block">@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.user-management-container {
  padding: 1.5rem;
  animation: fadeIn 0.3s ease-in-out;
  max-width: 1600px;
  margin: 0 auto;
}
.user-management-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  flex-wrap: wrap;
  gap: 1.5rem;
}
.header-title {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}
.header-title h1 {
  font-size: 1.75rem;
  margin: 0;
  text-transform: uppercase;
  color: var(--color-text-primary);
}
.header-actions {
  display: flex;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}
.search-bar {
  position: relative;
  display: flex;
  align-items: center;
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  transition:
    border-color 0.2s,
    box-shadow 0.2s;
}
.search-bar:focus-within {
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px var(--color-primary-shadow);
}
.search-bar svg {
  position: absolute;
  left: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  color: var(--color-text-secondary);
  pointer-events: none;
}
.search-bar input {
  width: 100%;
  min-width: 280px;
  border: none;
  outline: none;
  background: transparent;
  font-size: 0.9rem;
  padding: 0.6rem 0.75rem 0.6rem 2.25rem;
}
.btn-primary {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.user-list {
  background-color: var(--color-surface);
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid var(--color-border);
  box-shadow: var(--box-shadow-sm);
}
.user-table {
  width: 100%;
  border-collapse: collapse;
}
.user-table th,
.user-table td {
  padding: 1rem 1.25rem;
  text-align: left;
  border-bottom: 1px solid var(--color-border);
  vertical-align: middle;
}
.user-table th:last-child,
.user-table td:last-child {
  text-align: center;
  white-space: nowrap;
  width: 1%; /* Truque para ocupar apenas o espaço necessário */
}
.user-table tbody tr:last-child td {
  border-bottom: none;
}
.user-table th {
  background-color: var(--color-background);
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--color-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  position: sticky;
  top: 0;
  z-index: 10;
}
.user-table tbody tr:hover {
  background-color: var(--color-background);
}
.role-selector-wrapper {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  position: relative;
}
.role-selector-wrapper::after {
  content: &quot;&quot;;
  position: absolute;
  top: 50%;
  right: 0;
  transform: translateY(-50%);
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-top: 6px solid var(--color-text-secondary);
  pointer-events: none;
}
.role-select {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  border: none;
  background-color: transparent;
  font-weight: 600;
  font-size: 0.9rem;
  cursor: pointer;
  padding: 0.25rem 1.5rem 0.25rem 0;
  width: 100%;
}
.role-select:focus {
  outline: none;
}
.role-administrador {
  color: var(--color-danger);
}
.role-compras {
  color: var(--color-primary);
}
.role-obra {
  color: var(--color-warning);
}
.role-financeiro {
  color: var(--color-info);
}
.role-gestor {
  color: #7c3aed;
}
.role-diretoria {
  color: #db2777;
}
.role-dev {
  color: #000;
}
.user-actions {
  display: flex;
  justify-content: center; /* Centraliza no desktop */
  align-items: center;
  gap: 0.5rem;
}
.btn-icon {
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 6px;
  border-radius: 4px;
  transition: background 0.2s;
}
.btn-icon:hover {
  background-color: var(--color-background);
  color: var(--color-danger);
}
.btn-secondary {
  color: var(--color-primary);
}
.btn-tertiary {
  color: var(--color-warning);
}
.btn-danger {
  color: var(--color-danger);
}
.switch {
  position: relative;
  display: inline-block;
  width: 34px;
  height: 20px;
  margin: 0 auto; /* Centraliza */
}
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: 0.4s;
}
.slider:before {
  position: absolute;
  content: &quot;&quot;;
  height: 14px;
  width: 14px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: 0.4s;
}
input:checked + .slider {
  background-color: var(--color-success);
}
input:checked + .slider:before {
  transform: translateX(14px);
}
.slider.round {
  border-radius: 34px;
}
.slider.round:before {
  border-radius: 50%;
}
.permissions-modal-content {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}
.permissions-select-all {
  padding-bottom: 1rem;
  margin-bottom: 1rem;
  border-bottom: 1px solid var(--color-border);
}
.permissions-select-all label {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-weight: 600;
  font-size: 1.05em;
  cursor: pointer;
}
.permissions-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 1.5rem;
}
.permissions-category {
  display: flex;
  flex-direction: column;
  gap: 0.85rem;
  padding: 1.25rem;
  background-color: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: 12px;
}
.permissions-category:hover {
  border-color: var(--color-primary-variant);
  box-shadow: var(--box-shadow-md);
}
.permissions-category h4 {
  font-size: 1.1em;
  margin: 0 0 0.75rem 0;
  color: var(--color-primary);
  border-bottom: 2px solid var(--color-primary-shadow);
  padding-bottom: 0.6rem;
}
.permissions-category label {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  font-size: 0.95rem;
  cursor: pointer;
}
.permissions-category input[type=&quot;checkbox&quot;],
.permissions-select-all input[type=&quot;checkbox&quot;] {
  appearance: none;
  -webkit-appearance: none;
  width: 18px;
  height: 18px;
  border: 2px solid var(--color-border);
  border-radius: 4px;
  cursor: pointer;
  position: relative;
  flex-shrink: 0;
}
.permissions-category input[type=&quot;checkbox&quot;]:checked,
.permissions-select-all input[type=&quot;checkbox&quot;]:checked {
  background-color: var(--color-primary);
  border-color: var(--color-primary);
}
.permissions-category input[type=&quot;checkbox&quot;]:checked::before,
.permissions-select-all input[type=&quot;checkbox&quot;]:checked::before {
  content: &quot;✔&quot;;
  font-size: 12px;
  color: white;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
@media (max-width: 768px) {
  .user-management-header {
    flex-direction: column;
    align-items: stretch;
  }
  .header-actions,
  .search-bar {
    width: 100%;
  }
  .user-table thead {
    display: none;
  }
  .user-table,
  .user-table tbody,
  .user-table tr,
  .user-table td {
    display: block;
    width: 100%;
  }
  .user-table tr {
    margin-bottom: 1rem;
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    padding: 1rem;
  }
  .user-table td {
    display: flex;
    justify-content: space-between;
    align-items: center;
    text-align: right;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--color-border);
  }
  .user-table td:last-child {
    border-bottom: none;
  }
  .user-table td::before {
    content: attr(data-label);
    font-weight: 600;
    color: var(--color-text-secondary);
    text-align: left;
    margin-right: 1rem;
    text-transform: uppercase;
    font-size: 0.8rem;
  }
  .role-select {
    width: auto;
  }
  .user-actions {
    justify-content: flex-end;
  }
  .switch {
    margin: 0;
  }
}
.tenant-form {
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
  padding: 0.5rem 0;
}
.tenant-form .form-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}
.tenant-form label {
  font-weight: 600;
  color: var(--color-text-secondary);
  font-size: 0.9rem;
}
.tenant-form input {
  padding: 0.75rem;
  border: 1px solid var(--color-border);
  border-radius: 8px;
  font-size: 1rem;
  transition: border-color 0.2s;
}
.tenant-form input:focus {
  border-color: var(--color-primary);
  outline: none;
  box-shadow: 0 0 0 3px var(--color-primary-shadow);
}
.permission-submenu {
  padding-left: 20px;
}
.input-with-icon-wrapper {
  display: flex;
  align-items: center;
  gap: 8px;
  position: relative;
}
.input-flex {
  flex: 1;
}
.help-text {
  color: var(--color-text-secondary);
  font-size: 0.8em;
  margin-top: 0.25rem;
}
.warning-text {
  font-size: 0.9em;
  color: var(--color-danger);
  margin-top: 0.5rem;
}
.col-id {
  width: 80px;
}
.col-actions {
  width: 120px;
}
.status-toggle-wrapper {
  display: flex;
  align-items: center;
  gap: 10px;
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\userManagementSkeleton.css <span style="float:right">(48 linhas)</span></div>
                                <pre class="code-block">@keyframes shimmer {
  0% {
    background-position: -1000px 0;
  }
  100% {
    background-position: 1000px 0;
  }
}
.skeleton-line {
  background-color: #f0f0f0;
  background-image: linear-gradient(
    to right,
    #f0f0f0 0%,
    #e0e0e0 20%,
    #f0f0f0 40%,
    #f0f0f0 100%
  );
  background-repeat: no-repeat;
  background-size: 2000px 104px;
  animation: shimmer 2s linear infinite;
  border-radius: 6px;
  height: 20px;
}
.skeleton-title {
  width: 300px;
  height: 28px;
}
.skeleton-search {
  width: 200px;
  height: 36px;
}
.skeleton-action-btn {
  width: 150px;
  height: 40px;
  border-radius: 8px;
}
.skeleton-th-80 {
  width: 80%;
}
.skeleton-th-90 {
  width: 90%;
}
.skeleton-th-70 {
  width: 70%;
}
.skeleton-th-50 {
  width: 50%;
}</pre>
                            </div>
                            
                            <div class="file-container">
                                <div class="file-header">frontend\src\styles\variables.css <span style="float:right">(84 linhas)</span></div>
                                <pre class="code-block">:root {
  --color-primary: #4caf50;
  --color-primary-dark: #388e3c;
  --color-primary-light: #66bb6a;
  --color-primary-hover: #45a049; /* Tom ligeiramente mais escuro para hover */
  --color-primary-shadow: rgba(76, 175, 80, 0.2);
  --color-background: #f4f6f8;
  --color-surface: #ffffff;
  --color-text-primary: #212529;
  --color-text-secondary: #6c757d;
  --color-border: #dee2e6;
  --color-success: #28a745;
  --color-danger: #dc3545;
  --color-warning: #ffc107;
  --color-info: #17a2b8;
  --color-sidebar-background: #1e293b;
  --color-sidebar-border: #334155;
  --color-sidebar-text-muted: #94a3b8;
  --color-sidebar-text-light: #f1f5f9;
  --color-sidebar-item-hover: #334155;
  --color-sidebar-footer-background: #0f172a;
  --color-status-andamento: #ffc107; /* Amarelo */
  --color-status-parcial: #0ea5e9; /* Azul Sky */
  --color-status-concluido: #28a745; /* Verde Sucesso */
  --color-status-arquivado: #6c757d; /* Cinza Secundário */
  --color-status-cancelado: #dc3545; /* vermelho Secundário */
  --color-status-nao_concluido-bg: #fff7ed; /* Amarelo pastel */
  --color-status-parcial-bg: #e0f2fe; /* Azul pastel claro */
  --color-status-concluido-bg: #dcfce7; /* Verde pastel */
  --color-status-arquivado-bg: #f3f4f6; /* Cinza pastel */
  --color-status-cancelado-bg: #fef2f2; /* Vermelho pastel */
  --color-danger-shadow: rgba(220, 53, 69, 0.1);
  --color-status-online: #28a745; /* Verde Sucesso */
  --color-status-offline: #dc3545; /* Vermelho Perigo */
  --font-family-sans-serif:
    -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Inter&quot;, sans-serif;
  --border-radius-sm: 0.25rem;
  --border-radius-md: 0.5rem;
  --border-radius-lg: 1rem;
  --box-shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
  --box-shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
}
.btn {
  padding: 0.5rem 1rem;
  border-radius: var(--border-radius-md);
  border: 1px solid transparent;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
}
.btn-primary {
  background-color: var(--color-primary);
  color: white;
  border-color: var(--color-primary);
}
.btn-primary:hover {
  background-color: var(--color-primary-dark);
  border-color: var(--color-primary-dark);
}
.btn-danger {
  background-color: var(--color-danger);
  color: white;
  border-color: var(--color-danger);
}
.btn-secondary {
  background-color: var(--color-text-secondary);
  color: white;
  border-color: var(--color-text-secondary);
}
.btn-secondary:hover {
  background-color: var(--color-text-primary);
  color: white;
  border-color: var(--color-text-secondary);
}
.btn-tertiary {
  background-color: transparent;
  color: var(--color-text-secondary);
  border-color: var(--color-border);
}
.btn-tertiary:hover {
  background-color: var(--color-background);
  color: var(--color-primary);
  border-color: var(--color-primary);
}</pre>
                            </div>
                            
        </div>
    </body>
    </html>
    